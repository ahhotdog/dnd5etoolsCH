"use strict";class ConverterUtils{static tryPostProcessAc(a,e,r){let s=[];const c=/^(\d+)( \((.*?)\))?$/.exec(a.ac.trim());if(c)if(c[3]){const r=c[3];let t={ac:Number(c[1])},l=null;const m=[],i=new RegExp(/,\s?(?![^(]*\))/,"g");r.split(i).map(a=>a.trim()).forEach(r=>{const c=r.toLowerCase();switch(c){case"unarmored defense":case"armor scraps":case"barding scraps":case"patchwork armor":case"see natural armor feature":case"barkskin trait":case"sylvan warrior":case"cage":case"chains":case"coin mail":case"crude armored coat":case"improvised armor":case"magic robes":case"makeshift armor":case"natural and mystic armor":case"padded armor":case"padded leather":case"parrying dagger":case"plant fiber armor":case"plus armor worn":case"rag armor":case"ring of protection +2":case"see below":case"wicker armor":case"bone armor":m.push(r);break;case"natural armor":case"natural":m.push("natural armor");break;case"foresight bonus":m.push("{@spell foresight} bonus");break;case"natural barkskin":m.push("natural {@spell barkskin}");break;case"mage armor":m.push("{@spell mage armor}");break;case"studded leather armor":case"studded leather":m.push("{@item studded leather armor|phb}");break;case"leather armor":case"leather":m.push("{@item leather armor|phb}");break;case"half plate":m.push("{@item half plate armor|phb}");break;case"splint":case"splint armor":m.push("{@item splint armor|phb}");break;case"chain mail":case"chainmail":case"chain armor":m.push("{@item chain mail|phb}");break;case"scale mail":case"scale armor":case"scale":m.push("{@item scale mail|phb}");break;case"hide armor":case"hide":m.push("{@item hide armor|phb}");break;case"chain shirt":m.push("{@item chain shirt|phb}");break;case"breastplate":m.push("{@item breastplate|phb}");break;case"ring mail":m.push("{@item ring mail|phb}");break;case"plate mail":case"platemail":case"plate":case"plate armor":case"full plate":m.push("{@item plate armor|phb}");break;case"shield":m.push("{@item shield|phb}");break;case"shields":m.push("{@item shield|phb|shields}");break;case"dwarven plate":m.push("{@item dwarven plate|dmg}");break;case"bracers of defense":m.push("{@item bracers of defense}");break;case"+3 plate armor":m.push("{@item plate armor +3|dmg|+3 plate armor}");break;case"half plate armor +1":m.push("{@item half plate armor +1|dmg|+1 half-plate armor}");break;case"scale mail +1":m.push("{@item scale mail +1|dmg|+1 scale mail}");break;case"scale mail +2":m.push("{@item scale mail +2|dmg|+2 scale mail}");break;case"splint mail +2":m.push("{@item splint armor +2|dmg|+2 splint armor}");break;case"studded leather armor +1":m.push("{@item studded leather armor +1|dmg|+1 studded leather armor}");break;default:if(c.endsWith("with mage armor")||c.endsWith("with barkskin")){const a=/(\d+) with (.*)/.exec(c);if(!a)throw new Error("Spell AC but no leading number?");let e=null;if("mage armor"===a[2])e="{@spell mage armor}";else{if("barkskin"!==a[2])throw new Error(`Unhandled spell! ${a[2]}`);e="{@spell barkskin}"}l={ac:Number(a[1]),condition:`with ${e}`,braces:!0}}else e&&e(r,`AC requires manual checking: ${a.name} ${a.source} p${a.page}`),s.push(r)}}),m.length?(t.from=m,s.push(t)):s.push(t.ac),l&&s.push(l)}else s.push(Number(c[1]));else r&&r(a.ac,`${`${a.name} ${a.source} p${a.page}`.padEnd(48)} => ${a.ac}`),s.push(a.ac);a.ac=s}}"undefined"!=typeof module&&(module.exports=ConverterUtils);