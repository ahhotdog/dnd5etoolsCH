"use strict";const STR_REPRINTED="reprinted";let list;window.onload=function(){ExcludeUtil.initialise(),DataUtil.deity.loadJSON().then(onJsonLoad)};const sourceFilter=getSourceFilter(),pantheonFilter=new Filter({header:"Pantheon",items:["Celtic","Dawn War","Dragonlance","Drow","Dwarven","Eberron","Egyptian","Elven","FaerÃ»nian","Forgotten Realms","Gnomish","Greek","Greyhawk","Halfling","Nonhuman","Norse","Orc"]}),categoryFilter=new Filter({header:"Category",items:[STR_NONE,"Other Faiths of Eberron","The Dark Six","The Gods of Evil","The Gods of Good","The Gods of Neutrality","The Sovereign Host"]});let filterBox;function onJsonLoad(t){list=ListUtil.search({valueNames:["name","pantheon","alignment","domains","symbol","source"],listClass:"deities",sortFunction:SortUtil.listSort});const e=new Filter({header:"Alignment",items:["C","E","G","L","N"],displayFn:Parser.alignmentAbvToFull}),n=new Filter({header:"Domain",items:["Arcana","Death","Forge","Grave","Knowledge","Life","Light","Nature",STR_NONE,"Tempest","Trickery","War"]}),i=new Filter({header:"Miscellaneous",items:[STR_REPRINTED],displayFn:StrUtil.uppercaseFirst,deselFn:t=>t===STR_REPRINTED});filterBox=initFilterBox(sourceFilter,e,pantheonFilter,categoryFilter,n,i),list.on("updated",()=>{filterBox.setCount(list.visibleItems.length,list.items.length)}),$(filterBox).on(FilterBox.EVNT_VALCHANGE,handleFilterChange);ListUtil.initSublist({valueNames:["name","pantheon","alignment","domains","id"],listClass:"subdeities",getSublistRow:getSublistItem});ListUtil.initGenericPinnable(),addDeities(t),BrewUtil.pAddBrewData().then(addDeities).catch(BrewUtil.purgeBrew).then(()=>{BrewUtil.makeBrewButton("manage-brew"),BrewUtil.bind({list:list,filterBox:filterBox,sourceFilter:sourceFilter}),ListUtil.loadState(),RollerUtil.addListRollButton(),addListShowHide(),History.init(!0)})}let deitiesList=[],dtI=0;function addDeities(t){if(!t.deity||!t.deity.length)return;deitiesList=deitiesList.concat(t.deity);let e="";for(;dtI<deitiesList.length;dtI++){const t=deitiesList[dtI];if(ExcludeUtil.isExcluded(t.name,"deity",t.source))continue;const n=Parser.sourceJsonToAbv(t.source);t.alignment.sort(SortUtil.alignmentSort),t.category||(t.category=STR_NONE),t.domains||(t.domains=[STR_NONE]),t.domains.sort(SortUtil.ascSort),t._fReprinted=t.reprinted?STR_REPRINTED:"",e+=`\n\t\t\t<li class="row" ${FLTR_ID}="${dtI}" onclick="ListUtil.toggleSelected(event, this)" oncontextmenu="ListUtil.openContextMenu(event, this)">\n\t\t\t\t<a id="${dtI}" href="#${UrlUtil.autoEncodeHash(t)}" title="${t.name}">\n\t\t\t\t\t<span class="name col-xs-3">${t.name}</span>\n\t\t\t\t\t<span class="pantheon col-xs-2 text-align-center">${t.pantheon}</span>\n\t\t\t\t\t<span class="alignment col-xs-2 text-align-center">${t.alignment.join("")}</span>\n\t\t\t\t\t<span class="domains col-xs-3 ${t.domains[0]===STR_NONE?"list-entry-none":""}">${t.domains.join(", ")}</span>\n\t\t\t\t\t<span class="source col-xs-2 source${n}" title="${Parser.sourceJsonToFull(t.source)}">${n}</span>\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t`,sourceFilter.addIfAbsent(t.source),pantheonFilter.addIfAbsent(t.pantheon),categoryFilter.addIfAbsent(t.category)}const n=ListUtil.getSearchTermAndReset(list);$("#deitiesList").append(e),sourceFilter.items.sort(SortUtil.ascSort),categoryFilter.items.sort(),list.reIndex(),n&&list.search(n),list.sort("name"),filterBox.render(),handleFilterChange(),ListUtil.setOptions({itemList:deitiesList,getSublistRow:getSublistItem,primaryLists:[list]}),ListUtil.bindPinButton(),EntryRenderer.hover.bindPopoutButton(deitiesList),UrlUtil.bindLinkExportButton(filterBox),ListUtil.bindDownloadButton(),ListUtil.bindUploadButton()}function handleFilterChange(){const t=filterBox.getValues();list.filter(function(e){const n=deitiesList[$(e.elm).attr(FLTR_ID)];return filterBox.toDisplay(t,n.source,n.alignment,n.pantheon,n.category,n.domains,n._fReprinted)}),FilterBox.nextIfHidden(deitiesList)}function getSublistItem(t,e){return`\n\t\t<li class="row" ${FLTR_ID}="${e}" oncontextmenu="ListUtil.openSubContextMenu(event, this)">\n\t\t\t<a href="#${UrlUtil.autoEncodeHash(t)}" title="${t.name}">\n\t\t\t\t<span class="name col-xs-4">${t.name}</span>\n\t\t\t\t<span class="pantheon col-xs-2">${t.pantheon}</span>\n\t\t\t\t<span class="alignment col-xs-2">${t.alignment.join("")}</span>\n\t\t\t\t<span class="domains col-xs-4 ${t.domains[0]===STR_NONE?"list-entry-none":""}">${t.domains.join(", ")}</span>\n\t\t\t\t<span class="id hidden">${e}</span>\t\t\t\t\n\t\t\t</a>\n\t\t</li>\n\t`}const renderer=EntryRenderer.getDefaultRenderer();function loadhash(t){renderer.setFirstSection(!0);const e=deitiesList[t];function n(t,e){const n=[];return t.entries&&renderer.recursiveEntryRender({entries:t.entries},n),`\n\t\t${e?`<tr><td colspan="6"><i class="text-muted">${1===e?"This deity is a reprint.":""} The version below was printed in an older publication (${Parser.sourceJsonToFull(t.source)}${t.page?`, page ${t.page}`:""}).</i></td></tr>`:""}\n\t\t<tr><td colspan="6"><span class="bold">Pantheon: </span>${t.pantheon}</td></tr>\n\t\t${t.category?`<tr><td colspan="6"><span class="bold">Category: </span>${t.category}</td></tr>`:""}\n\t\t<tr><td colspan="6"><span class="bold">Alignment: </span>${t.alignment.map(t=>Parser.alignmentAbvToFull(t)).join(" ")}</td></tr>\n\t\t<tr><td colspan="6"><span class="bold">Domains: </span>${t.domains.join(", ")}</td></tr>\n\t\t${t.province?`<tr><td colspan="6"><span class="bold">Province: </span>${t.province}</td></tr>`:""}\n\t\t${t.altNames?`<tr><td colspan="6"><span class="bold">Alternate Names: </span>${t.altNames.join(", ")}</td></tr>`:""}\n\t\t<tr><td colspan="6"><span class="bold">Symbol: </span>${t.symbol}</td></tr>\n\t\t${t.symbolImg?`<tr><td colspan="6">${renderer.renderEntry({entries:[t.symbolImg]})}</td></tr>`:""}\n\t\t${n.length?`<tr class="text"><td colspan="6">${n.join("")}</td></tr>`:""}\n\t\t`}$("#pagecontent").empty().append(`\n\t\t${EntryRenderer.utils.getBorderTr()}\n\t\t${EntryRenderer.utils.getNameTr(e,!1,"",e.title?`, ${e.title.toTitleCase()}`:"")}\n\t\t${n(e)}\n\t\t${e.reprinted?'<tr class="text"><td colspan="6"><i class="text-muted">Note: this deity has been reprinted in a newer publication.</i></td></tr>':""}\n\t\t${EntryRenderer.utils.getPageTr(e)}\n\t\t${e.previousVersions?`\n\t\t${EntryRenderer.utils.getDividerTr()}\n\t\t${e.previousVersions.map((t,e)=>n(t,e+1)).join(EntryRenderer.utils.getDividerTr())}\n\t\t`:""}\n\t\t${EntryRenderer.utils.getBorderTr()}\n\t`),ListUtil.updateSelected()}function loadsub(t){filterBox.setFromSubHashes(t),ListUtil.setFromSubHashes(t)}