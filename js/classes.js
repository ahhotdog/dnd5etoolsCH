"use strict";const HASH_FEATURE="f:",HASH_HIDE_FEATURES="hideclassfs:",HASH_SHOW_FLUFF="showfluff:",HASH_SOURCES="sources:",HASH_BOOK_VIEW="bookview:",CLSS_FEATURE_LINK="feature-link",CLSS_ACTIVE="active",CLSS_SUBCLASS_PILL="sc-pill",CLSS_PANEL_LINK="pnl-link",CLSS_CLASS_FEATURES_ACTIVE="cf-active",CLSS_FLUFF_ACTIVE="fluff-active",CLSS_SUBCLASS_PREFIX="subclass-prefix",CLSS_CLASS_FEATURE="class-feature",CLSS_CLASS_FLUFF="class-fluff",CLSS_GAIN_SUBCLASS_FEATURE="gain-subclass-feature",CLSS_FRESH_UA="fresh-ua",ID_CLASS_FEATURES_TOGGLE="cf-toggle",ID_FLUFF_TOGGLE="fluff-toggle",ID_OTHER_SOURCES_TOGGLE="os-toggle",STR_PROF_NONE="none",STR_SOURCES_OFFICIAL="0",STR_SOURCES_MIXED="1",STR_SOURCES_ALL="2",STRS_SOURCE_STATES=["Official Sources","Most Recent","All Sources"],ATB_DATA_FEATURE_LINK="data-flink",ATB_DATA_FEATURE_ID="data-flink-id",ATB_DATA_SC_LIST="data-subclass-list";let subclassComparisonView;function loadhash(s){HashLoad.loadhash(s)}function loadsub(s){SubClassLoader.loadsub(s)}function addClassData(s){ClassData.addClassData(s)}function addSubclassData(s){ClassData.addSubclassData(s)}class ClassDisplay{}ClassDisplay.curClass=null;class FeatureTable{static getTableDataScData(s,e){return s+ATB_DATA_PART_SEP+e}}class ClassList{static handleFilterChange(){const s=filterBox.getValues();ClassList.classList.filter(function(e){const a=ClassData.classes[$(e.elm).attr(FLTR_ID)];return filterBox.toDisplay(s,a._fSource)})}static addClasses(s){const e=ListUtil.getSearchTermAndReset(ClassList.classList);ClassList._appendClassesToList(s),ClassList.classList.reIndex(),e&&ClassList.classList.search(e),ClassList.classList.sort("name"),filterBox.render(),ClassList.handleFilterChange()}static _appendClassesToList(s){const e=ClassData.classes.length-s.length,a=$("ul.classes");let t="";for(let a=0;a<s.length;a++){const l=s[a];if(ExcludeUtil.isExcluded(l.name,"class",l.source))continue;l._fSource=SourceUtil.isNonstandardSource(l.source)?"Others":"Core";const o=a+e;t+=ClassList._renderClass(l,o)}a.append(t)}static _renderClass(s,e){return`<li class="row" ${FLTR_ID}="${e}" ${s.uniqueId?`data-unique-id="${s.uniqueId}"`:""}>\n\t\t\t\t<a id='${e}' href="${HashLoad.getClassHash(s)}" title="${s.name}">\n\t\t\t\t\t<span class='name col-xs-8'>${s.name}</span>\n\t\t\t\t\t<span class='source col-xs-4 text-align-center source${Parser.sourceJsonToAbv(s.source)}' title="${Parser.sourceJsonToFull(s.source)}">\n\t\t\t\t\t\t${Parser.sourceJsonToAbv(s.source)}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="uniqueid hidden">${s.uniqueId?s.uniqueId:e}</span>\n\t\t\t\t</a>\n\t\t\t</li>`}}ClassList.classList=void 0;class ClassData{static addClassData(s){const e=s.class;e&&e.length&&(ClassData.replaceWarlockInvocationsWithLink(e),ClassData.sortSubclasses(e),e.filter(s=>SourceUtil.isNonstandardSource(s.source)||BrewUtil.hasSourceJson(s.source)).forEach(ClassData.markSameSourceSubclassesAsForceStandard),ClassData.classes=ClassData.classes.concat(e),ClassList.addClasses(e),History.hashChange())}static replaceWarlockInvocationsWithLink(s){const e=s.find(s=>"Warlock"===s.name&&s.source===SRC_PHB);if(!e)return;const a=e.classFeatures[1].find(s=>"Eldritch Invocations"===s.name);if(!a)return;const t=a.entries.findIndex(s=>"options"===s.type),l=a.entries.findIndex(s=>s.includes("Your invocation options are detailed at the end of the class description."));-1!==t&&-1!==l&&(a.entries[l]={type:"inlineBlock",entries:["At 2nd level, you gain two eldritch invocations of your choice. See the ",{type:"link",href:{type:"internal",path:"invocations.html"},text:"Invocations page"}," for the list of available options. When you gain certain warlock levels, you gain additional invocations of your choice."]},a.entries.splice(t,1))}static addSubclassData(s){if(!s.subclass||!s.subclass.length)return;s.subclass.forEach(s=>{const e=ClassData.classes.find(e=>e.name.toLowerCase()===s.class.toLowerCase()&&(e.source.source||e.source).toLowerCase()===(s.classSource||SRC_PHB).toLowerCase());e?(e.subclasses=e.subclasses.concat(s),ClassData.sortSubclasses([e])):alert(`Could not add subclass; could not find class with name: ${s.class}`)}),History.hashChange()}static sortSubclasses(s){for(const e of s)e.subclasses=e.subclasses.sort((s,e)=>SortUtil.ascSort(s.name,e.name))}static markSameSourceSubclassesAsForceStandard(s){s.subclasses.filter(e=>e.source===s.source).forEach(s=>s.source={source:s.source,forceStandard:!0})}static cleanScSource(s){return Parser._getSourceStringFromSource(s)}static getSubclassFromPill(s){return ClassDisplay.curClass.subclasses.find(e=>e.name===s.data("subclass")&&(e.source.source||e.source)===s.data("source"))}}ClassData.classes=[];class FeatureDescription{static getSubclassStyles(s){const e=[CLSS_SUBCLASS_FEATURE];return(SourceUtil.isNonstandardSource(s.source)||SourceUtil.hasBeenReprinted(s.shortName,s.source))&&e.push(CLSS_NON_STANDARD_SOURCE),FeatureDescription.subclassIsFreshUa(s)&&e.push(CLSS_FRESH_UA),BrewUtil.hasSourceJson(ClassData.cleanScSource(s.source))&&e.push(CLSS_HOMEBREW_SOURCE),e}static subclassIsFreshUa(s){if(SourceUtil.isNonstandardSource(s.source)||SourceUtil.hasBeenReprinted(s.shortName,s.source)){if("Knowledge Domain (PSA)"===s.name&&s.source===SRC_PSA)return!1;if("Deep Stalker (UA)"===s.name&&s.source===SRC_UALDR)return!1;if(s.name.includes("Favored Soul"))return!1;if("Shadow (UA)"===s.name&&s.source===SRC_UALDR)return!1;if("The Undying Light (UA)"===s.name&&s.source===SRC_UALDR)return!1;if(ClassDisplay.curClass.subclasses.find(e=>!SourceUtil.isNonstandardSource(e.source)&&s.name.replace(/(v\d+)?\s*\((UA|SCAG|PSA|Livestream)\)/,"").trim()===e.name))return!1}return!0}}class HashLoad{static loadhash(s){renderer.setFirstSection(!0),$("#pagecontent").html(tableDefault),$("#statsprof").html(statsProfDefault),$("#classtable").html(classTableDefault),$("#msg-no-class-selected").remove(),$("#classtable").show(),$("#button-wrapper").show(),$("#statsprof").show(),$("#sticky-nav").show(),ClassDisplay.curClass=ClassData.classes[s],$("th#nameTable").html(ClassDisplay.curClass.name),$("th#nameSummary").html(ClassDisplay.curClass.name),ClassDisplay.curClass.authors?$("th#author").html(`By ${ClassDisplay.curClass.authors.join(", ")}`).show():$("th#author").html("").hide();const e={toRoll:[ClassDisplay.curClass.hd],rollable:!0};$("td#hp div#hitdice span").html(EntryRenderer.getEntryDice(e,"Hit die")),$("td#hp div#hp1stlevel span").html(ClassDisplay.curClass.hd.faces+" + your Constitution modifier"),$("td#hp div#hphigherlevels span").html(`${EntryRenderer.getEntryDice(e,"Hit die")} (or ${ClassDisplay.curClass.hd.faces/2+1}) + your Constitution modifier per ${ClassDisplay.curClass.name} level after 1st`),$("td#prof div#saves span").html(ClassDisplay.curClass.proficiency.map(s=>Parser.attAbvToFull(s)).join(", "));const a=ClassDisplay.curClass.startingProficiencies,t=$("td#prof");t.find("div#armor span").html(void 0===a.armor?STR_PROF_NONE:a.armor.map(s=>"light"===s||"medium"===s||"heavy"===s?s+" armor":s).join(", ")),t.find("div#weapons span").html(void 0===a.weapons?STR_PROF_NONE:a.weapons.map(s=>"simple"===s||"martial"===s?s+" weapons":s).join(", ")),t.find("div#tools span").html(void 0===a.tools?STR_PROF_NONE:a.tools.join(", ")),t.find("div#skills span").html(void 0===a.skills?STR_PROF_NONE:function(s){const e=Parser.numberToString(s.choose);return 18===s.from.length?`Choose any ${e}.`:`Choose ${e} from ${CollectionUtil.joinConjunct(s.from,", ",", and ")}.`}(a.skills));const l=ClassDisplay.curClass.startingEquipment,o=l.additionalFromBackground?"<p>You start with the following items, plus anything provided by your background.</p>":"",r=0===l.default.length?"":`<ul><li>${l.default.map(s=>EntryRenderer.getDefaultRenderer().renderEntry(s)).join("</li><li>")}</ul>`,n=void 0===l.goldAlternative?"":`<p>Alternatively, you may start with ${l.goldAlternative} gp to buy your own equipment.</p>`;$("#equipment").find("div").html(`${o}${r}${n}`),renderer.resetHeaderIndex();const i=ClassDisplay.curClass.classTableGroups,c=$("#groupHeaders"),S=$("#colHeaders"),u=[];for(let s=0;s<i.length;s++){const e=i[s],a=void 0!==e.title;let t="";void 0!==e.subclasses&&(t=`${ATB_DATA_SC_LIST}="${e.subclasses.map(s=>FeatureTable.getTableDataScData(s.name,ClassData.cleanScSource(s.source))).join(ATB_DATA_LIST_SEP)}"`),c.append(`<th ${a?'class="colGroupTitle"':""} colspan="${e.colLabels.length}" ${t}>${a?e.title:""}</th>`);for(let s=0;s<e.colLabels.length;s++){let a=renderer.renderEntry(e.colLabels[s]);S.append(`<th class="centred-col" ${t}>${a}</th>`)}for(let s=0;s<e.rows.length;s++){const a=$(`#level${s+1}`);u[s]=a;for(let l=0;l<e.rows[s].length;l++){let o=e.rows[s][l];0===o&&(o="—");const r=[];renderer.recursiveEntryRender(o,r),a.append(`<td class="centred-col" ${t}>${r.join("")}</td>`)}}}const d=[];renderer.setFirstSection(!0);const C=$("#ftTopBorder");ClassDisplay.curClass.fluff&&renderer.recursiveEntryRender({type:"section",name:ClassDisplay.curClass.name,entries:ClassDisplay.curClass.fluff},d,0,{prefix:`<tr class="text ${CLSS_CLASS_FLUFF}"><td colspan="6">`,suffix:"</td></tr>",forcePrefixSuffix:!0});let _=0;for(let s=0;s<u.length;s++){const e=u[s].find(".features"),a=[],t=ClassDisplay.curClass.classFeatures[s];for(let e=0;e<t.length;e++){const l=t[e],o=UrlUtil.encodeForHash(` ${s+1}`),r=`${HASH_FEATURE}${UrlUtil.encodeForHash(l.name)}${o}`,n=`${HASH_FEATURE}${UrlUtil.encodeForHash(l.name)}${o}`,i=$(`<a href="${HashLoad.getClassHash(ClassDisplay.curClass)}${HASH_PART_SEP}${n}" class="${CLSS_FEATURE_LINK}" ${ATB_DATA_FEATURE_LINK}="${n}" ${ATB_DATA_FEATURE_ID}="${r}">${l.name}</a>`);i.click(function(){document.getElementById(r).scrollIntoView()}),"inset"!==l.type&&a.push(i);const c=[CLSS_CLASS_FEATURE];if(l.gainSubclassFeature&&c.push(CLSS_GAIN_SUBCLASS_FEATURE),renderer.recursiveEntryRender(l,d,0,{prefix:`<tr id="${r}" class="${c.join(" ")}"><td colspan="6">`,suffix:"</td></tr>",forcePrefixSuffix:!0}),l.gainSubclassFeature){for(let s=0;s<ClassDisplay.curClass.subclasses.length;s++){const e=ClassDisplay.curClass.subclasses[s];if(!ExcludeUtil.isExcluded(e.name,"subclass",e.source))for(let s=0;s<e.subclassFeatures[_].length;s++){const a=e.subclassFeatures[_][s];if(void 0===a.name)for(let s=0;s<a.entries.length;s++){const t=a.entries[s];void 0===t.name||t.name.startsWith(`<span class="${CLSS_SUBCLASS_PREFIX}">`)||(t.name=`<span class="${CLSS_SUBCLASS_PREFIX}">${e.name}: </span>${t.name}`)}const t=FeatureDescription.getSubclassStyles(e);renderer.recursiveEntryRender(a,d,0,{prefix:`<tr class="text ${t.join(" ")}" ${ATB_DATA_SC}="${e.name}" ${ATB_DATA_SRC}="${ClassData.cleanScSource(e.source)}"><td colspan="6">`,suffix:"</td></tr>",forcePrefixSuffix:!0})}}_++}}0===a.length?e.html("—"):a.forEach((s,t)=>{e.append(s),t<a.length-1&&e.append(", ")})}C.after(d.join("")),$(`.${CLSS_NON_STANDARD_SOURCE}`).not(`.${CLSS_SUBCLASS_PILL}`).not(`.${CLSS_PANEL_LINK}`).hide(),HashLoad.subclassPillWrapper=$("div#subclasses"),HashLoad.subclassPillWrapper.find("span").remove(),HashLoad.makeGenericTogglePill("Class Features",CLSS_CLASS_FEATURES_ACTIVE,ID_CLASS_FEATURES_TOGGLE,HASH_HIDE_FEATURES,!0,"Toggle class features"),ClassDisplay.curClass.fluff&&HashLoad.makeGenericTogglePill("Detail Info",CLSS_FLUFF_ACTIVE,ID_FLUFF_TOGGLE,HASH_SHOW_FLUFF,!1,"Toggle class detail information (Source: Xanathar's Guide to Everything)"),HashLoad.makeSourceCyclePill(),HashLoad.addPillDivider();const A=ClassDisplay.curClass.subclasses.map(s=>({name:s.name,source:s.source,shortName:s.shortName})).sort(function(s,e){return SortUtil.ascSort(s.shortName,e.shortName)});for(let s=0;s<A.length;s++){const e=A[s],a=SourceUtil.isNonstandardSource(e.source)||SourceUtil.hasBeenReprinted(e.shortName,e.source),t=[CLSS_ACTIVE,CLSS_SUBCLASS_PILL];a&&t.push(CLSS_NON_STANDARD_SOURCE),FeatureDescription.subclassIsFreshUa(e)&&t.push(CLSS_FRESH_UA),BrewUtil.hasSourceJson(ClassData.cleanScSource(e.source))&&t.push(CLSS_HOMEBREW_SOURCE);const l=SourceUtil.hasBeenReprinted(e.shortName,e.source)?`${e.shortName} (${Parser.sourceJsonToAbv(e.source)})`:e.shortName,o=$(`<span class="${t.join(" ")}" ${ATB_DATA_SC}="${e.name}" ${ATB_DATA_SRC}="${ClassData.cleanScSource(e.source)}" title="Source: ${Parser.sourceJsonToFull(e.source)}"><span>${l}</span></span>`);o.click(function(){HashLoad.handleSubclassClick($(this).hasClass(CLSS_ACTIVE),A[s].name,ClassData.cleanScSource(A[s].source))}),a&&o.hide(),HashLoad.subclassPillWrapper.append(o)}HashLoad.addPillDivider(),HashLoad.makeFeelingLuckyPill(),loadsub([])}static makeSourceCyclePill(){const s=$(`<span title="Cycle through source types" id="${ID_OTHER_SOURCES_TOGGLE}" data-state="0" style="min-width: 8em;"><span>${STRS_SOURCE_STATES[0]}</span></span>`);HashLoad.subclassPillWrapper.append(s),s.click(()=>{let e=Number(s.attr("data-state"));++e>2&&(e=0),s.attr("data-state",e),s.find("span").text(STRS_SOURCE_STATES[e]),HashLoad.setSourceState(e)})}static makeGenericTogglePill(s,e,a,t,l,o){const r=$(`<span title="${o}" id="${a}"><span>${s}</span></span>`);return l&&r.addClass(e),HashLoad.subclassPillWrapper.append(r),r.click(function(){let s=$(this).hasClass(e);l||(s=!s),function(s){const e=[],a=window.location.hash.split(HASH_PART_SEP);for(let s=0;s<a.length;s++){const l=a[s];l.startsWith(t)||e.push(l)}s?e.push(t+"true"):e.push(t+"false");HashLoad.cleanSetHash(e.join(HASH_PART_SEP))}(s)}),r}static addPillDivider(){HashLoad.subclassPillWrapper.append($('<span class="divider">'))}static makeFeelingLuckyPill(){const s=$('<span title="Feeling Lucky?" class="sc-pill-feeling-lucky"><span class="glyphicon glyphicon-random"></span></span>');HashLoad.subclassPillWrapper.append(s),s.click(()=>{const[s,...e]=History._getHashParts(),a=[s];e.filter(s=>!s.startsWith(HASH_SUBCLASS)).forEach(s=>a.push(s));const t=$(`.${CLSS_SUBCLASS_PILL}`).filter(":visible").map((s,e)=>HashLoad.getEncodedSubclass($(e).attr("data-subclass"),$(e).attr("data-source"))).get();a.push(`${HASH_SUBCLASS}${t[RollerUtil.roll(t.length)]}`),HashLoad.cleanSetHash(a.join(HASH_PART_SEP))})}static handleSubclassClick(s,e,a){const t=[],l=window.location.hash.split(HASH_PART_SEP),o=HashLoad.getEncodedSubclass(e,a),r=HASH_SUBCLASS+o;if(s&&window.location.hash.includes(HASH_SUBCLASS))for(let s=0;s<l.length;s++){const e=l[s];if(e.startsWith(HASH_SUBCLASS)){const s=[],a=e.substr(HASH_SUBCLASS.length).split(HASH_LIST_SEP);for(let e=0;e<a.length;e++){const t=a[e];t!==o&&s.push(t)}s.length>0&&t.push(HASH_SUBCLASS+s.join(HASH_LIST_SEP))}else t.push(e)}else{let s=!1;for(let e=0;e<l.length;e++){const a=l[e];if(a.startsWith(HASH_SUBCLASS)){const e=[],l=a.substr(HASH_SUBCLASS.length).split(HASH_LIST_SEP);for(let s=0;s<l.length;s++){const a=l[s];a!==o&&e.push(a)}e.push(o),e.length>0&&t.push(HASH_SUBCLASS+e.join(HASH_LIST_SEP)),s=!0}else t.push(a)}s||t.push(r)}HashLoad.cleanSetHash(t.join(HASH_PART_SEP))}static getClassHash(s){return`#${UrlUtil.autoEncodeHash(s)}`}static getEncodedSubclass(s,e){return`${UrlUtil.encodeForHash(s)}${HASH_SUB_LIST_SEP}${UrlUtil.encodeForHash(e)}`}static cleanSetHash(s){window.location.hash=s.replace(/,+/g,",").replace(/,$/,"").toLowerCase()}static setSourceState(s){const e=window.location.hash;e.includes(HASH_SOURCES)?HashLoad.cleanSetHash(e.replace(/sources:(\d|true|false)/,`${HASH_SOURCES}${s}`)):HashLoad.cleanSetHash(`${e}${HASH_PART_SEP}${HASH_SOURCES}${s}`)}}HashLoad.subclassPillWrapper=void 0;class SubClassLoader{static loadsub(s){let e=null,a=null,t=null,l=null,o=null,r=null,n=null;function i(s,e){return"true"===s.slice(e.length)}SubClassLoader.partCache=null;for(let c=0;c<s.length;c++){const S=s[c];S.startsWith(HASH_SUBCLASS)&&(e=S.slice(HASH_SUBCLASS.length).split(HASH_LIST_SEP)),S.startsWith(HASH_FEATURE)&&(a=S),S.startsWith(HASH_HIDE_FEATURES)&&(t=i(S,HASH_HIDE_FEATURES)),S.startsWith(HASH_SHOW_FLUFF)&&(l=i(S,HASH_SHOW_FLUFF)),S.startsWith(HASH_SOURCES)&&(o=S.slice(HASH_SOURCES.length)),S.startsWith(HASH_BOOK_VIEW)&&(r=i(S,HASH_BOOK_VIEW)),subclassComparisonView&&S.startsWith(subclassComparisonView.hashKey)&&(n=i(S,`${subclassComparisonView.hashKey}:`))}const c=!ClassBookView.bookViewActive&&(null===o||o===STR_SOURCES_OFFICIAL),S=!ClassBookView.bookViewActive&&o===STR_SOURCES_MIXED;if(null!==e&&(c||S)){const a=[],t=$(`.${CLSS_SUBCLASS_PILL}.${CLSS_NON_STANDARD_SOURCE}.${CLSS_ACTIVE}`);(c?t:t.not(`.${CLSS_FRESH_UA}`)).each(function(){const s=$(this),t=HashLoad.getEncodedSubclass(s.attr(ATB_DATA_SC),s.attr(ATB_DATA_SRC));$.inArray(e,t)&&a.push(t)});const l=e.filter(s=>a.indexOf(s)<0);if(l.length!==e.length){const e=[];for(let a=0;a<s.length;a++){const t=s[a];t.startsWith(HASH_SUBCLASS)?l.length>0&&e.push(HASH_SUBCLASS+l.join(HASH_LIST_SEP)):e.push(t)}const a=History._getHashParts();if(a.length>1){const s=[a[0]].concat(e);HashLoad.cleanSetHash(HASH_START+s.join(HASH_PART_SEP))}return}}if(null!==e){SubClassLoader.updateClassTableLinks(),SubClassLoader.updateNavLinks(s);const a=[],t=[];if($(`.${CLSS_SUBCLASS_PILL}`).each(function(){const s=$(this),l=HashLoad.getEncodedSubclass(s.attr(ATB_DATA_SC),s.attr(ATB_DATA_SRC));let o=!1;for(let s=0;s<e.length;s++){if(e[s].toLowerCase().trim()===l){o=!0;break}}o?a.push(s):t.push(s)}),ClassBookView.updateVisible(a,t),0===a.length)SubClassLoader.hideAllSubclasses(s,c);else{const s=$("#pagecontent").find(`div.${CLSS_NON_STANDARD_SOURCE}`),e=[];$.each(a,function(a,t){t.addClass(CLSS_ACTIVE),$(`.${CLSS_SUBCLASS_FEATURE}[${ATB_DATA_SC}="${t.attr(ATB_DATA_SC)}"][${ATB_DATA_SRC}="${t.attr(ATB_DATA_SRC)}"]`).show(),c||S?s.filter(`[${ATB_DATA_SC}="${t.attr(ATB_DATA_SC)}"][${ATB_DATA_SRC}="${t.attr(ATB_DATA_SRC)}"]`).hide():s.filter(`[${ATB_DATA_SC}="${t.attr(ATB_DATA_SC)}"][${ATB_DATA_SRC}="${t.attr(ATB_DATA_SRC)}"]`).show();const l=FeatureTable.getTableDataScData(t.attr(ATB_DATA_SC),t.attr(ATB_DATA_SRC));e.push(l),SubClassLoader.handleTableGroups(e,l,!0)}),$.each(t,function(a,t){t.removeClass(CLSS_ACTIVE),$(`.${CLSS_SUBCLASS_FEATURE}[${ATB_DATA_SC}="${t.attr(ATB_DATA_SC)}"][${ATB_DATA_SRC}="${t.attr(ATB_DATA_SRC)}"]`).hide(),s.filter(`[${ATB_DATA_SC}="${t.attr(ATB_DATA_SC)}"][${ATB_DATA_SRC}="${t.attr(ATB_DATA_SRC)}"]`).hide();const l=FeatureTable.getTableDataScData(t.attr(ATB_DATA_SC),t.attr(ATB_DATA_SRC));SubClassLoader.handleTableGroups(e,l,!1)});const l=s.not(`.${CLSS_SUBCLASS_FEATURE}`).filter(`:not([${ATB_DATA_SC}]):not([${ATB_DATA_SRC}])`),o=s.not(`.${CLSS_SUBCLASS_FEATURE}`).filter(`[${ATB_DATA_SC}="${EntryRenderer.DATA_NONE}"][${ATB_DATA_SRC}="${EntryRenderer.DATA_NONE}"]`);c?(l.hide(),o.hide()):(l.show(),o.show())}1!==a.length?$(`.${CLSS_SUBCLASS_PREFIX}`).show():$(`.${CLSS_SUBCLASS_PREFIX}`).hide()}else SubClassLoader.hideAllSubclasses(s,c),ClassBookView.updateVisible([],$(`.${CLSS_SUBCLASS_PILL}`).map((s,e)=>$(e)).get());const u=$(`#${ID_CLASS_FEATURES_TOGGLE}`),d=$("#pagecontent").find(`.${CLSS_CLASS_FEATURE}`),C=d.not(`.${CLSS_GAIN_SUBCLASS_FEATURE}`),_=null!==t&&t;_&&null===e?(d.hide(),l?$("#please-select-message").removeClass("showing"):$("#please-select-message").addClass("showing")):(d.show(),$("#please-select-message").removeClass("showing")),_?(u.removeClass(CLSS_CLASS_FEATURES_ACTIVE),C.hide()):(u.addClass(CLSS_CLASS_FEATURES_ACTIVE),C.show());const A=$(`#${ID_FLUFF_TOGGLE}`),h=$("#pagecontent").find(`.${CLSS_CLASS_FLUFF}`);l?(A.addClass(CLSS_FLUFF_ACTIVE),h.show()):(A.removeClass(CLSS_FLUFF_ACTIVE),h.hide());const p=$(`#${ID_OTHER_SOURCES_TOGGLE}`),L=$(`.${CLSS_SUBCLASS_PILL}.${CLSS_NON_STANDARD_SOURCE}`).not(`.${CLSS_PANEL_LINK}`);c?(p.find("span").text(STRS_SOURCE_STATES[0]),p.attr("data-state",STR_SOURCES_OFFICIAL),L.hide()):S?(p.find("span").text(STRS_SOURCE_STATES[1]),p.attr("data-state",STR_SOURCES_MIXED),L.show().not(`.${CLSS_FRESH_UA}`).hide()):(p.find("span").text(STRS_SOURCE_STATES[2]),p.attr("data-state",STR_SOURCES_ALL),L.show()),null===a||null!==SubClassLoader.prevFeature&&SubClassLoader.prevFeature===a||(document.getElementById($(`[${ATB_DATA_FEATURE_LINK}="${a}"]`)[0].getAttribute(ATB_DATA_FEATURE_ID)).scrollIntoView(),SubClassLoader.prevFeature=a),SubClassLoader.updateClassTableLinks(),SubClassLoader.updateNavLinks(s),r?ClassBookView.open():ClassBookView.teardown(),n&&subclassComparisonView?subclassComparisonView.open():subclassComparisonView&&subclassComparisonView.teardown()}static handleTableGroups(s,e,a){$(`[${ATB_DATA_SC_LIST}]`).each(function(){const t=$(this),l=t.attr(ATB_DATA_SC_LIST).split(ATB_DATA_LIST_SEP);if(!a)for(let e=0;e<l.length;e++){const a=l[e];if(-1!==$.inArray(a,s))return}for(let s=0;s<l.length;s++){if(l[s]===e){a?t.show():t.hide();break}}})}static getFeatureLink(s){if(!SubClassLoader.partCache){const s=window.location.hash.slice(1).split(HASH_PART_SEP);SubClassLoader.partCache=[];for(let e=0;e<s.length;e++){const a=s[e];a.startsWith(HASH_FEATURE)||SubClassLoader.partCache.push(a)}}return HASH_START+SubClassLoader.partCache.join(HASH_PART_SEP)+HASH_PART_SEP+s}static updateClassTableLinks(){$(`.${CLSS_FEATURE_LINK}`).each(function(){$(this);this.href=SubClassLoader.getFeatureLink(ATB_DATA_FEATURE_LINK)})}static hideAllSubclasses(s,e){SubClassLoader.updateClassTableLinks(),SubClassLoader.updateNavLinks(s);const a=$("#pagecontent");$(`.${CLSS_SUBCLASS_PILL}`).removeClass(CLSS_ACTIVE),a.find(`.${CLSS_SUBCLASS_FEATURE}`).hide(),$(`.${CLSS_SUBCLASS_PREFIX}`).hide();const t=a.find(`div.${CLSS_NON_STANDARD_SOURCE}`);t.hide(),e||t.not(`.${CLSS_SUBCLASS_FEATURE}`).not(`.${CLSS_SUBCLASS_PILL}`).show(),$(`[${ATB_DATA_SC_LIST}]`).each(function(){$(this).hide()})}static updateNavLinks(s){CollectionUtil.arrayEq(SubClassLoader.prevSub,s)||setTimeout(()=>{const s=$("#sticky-nav"),e=s.find("hr"),a=s.find(".nav-body").empty(),t=s.find(".nav-head");t.find("div").off("click").on("click",()=>{a.toggle(),e.toggle();const s=Number(!Number(t.attr("data-state")));t.attr("data-state",s)}),$(".entry-title").each((s,e)=>{const t=$(e),l=t.parent().attr("class").trim();if("statsInlineHead"===l)return;if(!t.is(":visible"))return;const o=t.closest("tr[id]"),r=t.closest("tr"),n=t.contents().filter(function(){return 3===this.nodeType});if(!n.length)return;const i=n[0].nodeValue.replace(/[:.]$/g,""),c=t.data("title-index");!function(s,e,a,t,l,o){let r;switch(t){case"statsBlockSectionHead":r="n1";break;case"statsBlockHead":r="n2";break;case"statsBlockSubHead":r="n3"}if(void 0!==r){const t=!!a.length&&a.hasClass("subclass-feature"),n=!!a.length&&a.hasClass("spicy-sauce"),i=!!a.length&&a.hasClass("refreshing-brew");$(`<div class="nav-item ${r} ${i?"purple":n?"green":t?"blue":""}">${l}</div>`).on("click",()=>{e.length&&(window.location.hash=SubClassLoader.getFeatureLink(e.attr("id")));const s=$(`[data-title-index="${o}"]`);s.get()[0]&&s.get()[0].scrollIntoView()}).appendTo(s)}}(a,o,r,l,i,c)})},5),SubClassLoader.prevSub=s}}function initCompareMode(){subclassComparisonView=new BookModeView("compview",$("#btn-comparemode"),"Please select some subclasses first",s=>{const e=[],a=ClassDisplay.curClass.subclasses[0].subclassFeatures.length;for(let s=0;s<a;++s)e.push('<tr class="text">'),ClassDisplay.curClass.subclasses.filter(s=>!ExcludeUtil.isExcluded(s.name,"subclass",s.source)).forEach((a,t)=>{e.push(`<td class="subclass-features-${t} ${FeatureDescription.getSubclassStyles(a).join(" ")}">`),a.subclassFeatures[s].forEach(s=>{renderer.recursiveEntryRender(s,e)}),e.push("</td>")}),e.push("</tr>"),e.push('<tr><th colspan="6"><hr></th></tr>');s.append(e.join(""));let t=0;return ClassDisplay.curClass.subclasses.filter(s=>!ExcludeUtil.isExcluded(s.name,"subclass",s.source)).forEach((e,a)=>{$(`.sc-pill[data-subclass="${e.name}"][data-source="${e.source.source||e.source}"]`).hasClass("active")?t++:s.find(`.subclass-features-${a}`).hide()}),s.find("tr > td > div").css("width","400px"),t})}SubClassLoader.prevFeature=null,SubClassLoader.prevSub=null,SubClassLoader.partCache=null;class ClassBookView{static open(){function s(s,e){s.find(".class-features").toggle(),e.toggleClass("cf-active")}function e(){HashLoad.cleanSetHash(window.location.hash.replace(ClassBookView.SUBHASH,""))}if(ClassBookView.bookViewActive)return;ClassBookView.bookViewActive=!0,HashLoad.setSourceState(STR_SOURCES_ALL);const a=$("body"),t=$('<div class="book-mode"/>');ClassBookView._$body=a,ClassBookView._$wrpBook=t,a.css("overflow","hidden");const l=$('<div class="pnl-content"/>'),o=$('<table class="stats stats-book"/>');ClassBookView._$bkTbl=o;const r=$('<tr><th class="border close-border" colspan="6"><div/></th></tr>'),n=$('<span class="delete-icon glyphicon glyphicon-remove"></span>').on("click",()=>{e()});r.find("div").append(n),o.append(r);const i=[];renderer.setFirstSection(!0),renderer.recursiveEntryRender({type:"section",name:ClassDisplay.curClass.name},i,0,{prefix:'<tr><td colspan="6">',suffix:"</td></tr>",forcePrefixSuffix:!0}),i.push('<tr class="text class-features"><td colspan="6">'),ClassDisplay.curClass.classFeatures.forEach(s=>{s.forEach(s=>{renderer.recursiveEntryRender(s,i)})}),i.push("</td></tr>"),ClassDisplay.curClass.subclasses.filter(s=>!ExcludeUtil.isExcluded(s.name,"subclass",s.source)).forEach((s,e)=>{i.push(`<tr class="subclass-features-${e} ${FeatureDescription.getSubclassStyles(s).join(" ")}"><td colspan="6">`),s.subclassFeatures.forEach(s=>{s.forEach(s=>{renderer.recursiveEntryRender(s,i)})}),i.push("</td></tr>")}),i.push(EntryRenderer.utils.getBorderTr()),o.append(i.join("")),l.append(o);const c=$('<div class="pnl-menu"/>'),S=$(`#${ID_CLASS_FEATURES_TOGGLE}`),u=$('<span class="pnl-link cf-active">Class Features</span>').on("click",()=>{s(o,u),S.click()});S.hasClass("cf-active")||s(o,u),c.append(u),ClassDisplay.curClass.subclasses.filter(s=>!ExcludeUtil.isExcluded(s.name,"subclass",s.source)).forEach((s,e)=>{const a=SourceUtil.hasBeenReprinted(s.shortName,s.source)?`${s.shortName} (${Parser.sourceJsonToAbv(s.source)})`:s.shortName,t=FeatureDescription.getSubclassStyles(s),l=$(`.sc-pill[data-subclass="${s.name}"][data-source="${s.source.source||s.source}"]`),r=$(`<span class="pnl-link active ${t.join(" ")}" title="Source: ${Parser.sourceJsonToFull(s.source)}" data-i="${e}" data-bk-subclass="${s.name}" data-bk-source="${s.source.source||s.source}">${a}</span>`).on("click",()=>{ClassBookView._toggleSubclass(o,r,e),l.click()});l.hasClass("active")||ClassBookView._toggleSubclass(o,r,e),ClassBookView._$scToggles[String(e)]=r,c.append(r)});const d=$('<span class="pnl-link pnl-link-close">⇽ Close</span>').on("click",()=>{e()});c.append(d);const C=$('<div class="pnl-menu pnl-menu-pad"/>');t.append(c).append(l).append(C),a.append(t)}static teardown(){ClassBookView.bookViewActive&&(ClassBookView._$bkTbl=null,ClassBookView._$scToggles={},ClassBookView._$body.css("overflow",""),ClassBookView._$wrpBook.remove(),ClassBookView.bookViewActive=!1)}static _toggleSubclass(s,e,a){s.find(`.subclass-features-${a}`).toggle(),e.toggleClass("active")}static updateVisible(s,e){function a(s,e){s.map(s=>{const a=ClassBookView._$wrpBook.find(`.pnl-link[data-bk-subclass="${s.attr(ATB_DATA_SC)}"][data-bk-source="${s.attr(ATB_DATA_SRC)}"]`);if(a.length){const s=a.data("i"),t=ClassBookView._$scToggles[s];e&&!t.hasClass("active")&&ClassBookView._toggleSubclass(ClassBookView._$bkTbl,t,Number(s)),!e&&t.hasClass("active")&&ClassBookView._toggleSubclass(ClassBookView._$bkTbl,t,Number(s))}})}ClassBookView.bookViewActive&&(a(s,!0),a(e,!1))}static initButton(){$("#btn-readmode").on("click",()=>{HashLoad.cleanSetHash(`${window.location.hash}${HASH_PART_SEP}${ClassBookView.SUBHASH}`)})}}ClassBookView.SUBHASH=`${HASH_BOOK_VIEW}true`,ClassBookView.bookViewActive=!1,ClassBookView._$body=null,ClassBookView._$wrpBookUnder=null,ClassBookView._$wrpBook=null,ClassBookView._$bkTbl=null,ClassBookView._$scToggles={};const renderer=EntryRenderer.getDefaultRenderer(),sourceFilter=new Filter({header:FilterBox.SOURCE_HEADER,minimalUI:!0,items:["Core","Others"],selFn:s=>"Core"===s}),filterBox=initFilterBox(sourceFilter);$(filterBox).on(FilterBox.EVNT_VALCHANGE,ClassList.handleFilterChange),ClassList.classList=ListUtil.search({valueNames:["name","source","uniqueid"],listClass:"classes"}),BrewUtil.makeBrewButton("manage-brew"),BrewUtil.bind({list:ClassList.classList,filterBox:filterBox,sourceFilter:sourceFilter}),initCompareMode(),ClassBookView.initButton(),ExcludeUtil.initialise();let tableDefault=$("#pagecontent").html(),statsProfDefault=$("#statsprof").html(),classTableDefault=$("#classtable").html();function handleBrew(s){addClassData(s),addSubclassData(s)}DataUtil.class.loadJSON().then(s=>{addClassData(s),BrewUtil.pAddBrewData().then(handleBrew).catch(BrewUtil.purgeBrew).then(()=>{RollerUtil.addListRollButton(),History.init(!0)})});