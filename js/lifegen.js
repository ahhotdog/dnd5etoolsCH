"use strict";const JSON_URL="data/life.json",RNG=RollerUtil.randomise;function _testRng(e){const t={};for(let a=0;a<1e6;++a){const a=e().result;t[a]?t[a]++:t[a]=1}return t}function _getFromTable(e,t){const a={};return Object.assign(a,e.find(e=>e.min===t||e.max&&t>=e.min&&t<=e.max)),Object.keys(a).forEach(e=>{"function"==typeof a[e]&&(a[e]=a[e]())}),a}function rollSuppAlignment(){return _getFromTable(SUPP_ALIGNMENT,RNG(6)+RNG(6)+RNG(6))}function rollSuppDeath(){return _getFromTable(SUPP_DEATH,RNG(12))}function rollSuppClass(){return _getFromTable(SUPP_CLASS,RNG(100))}function rollSuppOccupation(){return _getFromTable(SUPP_OCCUPATION,RNG(100))}function rollSuppRace(){return _getFromTable(SUPP_RACE,RNG(100))}function rollSuppRelationship(){return _getFromTable(SUPP_RELATIONSHIP,RNG(4)+RNG(4)+RNG(4))}function rollSuppStatus(){return _getFromTable(SUPP_STATUS,RNG(6)+RNG(6)+RNG(6))}function getPersonDetails(e,t){const a=rollSuppStatus(),r=[`<b>Alignment:</b> ${rollSuppAlignment().result.map(e=>Parser.alignmentAbvToFull(e)).join(" ")}`,`<b>Occupation:</b> ${rollSuppOccupation().result}`,`<b>Relationship:</b> ${rollSuppRelationship().result}`];if(t||r.push(`<b>Status:</b> ${a.result}`),e){const e=rollSuppRace().result;r.splice(index,0,e)}return r}function rollEvtAdventure(){return _getFromTable(LIFE_EVENTS_ADVENTURES,RNG(100))}function rollEvtArcaneMatter(){return _getFromTable(LIFE_EVENTS_ARCANE_MATTERS,RNG(10))}function rollEvtBoon(){return _getFromTable(LIFE_EVENTS_BOONS,RNG(10))}function rollEvtCrime(){return _getFromTable(LIFE_EVENTS_CRIME,RNG(8))}function rollEvtPunishment(){return _getFromTable(LIFE_EVENTS_PUNISHMENT,RNG(12))}function rollEvtSupernatural(){return _getFromTable(LIFE_EVENTS_SUPERNATURAL,RNG(100))}function rollEvtTragedy(){return _getFromTable(LIFE_EVENTS_TRAGEDIES,RNG(12))}function rollEvtWar(){return _getFromTable(LIFE_EVENTS_WAR,RNG(12))}function rollEvtWeird(){return _getFromTable(LIFE_EVENTS_WEIRD_STUFF,RNG(12))}function choose(...e){return fmtChoice(rollOnArray(e))}function fmtChoice(e){return`(<span style="font-style: italic;">${e}</span>)`}function rollOnArray(e){return e[RNG(e.length)-1]}const RACES_SELECTABLE=["Dwarf","Elf","Half-Elf","Half-Orc","Tiefling"],PARENTS_HALF_ELF=[{min:1,max:5,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was an elf and the other ${fmtChoice(1===e?"father":"mother")} was a human.`},display:"One parent was an elf and the other was a human."},{min:6,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was an elf and the other ${fmtChoice(1===e?"father":"mother")} was a half-elf.`},display:"One parent was an elf and the other was a half-elf."},{min:7,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was a human and the other ${fmtChoice(1===e?"father":"mother")} was a half-elf.`},display:"One parent was a human and the other was a half-elf."},{min:8,result:"Both parents were half-elves."}],PARENTS_HALF_ORC=[{min:1,max:3,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was an orc and the other ${fmtChoice(1===e?"father":"mother")} was a human.`},display:"One parent was an orc and the other was a human."},{min:4,max:5,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was an orc and the other ${fmtChoice(1===e?"father":"mother")} was a half-orc.`},display:"One parent was an orc and the other was a half-orc."},{min:6,max:7,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was a human and the other ${fmtChoice(1===e?"father":"mother")} was a half-orc.`},display:"One parent was a human and the other was a half-orc."},{min:8,display:"Both parents were half-orcs."}],PARENTS_TIEFLING=[{min:1,max:4,display:"Both parents were humans, their infernal heritage dormant until you came along."},{min:5,max:6,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was a tiefling and the other ${fmtChoice(1===e?"father":"mother")} was a human.`},display:"One parent was a tiefling and the other was a human."},{min:7,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was a tiefling and the other ${fmtChoice(1===e?"father":"mother")} was a devil.`},display:"One parent was a tiefling and the other was a devil."},{min:8,result:()=>{const e=RNG(2);return`One parent ${fmtChoice(1===e?"mother":"father")} was a human and the other ${fmtChoice(1===e?"father":"mother")} was a devil.`},display:"One parent was a human and the other was a devil."}],BIRTHPLACES=[{min:1,max:50,result:"Home"},{min:51,max:55,result:"Home of a family friend"},{min:56,max:63,result:()=>`Home of a healer or midwife ${choose("healer","midwife")}`,display:"Home of a healer or midwife"},{min:64,max:65,result:()=>`Carriage, cart, or wagon ${choose("carriage","cart","wagon")}`,display:"Carriage, cart, or wagon"},{min:66,max:68,result:()=>`Barn, shed, or other outbuilding ${choose("barn","shed","outbuilding")}`,display:"Barn, shed, or other outbuilding"},{min:69,max:70,result:"Cave"},{min:71,max:72,result:"Field"},{min:73,max:74,result:"Forest"},{min:75,max:77,result:"Temple"},{min:78,result:"Battlefield"},{min:79,max:80,result:()=>`Alley or street ${choose("alley","street")}`,display:"Alley or street"},{min:81,max:82,result:()=>`Brothel, tavern, or inn ${choose("brothel","tavern","inn")}`,display:"Brothel, tavern, or inn"},{min:83,max:84,result:()=>`Castle, keep, tower, or palace ${choose("castle","keep","tower","palace")}`,display:"Castle, keep, tower, or palace"},{min:85,result:()=>`Sewer or rubbish heap ${choose("sewer","rubbish heap")}`,display:"Sewer or rubbish heap"},{min:86,max:88,result:"Among people of a different race"},{min:89,max:91,result:()=>`On board a boat or a ship ${choose("boat","ship")}`,display:"On board a boat or a ship"},{min:92,max:93,result:()=>`In a prison or in the headquarters of a secret organization ${choose("prison","headquarters of a secret organization")}`,display:"In a prison or in the headquarters of a secret organization"},{min:94,max:95,result:"In a sage's laboratory"},{min:96,result:"In the Feywild"},{min:97,result:"In the Shadowfell"},{min:98,result:()=>`On the Astral Plane or the Ethereal Plane ${choose("Astral Plane","Ethereal Plane")}`,display:"On the Astral Plane or the Ethereal Plane"},{min:99,result:"On an Inner Plane of your choice"},{min:100,result:"On an Outer Plane of your choice"}];function absentParent(e){return _getFromTable(ABSENT_PARENT,RNG(4)).result.replace("parent",`$& ${fmtChoice(e)}</i>`)}function absentBothParents(){const e=["mother","father"][RNG(2)-1];return`${absentParent(e)} ${absentParent(otherParent(e))}`}function otherParent(e){return"mother"===e?"father":"mother"}function singleParentOrStep(e){const t=RNG(2);return`Single ${e} or step${e} ${fmtChoice(1===t?e:`step${e}`)}. ${1===t?`${absentParent(otherParent(e))}`:absentBothParents()}`}const FAMILY=[{min:1,result:()=>`None. ${absentBothParents()}`,display:"None"},{min:2,result:()=>`Institution, such as an asylum. ${absentBothParents()}`,display:"Institution, such as an asylum"},{min:3,result:()=>`Temple. ${absentBothParents()}`,display:"Temple"},{min:4,max:5,result:()=>`Orphanage. ${absentBothParents()}`,display:"Orphanage"},{min:6,max:7,result:()=>`Guardian. ${absentBothParents()}`,display:"Guardian"},{min:8,max:15,result:()=>`Paternal or maternal aunt, uncle, or both; or extended family such as a tribe or clan ${choose("paternal uncle","maternal aunt","paternal uncle and maternal aunt","extended family such as a tribe or clan")}. ${absentBothParents()}`,display:"Paternal or maternal aunt, uncle, or both; or extended family such as a tribe or clan"},{min:16,max:25,result:()=>`Paternal or maternal grandparent(s) ${choose("paternal grandfather","maternal grandmother","paternal grandfather and maternal grandmother")}. ${absentBothParents()}`,display:"Paternal or maternal grandparent(s)"},{min:26,max:35,result:()=>`Adoptive family (same or different race) ${choose("same race","different race")}. ${absentBothParents()}`,display:"Adoptive family (same or different race)"},{min:36,max:55,result:()=>singleParentOrStep("father"),display:"Single father or stepfather"},{min:56,max:75,result:()=>singleParentOrStep("mother"),display:"Single mother or stepmother"},{min:76,max:100,result:"Mother and father"}],ABSENT_PARENT=[{min:1,result:()=>`Your parent died (${rollSuppDeath().result.lowercaseFirst()}).`,display:"Your parent died (roll on the Cause of Death supplemental table)."},{min:2,result:()=>`Your parent was imprisoned, enslaved, or otherwise taken away ${choose("imprisoned","enslaved","otherwise taken away")}.`,display:"Your parent was imprisoned, enslaved, or otherwise taken away."},{min:3,result:"Your parent abandoned you."},{min:4,result:"Your parent disappeared to an unknown fate."}],FAMILY_LIFESTYLE=[{min:3,result:"Wretched (-40)",modifier:-40},{min:4,max:5,result:"Squalid (-20)",modifier:-20},{min:6,max:8,result:"Poor (-10)",modifier:-10},{min:9,max:12,result:"Modest (+0)",modifier:0},{min:13,max:15,result:"Comfortable (+10)",modifier:10},{min:16,max:17,result:"Wealthy (+20)",modifier:20},{min:18,result:"Aristocratic (+40)",modifier:40}],CHILDHOOD_HOME=[{min:0,result:"On the streets"},{min:1,max:20,result:"Rundown shack"},{min:21,max:30,result:"No permanent residence; you moved around a lot"},{min:31,max:40,result:()=>`Encampment or village ${choose("encampment","village")} in the wilderness`,display:"Encampment or village in the wilderness"},{min:41,max:50,result:"Apartment in a rundown neighborhood"},{min:51,max:70,result:"Small house"},{min:71,max:90,result:"Large house"},{min:91,max:110,result:"Mansion"},{min:111,result:`Palace or castle ${choose("palace","castle")}`,display:"Palace or castle"}],CHILDHOOD_MEMORIES=[{min:3,result:"I am still haunted by my childhood, when I was treated badly by my peers."},{min:4,max:5,result:"I spent most of my childhood alone, with no close friends."},{min:6,max:8,result:"Others saw me as being different or strange, and so I had few companions."},{min:9,max:12,result:"I had a few close friends and lived an ordinary childhood."},{min:13,max:15,result:"I had several friends, and my childhood was generally a happy one."},{min:16,max:17,result:"I always found it easy to make friends, and I loved being around people."},{min:18,result:"Everyone knew who I was, and I had friends everywhere I went."}],LIFE_EVENTS_AGE=[{min:1,max:20,age:()=>RNG(20),result:"20 years or younger",events:1},{min:21,max:59,age:()=>RNG(10)+20,result:"21—30 years",events:()=>RNG(4)},{min:60,max:69,age:()=>RNG(10)+30,result:"31—40 years",events:()=>RNG(6)},{min:70,max:89,age:()=>RNG(10)+40,result:"41—50 years",events:()=>RNG(8)},{min:90,max:99,age:()=>RNG(10)+50,result:"51—60 years",events:()=>RNG(10)},{min:100,age:()=>RNG(690)+60,result:"61 years or older",events:()=>RNG(12)}];function _lifeEvtResult(e,t){const a={result:`${e}: ${t.result}`};return t.nextRoll&&(a.nextRoll=t.nextRoll),a}function _lifeEvtResultArr(e,t,...a){return{title:e,result:t.map((e,t)=>`${e}: ${a[t].result}`)}}let marriageIndex=0;function _lifeEvtPerson(e,t){return{title:e,result:t}}const LIFE_EVENTS=[{min:1,max:10,result:"You suffered a tragedy. Roll on the Tragedies table.",nextRoll:()=>_lifeEvtResult("Tragedy",rollEvtTragedy())},{min:11,max:20,result:"You gained a bit of good fortune. Roll on the Boons table.",nextRoll:()=>_lifeEvtResult("Boon",rollEvtBoon())},{min:21,max:30,result:"You fell in love or got married. If you get this result more than once, you can choose to have a child instead. Work with your DM to determine the identity of your love interest.",nextRoll:()=>_lifeEvtPerson(0==marriageIndex++?"Spouse":"Spouse/Child",getPersonDetails())},{min:31,max:40,result:`You made an enemy of an adventurer. Roll a d6 ${fmtChoice(RNG(6))}. An odd number indicates you are to blame for the rift, and an even number indicates you are blameless. Use the supplemental tables and work with your DM to determine this hostile character's identity and the danger this enemy poses to you.`,display:"You made an enemy of an adventurer. Roll a d6. An odd number indicates you are to blame for the rift, and an even number indicates you are blameless. Use the supplemental tables and work with your DM to determine this hostile character's identity and the danger this enemy poses to you.",nextRoll:()=>_lifeEvtPerson("Enemy",getPersonDetails())},{min:41,max:50,result:"You made a friend of an adventurer. Use the supplemental tables and work with your DM to add more detail to this friendly character and establish how your friendship began.",nextRoll:()=>_lifeEvtPerson("Friend",getPersonDetails())},{min:51,max:70,result:`You spent time working in a job related to your background. Start the game with an extra 2d6 ${fmtChoice(RNG(6)+RNG(6))} gp.`,display:"You spent time working in a job related to your background. Start the game with an extra 2d6 gp."},{min:71,max:75,result:"You met someone important. Use the supplemental tables to determine this character's identity and how this individual feels about you. Work out additional details with your DM as needed to fit this character into your backstory.",nextRoll:()=>_lifeEvtPerson("Meeting",getPersonDetails())},{min:76,max:80,result:"You went on an adventure. Roll on the Adventures table to see what happened to you. Work with your DM to determine the nature of the adventure and the creatures you encountered.",nextRoll:()=>_lifeEvtResult("Adventure",rollEvtAdventure())},{min:81,max:85,result:"You had a supernatural experience. Roll on the Supernatural Events table to find out what it was.",nextRoll:()=>_lifeEvtResult("Supernatural Experience",rollEvtSupernatural())},{min:86,max:90,result:"You fought in a battle. Roll on the War table to learn what happened to you. Work with your DM to come up with the reason for the battle and the factions involved. It might have been a small conflict between your community and a band of orcs, or it could have been a major battle in a larger war.",nextRoll:()=>_lifeEvtResult("War",rollEvtWar())},{min:91,max:95,result:"You committed a crime or were wrongly accused of doing so. Roll on the Crime table to determine the nature of the offense and on the Punishment table to see what became of you.",nextRoll:()=>_lifeEvtResultArr("Crime and Punishment",["Crime","Punishment"],rollEvtCrime(),rollEvtPunishment())},{min:96,max:99,result:"You encountered something magical. Roll on the Arcane Matters table.",nextRoll:()=>_lifeEvtResult("Arcane Matter",rollEvtArcaneMatter())},{min:100,result:"Something truly strange happened to you. Roll on the Weird Stuff table.",nextRoll:()=>_lifeEvtResult("Weird Stuff",rollEvtWeird())}],LIFE_EVENTS_ADVENTURES=[{min:1,max:10,result:`You nearly died. You have nasty scars on your body, and you are missing an ear, 1d3 ${fmtChoice(RNG(3))} fingers, or 1d4 ${fmtChoice(RNG(4))} toes.`,display:"You nearly died. You have nasty scars on your body, and you are missing an ear, 1d3 fingers, or 1d4 toes."},{min:11,max:20,result:"You suffered a grievous injury. Although the wound healed, it still pains you from time to time."},{min:21,max:30,result:"You were wounded, but in time you fully recovered."},{min:31,max:40,result:"You contracted a disease while exploring a filthy warren. You recovered from the disease, but you have a persistent cough, pockmarks on your skin, or prematurely gray hair."},{min:41,max:50,result:"You were poisoned by a trap or a monster. You recovered, but the next time you must make a saving throw against poison, you make the saving throw with disadvantage."},{min:51,max:60,result:"You lost something of sentimental value to you during your adventure. Remove one trinket from your possessions."},{min:61,max:70,result:"You were terribly frightened by something you encountered and ran away, abandoning your companions to their fate."},{min:71,max:80,result:"You learned a great deal during your adventure. The next time you make an ability check or a saving throw, you have advantage on the roll."},{min:81,max:90,result:`You found some treasure on your adventure. You have 2d6 ${fmtChoice(RNG(6)+RNG(6))} gp left from your share of it.`,display:"You found some treasure on your adventure. You have 2d6 gp left from your share of it."},{min:91,max:99,result:`You found a considerable amount of treasure on your adventure. You have 1d20 + 50 ${fmtChoice(RNG(20)+50)} gp left from your share of it.`,display:"You found a considerable amount of treasure on your adventure. You have 1d20 + 50 gp left from your share of it."},{min:100,result:"You came across a common magic item (of the DM's choice)."}],LIFE_EVENTS_ARCANE_MATTERS=[{min:1,result:"You were charmed or frightened by a spell."},{min:2,result:"You were injured by the effect of a spell."},{min:3,result:"You witnessed a powerful spell being cast by a cleric, a druid, a sorcerer, a warlock, or a wizard."},{min:4,result:"You drank a potion (of the DM's choice)."},{min:5,result:"You found a spell scroll (of the DM's choice) and succeeded in casting the spell it contained."},{min:6,result:"You were affected by teleportation magic."},{min:7,result:"You turned invisible for a time."},{min:8,result:"You identified an illusion for what it was."},{min:9,result:"You saw a creature being conjured by magic."},{min:10,result:()=>`Your fortune was read by a diviner. Roll twice on the Life Events table, but don't apply the results. Instead, the DM picks one event as a portent of your future (which might or might not come true). ${fmtChoice(_getFromTable(LIFE_EVENTS,RNG(100)).display||_getFromTable(LIFE_EVENTS,RNG(100)).result)} ${fmtChoice(_getFromTable(LIFE_EVENTS,RNG(100)).display||_getFromTable(LIFE_EVENTS,RNG(100)).result)}`,display:"Your fortune was read by a diviner. Roll twice on the Life Events table, but don't apply the results. Instead, the DM picks one event as a portent of your future (which might or might not come true)."}],LIFE_EVENTS_BOONS=[{min:1,result:"A friendly wizard gave you a spell scroll containing one cantrip (of the DM's choice)."},{min:2,result:"You saved the life of a commoner, who now owes you a life debt. This individual accompanies you on your travels and performs mundane tasks for you, but will leave if neglected, abused, or imperiled. Determine details about this character by using the supplemental tables and working with your DM."},{min:3,result:"You found a riding horse."},{min:4,result:()=>`You found some money. You have 1d20 ${fmtChoice(RNG(20))} gp in addition to your regular starting funds.`,display:"You found some money. You have 1d20 gp in addition to your regular starting funds."},{min:5,result:"A relative bequeathed you a simple weapon of your choice."},{min:6,result:()=>`You found something interesting. You gain one additional trinket ${fmtChoice(rollTrinket())}.`,display:"You found something interesting. You gain one additional trinket."},{min:7,result:"You once performed a service for a local temple. The next time you visit the temple, you can receive healing up to your hit point maximum."},{min:8,result:"A friendly alchemist gifted you with a potion of healing or a flask of acid, as you choose."},{min:9,result:"You found a treasure map."},{min:10,result:()=>`A distant relative left you a stipend that enables you to live at the comfortable lifestyle for 1d20 ${fmtChoice(RNG(20))} years. If you choose to live at a higher lifestyle, you reduce the price of the lifestyle by 2 gp during that time period.`,display:"A distant relative left you a stipend that enables you to live at the comfortable lifestyle for 1d20 years. If you choose to live at a higher lifestyle, you reduce the price of the lifestyle by 2 gp during that time period."}],LIFE_EVENTS_CRIME=[{min:1,result:"Murder"},{min:2,result:"Theft"},{min:3,result:"Burglary"},{min:4,result:"Assault"},{min:5,result:"Smuggling"},{min:6,result:"Kidnapping"},{min:7,result:"Extortion"},{min:8,result:"Counterfeiting"}],LIFE_EVENTS_PUNISHMENT=[{min:1,max:3,result:"You did not commit the crime and were exonerated after being accused."},{min:4,max:6,result:"You committed the crime or helped do so, but nonetheless the authorities found you not guilty."},{min:7,max:8,result:"You were nearly caught in the act. You had to flee and are wanted in the community where the crime occurred."},{min:9,max:12,result:()=>`You were caught and convicted. You spent time in jail, chained to an oar, or performing hard labor. You served a sentence of 1d4 years ${fmtChoice(RNG(4))} or succeeded in escaping after that much time.`,display:"You were caught and convicted. You spent time in jail, chained to an oar, or performing hard labor. You served a sentence of 1d4 years or succeeded in escaping after that much time."}],LIFE_EVENTS_SUPERNATURAL=[{min:1,max:5,result:()=>`You were ensorcelled by a fey and enslaved for 1d6 ${fmtChoice(RNG(6))} years before you escaped.`,display:"You were ensorcelled by a fey and enslaved for 1d6 years before you escaped."},{min:6,max:10,result:"You saw a demon and ran away before it could do anything to you."},{min:11,max:15,result:()=>`A devil tempted you. Make a DC 10 Wisdom saving throw. On a failed save, your alignment shifts one step toward evil (if it's not evil already), and you start the game with an additional 1d20 + 50 ${fmtChoice(RNG(20)+50)} gp.`,display:"A devil tempted you. Make a DC 10 Wisdom saving throw. On a failed save, your alignment shifts one step toward evil (if it's not evil already), and you start the game with an additional 1d20 + 50 gp."},{min:16,max:20,result:"You woke up one morning miles from your home, with no idea how you got there."},{min:21,max:30,result:"You visited a holy site and felt the presence of the divine there."},{min:31,max:40,result:"You witnessed a falling red star, a face appearing in the frost, or some other bizarre happening. You are certain that it was an omen of some sort."},{min:41,max:50,result:"You escaped certain death and believe it was the intervention of a god that saved you."},{min:51,max:60,result:"You witnessed a minor miracle."},{min:61,max:70,result:"You explored an empty house and found it to be haunted."},{min:71,max:75,result:()=>{const e=RNG(6);return`You were briefly possessed. Roll a d6 to determine what type of creature possessed you: 1, celestial; 2, devil; 3, demon; 4, fey; 5, elemental; 6, undead ${fmtChoice(`${e}; ${["celestial","devil","demon","fey","elemental","undead"][e-1]}`)}.`},display:"You were briefly possessed. Roll a d6 to determine what type of creature possessed you: 1, celestial; 2, devil; 3, demon; 4, fey; 5, elemental; 6, undead."},{min:76,max:80,result:"You saw a ghost."},{min:81,max:85,result:"You saw a ghoul feeding on a corpse."},{min:86,max:90,result:"A celestial or a fiend visited you in your dreams to give a warning of dangers to come."},{min:91,max:95,result:()=>`You briefly visited the Feywild or the Shadowfell ${choose("Feywild","Shadowfell")}.`,results:"You briefly visited the Feywild or the Shadowfell."},{min:96,max:100,result:"You saw a portal that you believe leads to another plane of existence."}],LIFE_EVENTS_TRAGEDIES=[{min:1,max:2,result:()=>"A family member or a close friend died. Roll on the Cause of Death supplemental table to find out how.",display:"A family member or a close friend died. Roll on the Cause of Death supplemental table to find out how.",nextRoll:()=>_lifeEvtResult("Cause of Death",rollSuppDeath())},{min:3,result:"A friendship ended bitterly, and the other person is now hostile to you. The cause might have been a misunderstanding or something you or the former friend did."},{min:4,result:"You lost all your possessions in a disaster, and you had to rebuild your life."},{min:5,result:()=>`You were imprisoned for a crime you didn't commit and spent 1d6 ${fmtChoice(RNG(6))} years at hard labor, in jail, or shackled to an oar in a slave galley.`,display:"You were imprisoned for a crime you didn't commit and spent 1d6 years at hard labor, in jail, or shackled to an oar in a slave galley."},{min:6,result:"War ravaged your home community, reducing everything to rubble and ruin. In the aftermath, you either helped your town rebuild or moved somewhere else."},{min:7,result:"A lover disappeared without a trace. You have been looking for that person ever since."},{min:8,result:"A terrible blight in your home community caused crops to fail, and many starved. You lost a sibling or some other family member."},{min:9,result:"You did something that brought terrible shame to you in the eyes of your family. You might have been involved in a scandal, dabbled in dark magic, or offended someone important. The attitude of your family members toward you becomes indifferent at best, though they might eventually forgive you."},{min:10,result:"For a reason you were never told, you were exiled from your community. You then either wandered in the wilderness for a time or promptly found a new place to live."},{min:11,result:()=>`A romantic relationship ended. Roll a d6 ${fmtChoice(RNG(6))}. An odd number means it ended with bad feelings, while an even number means it ended amicably.`,display:"A romantic relationship ended. Roll a d6. An odd number means it ended with bad feelings, while an even number means it ended amicably."},{min:12,result:()=>"A current or prospective romantic partner of yours died. Roll on the Cause of Death supplemental table to find out how. If the result is murder, roll a d12. On a 1, you were responsible, whether directly or indirectly.",display:"A current or prospective romantic partner of yours died. Roll on the Cause of Death supplemental table to find out how. If the result is murder, roll a d12. On a 1, you were responsible, whether directly or indirectly.",nextRoll:()=>{const e=RNG(12);return`${_getFromTable(SUPP_DEATH,e).result}${2===e&&1===RNG(12)?` ${fmtChoice("you were responsible")}`:""}`}}],LIFE_EVENTS_WAR=[{min:1,result:"You were knocked out and left for dead. You woke up hours later with no recollection of the battle."},{min:2,max:3,result:"You were badly injured in the fight, and you still bear the awful scars of those wounds."},{min:4,result:"You ran away from the battle to save your life, but you still feel shame for your cowardice."},{min:5,max:7,result:"You suffered only minor injuries, and the wounds all healed without leaving scars."},{min:8,max:9,result:"You survived the battle, but you suffer from terrible nightmares in which you relive the experience."},{min:10,max:11,result:"You escaped the battle unscathed, though many of your friends were injured or lost."},{min:12,result:"You acquitted yourself well in battle and are remembered as a hero. You might have received a medal for your bravery."}],LIFE_EVENTS_WEIRD_STUFF=[{min:1,result:()=>`You were turned into a toad and remained in that form for 1d4 ${fmtChoice(RNG(4))} weeks.`,display:"You were turned into a toad and remained in that form for 1d4 weeks."},{min:2,result:"You were petrified and remained a stone statue for a time until someone freed you."},{min:3,result:()=>`You were enslaved by a hag, a satyr, or some other being and lived in that creature's thrall for 1d6 ${fmtChoice(RNG(6))} years.`,display:"You were enslaved by a hag, a satyr, or some other being and lived in that creature’s thrall for 1d6 years."},{min:4,result:()=>`A dragon held you as a prisoner for 1d4 ${fmtChoice(RNG(4))} months until adventurers killed it.`,display:"A dragon held you as a prisoner for 1d4 months until adventurers killed it."},{min:5,result:"You were taken captive by a race of evil humanoids such as drow, kuo-toa, or quaggoths. You lived as a slave in the Underdark until you escaped."},{min:6,result:"You served a powerful adventurer as a hireling. You have only recently left that service. Use the supplemental tables and work with your DM to determine the basic details about your former employer."},{min:7,result:()=>`You went insane for 1d6 ${fmtChoice(RNG(6))} years and recently regained your sanity. A tic or some other bit of odd behavior might linger.`,display:"You went insane for 1d6 years and recently regained your sanity. A tic or some other bit of odd behavior might linger."},{min:8,result:"A lover of yours was secretly a silver dragon."},{min:9,result:"You were captured by a cult and nearly sacrificed on an altar to the foul being the cultists served. You escaped, but you fear they will find you."},{min:10,result:()=>`You met a demigod, an archdevil, an archfey, a demon lord, or a titan, ${choose("demigod","archdevil","archfey","demon lord","titan")} and you lived to tell the tale.`,display:"You met a demigod, an archdevil, an archfey, a demon lord, or a titan, and you lived to tell the tale."},{min:11,result:"You were swallowed by a giant fish and spent a month in its gullet before you escaped."},{min:12,result:()=>"A powerful being granted you a wish, but you squandered it on something frivolous.",display:"A powerful being granted you a wish, but you squandered it on something frivolous."}],SUPP_ALIGNMENT=[{min:1,max:3,result:()=>1===RNG(2)?["C","E"]:["C","N"],display:"Chaotic evil (50%) or chaotic neutral (50%)"},{min:4,max:5,result:["L","E"],display:"Lawful evil"},{min:6,max:8,result:["N","E"],display:"Neutral evil"},{min:9,max:12,result:["N"],display:"Neutral"},{min:13,max:15,result:["N","G"],display:"Neutral good"},{min:16,max:17,result:()=>1===RNG(2)?["L","G"]:["L","N"],display:"Lawful good (50%) or lawful neutral (50%)"},{min:18,result:()=>1===RNG(2)?["C","G"]:["C","N"],display:"Chaotic good (50%) or chaotic neutral (50%)"}],SUPP_DEATH=[{min:1,result:"Cause unknown"},{min:2,result:"Murdered"},{min:3,result:"Killed in battle"},{min:4,result:"Accident related to class or occupation"},{min:5,result:"Accident unrelated to class or occupation"},{min:6,max:7,result:"Natural causes, such as disease or old age"},{min:8,result:"Apparent suicide"},{min:9,result:()=>`Torn apart by an animal or a natural disaster ${choose("animal","natural disaster")}`,display:"Torn apart by an animal or a natural disaster"},{min:10,result:()=>"Consumed by a monster"},{min:11,result:()=>`Executed for a crime or tortured to death ${choose("executed for a crime","tortured to death")}`,display:"Executed for a crime or tortured to death"},{min:12,result:"Bizarre event, such as being hit by a meteorite, struck down by an angry god, or killed by a hatching slaad egg"}],SUPP_CLASS=[{min:1,max:7,result:"Barbarian"},{min:8,max:14,result:"Bard"},{min:15,max:29,result:"Cleric"},{min:30,max:36,result:"Druid"},{min:37,max:52,result:"Fighter"},{min:53,max:58,result:"Monk"},{min:59,max:64,result:"Paladin"},{min:65,max:70,result:"Ranger"},{min:71,max:84,result:"Rogue"},{min:85,max:89,result:"Sorcerer"},{min:90,max:94,result:"Warlock"},{min:95,max:100,result:"Wizard"}],SUPP_OCCUPATION=[{min:1,max:5,result:"Academic"},{min:6,max:10,result:()=>`Adventurer (${rollSuppClass().result})`,display:"Adventurer (roll on the Class table)"},{min:11,result:"Aristocrat"},{min:12,max:26,result:()=>`Artisan or guild member ${choose("artisan","guild member")}`,display:"Artisan or guild member"},{min:27,max:31,result:"Criminal"},{min:32,max:36,result:"Entertainer"},{min:37,max:38,result:()=>`Exile, hermit, or refugee ${choose("exile","hermit","refugee")}`,display:"Exile, hermit, or refugee"},{min:39,max:43,result:()=>`Explorer or wanderer ${choose("explorer","wanderer")}`,display:"Explorer or wanderer"},{min:44,max:55,result:()=>`Farmer or herder ${choose("farmer","herder")}`,display:"Farmer or herder"},{min:56,max:60,result:()=>`Hunter or trapper ${choose("hunter","trapper")}`,display:"Hunter or trapper"},{min:61,max:75,result:"Laborer"},{min:76,max:80,result:"Merchant"},{min:81,max:85,result:()=>`Politician or bureaucrat ${choose("politician","bureaucrat")}`,display:"Politician or bureaucrat"},{min:86,max:90,result:"Priest"},{min:91,max:95,result:"Sailor"},{min:96,max:100,result:"Soldier"}],SUPP_RACE=[{min:1,max:40,result:"Human"},{min:41,max:50,result:"Dwarf"},{min:51,max:60,result:"Elf"},{min:61,max:70,result:"Halfling"},{min:71,max:75,result:"Dragonborn"},{min:76,max:80,result:"Gnome"},{min:81,max:85,result:"Half-elf"},{min:86,max:90,result:"Half-orc"},{min:91,max:95,result:"Tiefling"},{min:96,max:100,result:"DM’s choice"}],SUPP_RELATIONSHIP=[{min:3,max:4,result:"Hostile"},{min:5,max:10,result:"Friendly"},{min:11,max:12,result:"Indifferent"}],SUPP_STATUS=[{min:3,result:()=>`Dead (${rollSuppDeath().result.lowercaseFirst()})`,display:"Dead (roll on the Cause of Death table)",dead:!0},{min:4,max:5,result:()=>`Missing or status unknown ${choose("missing","status unknown")}`,display:"Missing or status unknown"},{min:6,max:8,result:()=>`Alive, but doing poorly due to injury, financial trouble, or relationship difficulties ${choose("injury","financial trouble","relationship difficulties")}`,display:"Alive, but doing poorly due to injury, financial trouble, or relationship difficulties"},{min:9,max:12,result:"Alive and well"},{min:13,max:15,result:"Alive and quite successful"},{min:16,max:17,result:"Alive and infamous"},{min:18,result:"Alive and famous"}];let classList,bgList,trinketList,$selCha,$selRace,$selBg,$selClass;function rollTrinket(){return rollOnArray(trinketList)}function onJsonLoad(e){bgList=e.lifeBackground.sort((e,t)=>SortUtil.ascSort(e.name,t.name)),classList=e.lifeClass.sort((e,t)=>SortUtil.ascSort(e.name,t.name)),trinketList=e.lifeTrinket,$selRace=$("#race"),$selCha=$("#cha"),$selBg=$("#background"),$selClass=$("#class"),$selRace.append('<option value="Random" selected>Random</option>'),$selRace.append('<option value="Other">Other</option>'),RACES_SELECTABLE.forEach(e=>$selRace.append(`<option value="${e}">${e}</option>`));for(let e=-5;e<=5;++e)$selCha.append(`<option value="${e}" ${0===e?"selected":""}>${e>=0?"+":""}${e}</option>`);$selBg.append('<option value="-1" selected>Random</option>'),bgList.forEach((e,t)=>$selBg.append(`<option value="${t}">${e.name}</option>`)),$selClass.append('<option value="-1" selected>Random</option>'),classList.forEach((e,t)=>$selClass.append(`<option value="${t}">${e.name}</option>`))}function concatSentences(...e){const t=[];return e.filter(e=>e).forEach(e=>{"string"==typeof e||"number"==typeof e?t.push(e):"function"==typeof e?t.push(e()):Array.prototype.push.apply(t,...e)}),joinParaList(t)}function joinParaList(e){return e.join("<br>")}window.onload=function(){DataUtil.loadJSON(JSON_URL).then(onJsonLoad)};const _VOWELS=["a","e","i","o","u"];function addN(e){const t=e[0].toLowerCase();return _VOWELS.includes(t)?"n":""}let knowParents,race;function sectParents(){knowParents=RNG(100)>5;const e=$selRace.val();race="Random"===e?_getFromTable(SUPP_RACE,RNG(100)).result:e;const t=$("#parents"),a=knowParents?"<b>Parents:</b> You know who your parents are or were.":"<b>Parents:</b> You do not know who your parents were.";let r=null;if(knowParents)switch(race){case"Half-elf":r=`<b>${race} parents:</b> ${_getFromTable(PARENTS_HALF_ELF,RNG(8)).result}`;break;case"Half-orc":r=`<b>${race} parents:</b> ${_getFromTable(PARENTS_HALF_ORC,RNG(8)).result}`;break;case"Tiefling":r=`<b>${race} parents:</b> ${_getFromTable(PARENTS_TIEFLING,RNG(8)).result}`}if(t.html(concatSentences(`<b>Race:</b> ${race}${"Random"===e?` ${fmtChoice("generated using the Supplemental Race table")}`:""}`,a,r)),knowParents){const e=getPersonDetails(!1,!0),a=getPersonDetails(!1,!0);t.append("<h5>Mother</h5>"),t.append(joinParaList(e)),t.append("<h5>Father</h5>"),t.append(joinParaList(a))}}function sectBirthplace(){const e=$("#birthplace"),t=RNG(100),a=`<b>Birthplace:</b> ${_getFromTable(BIRTHPLACES,t).result}`,r=100===RNG(100)?"A strange event coincided with your birth: the moon briefly turning red, all the milk within a mile spoiling, the water in the area freezing solid in midsummer, all the iron in the home rusting or turning to silver, or some other unusual event of your choice":"";e.html(concatSentences(a,r))}function sectSiblings(){const e=$("#siblings");function t(){const e=RNG(6)+RNG(6);return e<3?"Twin, triplet, or quadruplet":e<8?"Older":"Younger"}let a=0;switch(RNG(5)){case 2:a=RNG(3);break;case 3:a=RNG(4)+1;break;case 4:a=RNG(6)+2;break;case 5:a=RNG(8)+3}if("Elf"!==race&&"Dwarf"!==race||(a=Math.max(a-2,0)),a>0){e.empty(),e.append(`<p>You have ${a} sibling${a>1?"s":""}.</p>`);for(let r=0;r<a;++r)e.append(`<h5>${t()} sibling ${choose("brother","sister")}</h5>`),e.append(joinParaList(getPersonDetails()))}else e.html("You are an only child.")}function sectFamily(){const e=$("#family");e.empty(),e.append(`<b>Family:</b> ${_getFromTable(FAMILY,RNG(100)).result}<br>`);let t=1;const a=$('<button class="btn btn-xs btn-default btn-supp-fam noprint"></button>').on("click",()=>{const e=getPersonDetails(),r=$('<div class="output-wrp-border"/>');r.append(`<h5>Family Member Roll ${t++}</h5>`),r.append(joinParaList(e)),a.css("margin-bottom",5),a.after(r)});e.append('<span class="note">You can roll on the Relationship table to determine how your family members or other important figures in your life feel about you. You can also use the Race, Occupation, and Alignment tables to learn more about the family members or guardians who raised you.</span>'),e.append(a);const r=_getFromTable(FAMILY_LIFESTYLE,RNG(6)+RNG(6)+RNG(6));e.append(`<b>Family lifestyle:</b> ${r.result}<br>`);const n=Math.min(Math.max(RNG(100)+r.modifier,0),111),o=_getFromTable(CHILDHOOD_HOME,n).result;e.append(`<b>Childhood Home:</b> ${o}<br>`);const i=Math.min(Math.max(RNG(6)+RNG(6)+RNG(6)+Number($selCha.val()),3),18);e.append(`<b>Childhood memories</b>: ${_getFromTable(CHILDHOOD_MEMORIES,i).result}`)}function sectPersonalDecisions(){const e=$("#personal").empty(),t=Number($selBg.val()),a=-1===t?rollOnArray(bgList):bgList[t];e.append(`<b>Background:</b> ${a.name}<br>`),e.append(`<b>I became a${addN(a.name)} ${a.name} because:</b> ${rollOnArray(a.reasons)}`)}function sectClassTraining(){const e=$("#clss").empty(),t=Number($selClass.val()),a=-1===t?rollOnArray(classList):classList[t];e.append(`<b>Class:</b> ${a.name}<br>`),e.append(`<b>I became a${addN(a.name)} ${a.name} because:</b> ${rollOnArray(a.reasons)}`)}function sectLifeEvents(){const e=$("#events").empty();marriageIndex=0;const t=$("#age"),a=_getFromTable(LIFE_EVENTS_AGE,Number(t.val())||RNG(100));e.append(`<b>Current age:</b> ${a.result} ${fmtChoice(`${a.age} year${a.age>1?"s":""} old`)}`);for(let t=0;t<a.events;++t){e.append(`<h5>Life Event ${t+1}</h5>`);const a=_getFromTable(LIFE_EVENTS,RNG(100));if(e.append(`${a.result}<br>`),a.nextRoll)if(a.nextRoll.title){const t=$('<div class="output-wrp-border"/>');t.append(`<h5>${a.nextRoll.title}</h5>`),t.append(joinParaList(a.nextRoll.result)),e.append(t)}else e.append(`${a.nextRoll.result}<br>`),a.nextRoll.nextRoll&&e.append(`${a.nextRoll.nextRoll.result}<br>`)}}function roll(){$(".output").show(),sectParents(),sectBirthplace(),sectSiblings(),sectFamily(),sectPersonalDecisions(),sectClassTraining(),sectLifeEvents()}window.addEventListener("load",()=>{$("#age").on("change",function(){$(this).val()?$(this).addClass("italic"):$(this).removeClass("italic")})});