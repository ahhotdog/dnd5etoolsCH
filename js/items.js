"use strict";function rarityValue(t){return"Rare"===t?3:"None"===t?0:"Uncommon"===t?2:"Very Rare"===t?4:"Legendary"===t?5:"Artifact"===t?6:"Unknown"===t?7:"Common"===t?1:0}function sortItems(t,e,i){return"name"===i.valueName?e._values.name.toLowerCase()>t._values.name.toLowerCase()?1:-1:"type"===i.valueName?e._values.type===t._values.type?SortUtil.compareNames(t,e):e._values.type.toLowerCase()>t._values.type.toLowerCase()?1:-1:"source"===i.valueName?e._values.source===t._values.source?SortUtil.compareNames(t,e):e._values.source.toLowerCase()>t._values.source.toLowerCase()?1:-1:"rarity"===i.valueName?e._values.rarity===t._values.rarity?SortUtil.compareNames(t,e):rarityValue(e._values.rarity)>rarityValue(t._values.rarity)?1:-1:"count"===i.valueName?SortUtil.ascSort(Number(t.values().count),Number(e.values().count)):"weight"===i.valueName?SortUtil.ascSort(Number(t.values().weight),Number(e.values().weight)):"cost"===i.valueName?SortUtil.ascSort(Number(t.values().cost),Number(e.values().cost)):0}function deselectFilter(t,...e){return function(i){if(window.location.hash.length&&!window.location.hash.startsWith(`#${HASH_BLANK}`)){const s=History.getSelectedListElement();if(!s)return n();const a=itemList[s.attr("id")][t];return e.includes(a)?n():e.includes(i)&&a!==i}return n();function n(){return e.includes(i)}}}let mundanelist,magiclist;window.onload=function(){ExcludeUtil.initialise(),EntryRenderer.item.buildList(t=>{populateTablesAndFilters(t)},{},!0)};const sourceFilter=getSourceFilter(),typeFilter=new Filter({header:"Type",deselFn:deselectFilter("type","$","Futuristic","Modern","Renaissance")}),tierFilter=new Filter({header:"Tier",items:["None","Minor","Major"]}),propertyFilter=new Filter({header:"Property",displayFn:StrUtil.uppercaseFirst});let filterBox;function populateTablesAndFilters(t){const e=new Filter({header:"Rarity",items:["None","Common","Uncommon","Rare","Very Rare","Legendary","Artifact","Unknown"]}),i=new Filter({header:"Attunement",items:["Yes","By...","Optional","No"]}),n=new Filter({header:"Category",items:["Basic","Generic Variant","Specific Variant","Other"],deselFn:deselectFilter("category","Specific Variant")}),s=new Filter({header:"Miscellaneous",items:["Cursed","Magic","Mundane","Sentient"]});filterBox=initFilterBox(sourceFilter,typeFilter,tierFilter,e,propertyFilter,i,n,s);mundanelist=ListUtil.search({valueNames:["name","type","cost","weight","source"],listClass:"mundane",sortClass:"none"});magiclist=ListUtil.search({valueNames:["name","type","weight","rarity","source"],listClass:"magic",sortClass:"none"});const a=$(".ele-mundane"),r=$(".ele-magic");function o(t,e){0===t.visibleItems.length?e.hide():e.show()}mundanelist.on("updated",()=>{o(mundanelist,a),filterBox.setCount(mundanelist.visibleItems.length+magiclist.visibleItems.length,mundanelist.items.length+magiclist.items.length)}),magiclist.on("updated",()=>{o(magiclist,r),filterBox.setCount(mundanelist.visibleItems.length+magiclist.visibleItems.length,mundanelist.items.length+magiclist.items.length)}),$(filterBox).on(FilterBox.EVNT_VALCHANGE,handleFilterChange),$("#filtertools-mundane").find("button.sort").off("click").on("click",function(t){t.stopPropagation(),$(this).data("sortby","asc"===$(this).data("sortby")?"desc":"asc"),mundanelist.sort($(this).data("sort"),{order:$(this).data("sortby"),sortFunction:sortItems})}),$("#filtertools-magic").find("button.sort").on("click",function(t){t.stopPropagation(),$(this).data("sortby","asc"===$(this).data("sortby")?"desc":"asc"),magiclist.sort($(this).data("sort"),{order:$(this).data("sortby"),sortFunction:sortItems})}),$("#itemcontainer").find("h3").not(":has(input)").click(function(){"500px"!==$(this).next("ul.list").css("max-height")?$(this).next("ul.list").animate({maxHeight:"500px",display:"block"}).siblings("ul.list").animate({maxHeight:"0",display:"none"}):$(this).siblings("ul.list").animate({maxHeight:"250px",display:"block"})}),RollerUtil.addListRollButton(),addListShowHide();ListUtil.initSublist({valueNames:["name","weight","price","count","id"],listClass:"subitems",sortFunction:sortItems,getSublistRow:getSublistItem,onUpdate:onSublistChange});ListUtil.initGenericAddable(),addItems(t),BrewUtil.pAddBrewData().then(handleBrew).catch(BrewUtil.purgeBrew).then(()=>{BrewUtil.makeBrewButton("manage-brew"),BrewUtil.bind({lists:[mundanelist,magiclist],filterBox:filterBox,sourceFilter:sourceFilter}),ListUtil.loadState(),History.init(!0)})}function handleBrew(t){(t.itemProperty||[]).forEach(t=>EntryRenderer.item._addProperty(t)),(t.itemType||[]).forEach(t=>EntryRenderer.item._addType(t)),addItems(t.item)}let itemList=[],itI=0;function addItems(t){if(!t||!t.length)return;itemList=itemList.concat(t);const e={mundane:"",magic:""};for(;itI<itemList.length;itI++){const t=itemList[itI];if(ExcludeUtil.isExcluded(t.name,"item",t.source))continue;if(t.noDisplay)continue;t._isEnhanced||EntryRenderer.item.enhanceItem(t);const i=t.name,n=t.rarity,s=t.category,a=t.source,r=Parser.sourceJsonToAbv(a),o=Parser.sourceJsonToFull(a),l=[];l.push(t.tier?t.tier:"None"),t._fTier=l,t._fProperties=t.property?t.property.map(e=>t._allPropertiesPtr[e].name).filter(t=>t):[],t._fMisc=t.sentient?["Sentient"]:[],t.curse&&t._fMisc.push("Cursed");const c="None"===n||"Unknown"===n||"Basic"===s;t._fMisc.push(c?"Mundane":"Magic"),c?e.mundane+=`\n\t\t\t<li class="row" ${FLTR_ID}=${itI} onclick="ListUtil.toggleSelected(event, this)" oncontextmenu="ListUtil.openContextMenu(event, this)">\n\t\t\t\t<a id="${itI}" href="#${UrlUtil.autoEncodeHash(t)}" title="${i}">\n\t\t\t\t\t<span class="name col-xs-3">${i}</span>\n\t\t\t\t\t<span class="type col-xs-4 col-xs-4-3">${t.typeText}</span>\n\t\t\t\t\t<span class="col-xs-1 col-xs-1-5 text-align-center">${t.value||"—"}</span>\n\t\t\t\t\t<span class="col-xs-1 col-xs-1-5 text-align-center">${Parser.itemWeightToFull(t)||"—"}</span>\n\t\t\t\t\t<span class="source col-xs-1 col-xs-1-7 source${r}" title="${o}">${r}</span>\n\t\t\t\t\t<span class="cost hidden">${Parser.coinValueToNumber(t.value)}</span>\n\t\t\t\t\t<span class="weight hidden">${Parser.weightValueToNumber(t.weight)}</span>\n\t\t\t\t</a>\n\t\t\t</li>`:e.magic+=`\n\t\t\t<li class="row" ${FLTR_ID}=${itI} onclick="ListUtil.toggleSelected(event, this)" oncontextmenu="ListUtil.openContextMenu(event, this)">\n\t\t\t\t<a id="${itI}" href="#${UrlUtil.autoEncodeHash(t)}" title="${i}">\n\t\t\t\t\t<span class="name col-xs-3 col-xs-3-5">${i}</span>\n\t\t\t\t\t<span class="type col-xs-3 col-xs-3-3">${t.typeText}</span>\n\t\t\t\t\t<span class="col-xs-1 col-xs-1-5 text-align-center">${Parser.itemWeightToFull(t)||"—"}</span>\n\t\t\t\t\t<span class="rarity col-xs-2">${n}</span>\n\t\t\t\t\t<span class="source col-xs-1 col-xs-1-7 source${r}" title="${o}">${r}</span>\n\t\t\t\t\t<span class="weight hidden">${Parser.weightValueToNumber(t.weight)}</span>\n\t\t\t\t</a>\n\t\t\t</li>`,sourceFilter.addIfAbsent(a),t.procType.forEach(t=>typeFilter.addIfAbsent(t)),l.forEach(t=>tierFilter.addIfAbsent(t)),t._fProperties.forEach(t=>propertyFilter.addIfAbsent(t))}const i=ListUtil.getSearchTermAndReset(mundanelist,magiclist);$("ul.list.mundane").append(e.mundane),$("ul.list.magic").append(e.magic),$("h3.ele-mundane span.side-label").text("Mundane"),$("h3.ele-magic span.side-label").text("Magic"),sourceFilter.items.sort(SortUtil.ascSort),typeFilter.items.sort(SortUtil.ascSort),mundanelist.reIndex(),magiclist.reIndex(),i&&(mundanelist.search(i),magiclist.search(i)),mundanelist.sort("name"),magiclist.sort("name"),filterBox.render(),handleFilterChange(),ListUtil.setOptions({itemList:itemList,getSublistRow:getSublistItem,primaryLists:[mundanelist,magiclist]}),ListUtil.bindAddButton(),ListUtil.bindSubtractButton(),EntryRenderer.hover.bindPopoutButton(itemList),UrlUtil.bindLinkExportButton(filterBox),ListUtil.bindDownloadButton(),ListUtil.bindUploadButton()}function handleFilterChange(){const t=filterBox.getValues();function e(e){const i=itemList[$(e.elm).attr(FLTR_ID)];return filterBox.toDisplay(t,i.source,i.procType,i._fTier,i.rarity,i._fProperties,i.attunementCategory,i.category,i._fMisc)}mundanelist.filter(e),magiclist.filter(e),FilterBox.nextIfHidden(itemList)}function onSublistChange(){const t=$("#totalweight"),e=$("#totalvalue");let i=0,n=0;ListUtil.sublist.items.forEach(t=>{const e=itemList[Number(t._values.id)],s=Number($(t.elm).find(".count").text());e.weight&&(i+=Number(e.weight)*s),e.value&&(n+=Parser.coinValueToNumber(e.value)*s)}),t.text(`${i.toLocaleString()} lb${i>1?"s":""}.`),e.text(`${n.toLocaleString()}gp`)}function getSublistItem(t,e,i){return`\n\t\t<li class="row" ${FLTR_ID}="${e}" oncontextmenu="ListUtil.openSubContextMenu(event, this)">\n\t\t\t<a href="#${UrlUtil.autoEncodeHash(t)}" title="${t.name}">\n\t\t\t\t<span class="name col-xs-6">${t.name}</span>\n\t\t\t\t<span class="weight text-align-center col-xs-2">${t.weight?`${t.weight} lb${t.weight>1?"s":""}.`:"—"}</span>\t\t\n\t\t\t\t<span class="price text-align-center col-xs-2">${t.value||"—"}</span>\n\t\t\t\t<span class="count text-align-center col-xs-2">${i||1}</span>\t\t\n\t\t\t\t<span class="id hidden">${e}</span>\n\t\t\t</a>\n\t\t</li>\n\t`}const renderer=EntryRenderer.getDefaultRenderer();function loadhash(t){renderer.setFirstSection(!0);const e=$("#pagecontent").empty(),i=itemList[t],n=$(`\n\t\t${EntryRenderer.utils.getBorderTr()}\n\t\t${EntryRenderer.utils.getNameTr(i)}\n\t\t<tr>\n\t\t\t<td id="typerarityattunement" class="typerarityattunement" colspan="6">\n\t\t\t\t<span id="type">Type</span><span id="rarity">, rarity</span>\n\t\t\t\t<span id="attunement">(requires attunement)</span>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td id="valueweight" colspan="2"><span id="value">10gp</span> <span id="weight">45 lbs.</span></td>\n\t\t\t<td id="damageproperties" class="damageproperties" colspan="4"><span id="damage">Damage</span> <span id="damagetype">type</span> <span id="properties">(versatile)</span></td>\n\t\t</tr>\n\t\t<tr id="text"><td class="divider" colspan="6"><div></div></td></tr>\n\t\t${EntryRenderer.utils.getPageTr(i)}\n\t\t${EntryRenderer.utils.getBorderTr()}\t\n\t`);e.append(n);const s=i.source,a=Parser.sourceJsonToFull(s);e.find("th.name").html(`<span class="stats-name">${i.name}</span><span class="stats-source source${i.source}" title="${Parser.sourceJsonToFull(i.source)}">${Parser.sourceJsonToAbv(i.source)}</span>`);const r=i.type||"";"INS"!==r&&"GS"!==r||(i.additionalSources=i.additionalSources||[]),"INS"===r?i.additionalSources.find(t=>"XGE"===t.source&&83===t.page)||i.additionalSources.push({source:"XGE",page:83}):"GS"===r&&(i.additionalSources.find(t=>"XGE"===t.source&&81===t.page)||i.additionalSources.push({source:"XGE",page:81}));const o=i.additionalSources?`. Additional information from ${i.additionalSources.map(t=>`<i>${Parser.sourceJsonToFull(t.source)}</i>, page ${t.page}`).join("; ")}.`:null;e.find("td#source span").html(`<i>${a}</i>${i.page?`, page ${i.page}${o||""}`:""}`),e.find("td span#value").html(i.value?i.value+(i.weight?", ":""):""),e.find("td span#weight").html(i.weight?i.weight+(1===Number(i.weight)?" lb.":" lbs.")+(i.weightNote?` ${i.weightNote}`:""):""),e.find("td span#rarity").html((i.tier?", "+i.tier:"")+(i.rarity?", "+i.rarity:"")),e.find("td span#attunement").html(i.reqAttune?i.reqAttune:""),e.find("td span#type").html(i.typeText);const[l,c,u]=EntryRenderer.item.getDamageAndPropertiesText(i);e.find("span#damage").html(l),e.find("span#damagetype").html(c),e.find("span#properties").html(u),e.find("tr.text").remove();const d={type:"entries",entries:i.entries},m=[];if(renderer.recursiveEntryRender(d,m,1),"T"===r||"AT"===r||"INS"===r||"GS"===r)if(m.push(`<p class="text-align-center"><i>See the <a href="${renderer.baseUrl}variantrules.html#${UrlUtil.encodeForHash(["Tool Proficiencies","XGE"])}" target="_blank">Tool Proficiencies</a> entry of the Variant and Optional rules page for more information</i></p>`),"INS"===r){const t={type:"entries",entries:TOOL_INS_ADDITIONAL_ENTRIES};renderer.recursiveEntryRender(t,m,1)}else if("GS"===r){const t={type:"entries",entries:TOOL_GS_ADDITIONAL_ENTRIES};renderer.recursiveEntryRender(t,m,1)}if(i.additionalEntries){const t={type:"entries",entries:i.additionalEntries};renderer.recursiveEntryRender(t,m,1)}e.find("tr#text").after(`\n\t\t<tr class="text">\n\t\t\t<td colspan="6" class="text1">\n\t\t\t\t${m.join("").split(i.name.toLowerCase()).join("<i>"+i.name.toLowerCase()+"</i>").split(i.name.toLowerCase().uppercaseFirst()).join("<i>"+i.name.toLowerCase().uppercaseFirst()+"</i>")}\n\t\t\t</td>\n\t\t</tr>`),ListUtil.updateSelected()}function loadsub(t){filterBox.setFromSubHashes(t),ListUtil.setFromSubHashes(t)}const TOOL_INS_ADDITIONAL_ENTRIES=["Proficiency with a musical instrument indicates you are familiar with the techniques used to play it. You also have knowledge of some songs commonly performed with that instrument.",{type:"entries",name:"History",entries:["Your expertise aids you in recalling lore related to your instrument."]},{type:"entries",name:"Performance",entries:["Your ability to put on a good show is improved when you incorporate an instrument into your act."]},{type:"entries",name:"Compose a Tune",entries:["As part of a long rest, you can compose a new tune and lyrics for your instrument. You might use this ability to impress a noble or spread scandalous rumors with a catchy tune."]},{type:"table",caption:"Musical Instrument",colLabels:["Activity","DC"],colStyles:["col-xs-10","col-xs-2 text-align-center"],rows:[["Identify a tune","10"],["Improvise a tune","20"]]}],TOOL_GS_ADDITIONAL_ENTRIES=["Proficiency with a gaming set applies to one type of game, such as Three-Dragon Ante or games of chance that use dice.",{type:"entries",name:"Components",entries:["A gaming set has all the pieces needed to play a specific game or type of game, such as a complete deck of cards or a board and tokens."]},{type:"entries",name:"History",entries:["Your mastery of a game includes knowledge of its history, as well as of important events it was connected to or prominent historical figures involved with it."]},{type:"entries",name:"Insight",entries:["Playing games with someone is a good way to gain understanding of their personality, granting you a better ability to discern their lies from their truths and read their mood."]},{type:"entries",name:"Sleight of Hand",entries:["Sleight of Hand is a useful skill for cheating at a game, as it allows you to swap pieces, palm cards, or alter a die roll. Alternatively, engrossing a target in a game by manipulating the components with dexterous movements is a great distraction for a pickpocketing attempt."]},{type:"table",caption:"Gaming Set",colLabels:["Activity","DC"],colStyles:["col-xs-10","col-xs-2 text-align-center"],rows:[["Catch a player cheating","15"],["Gain insight into an opponent's personality","15"]]}];