function utils_makeAttChoose(e){if(1===e.length)return Parser.attAbvToFull(e[0])+" modifier";{const t=[];for(let r=0;r<e.length;++r)t.push(Parser.attAbvToFull(e[r]));return t.join(" or ")+" modifier (your choice)"}}_IS_DEPLOYED="1.56.1",IS_DEPLOYED="undefined"!=typeof _IS_DEPLOYED&&_IS_DEPLOYED,VERSION_NUMBER=IS_DEPLOYED?_IS_DEPLOYED:"-1",DEPLOYED_STATIC_ROOT="",IS_ROLL20=!1,HOMEBREW_CLIENT_ID="67e57877469da38a85a7",HOMEBREW_CLIENT_SECRET="c00dede21ca63a855abcd9a113415e840aca3f92",IMGUR_CLIENT_ID="abdea4de492d3b0",HASH_PART_SEP=",",HASH_LIST_SEP="_",HASH_SUB_LIST_SEP="~",HASH_SUB_KV_SEP=":",HASH_START="#",HASH_SUBCLASS="sub:",HASH_BLANK="blankhash",HASH_SUB_NONE="null",STR_EMPTY="",STR_VOID_LINK="javascript:void(0)",STR_SLUG_DASH="-",STR_APOSTROPHE="’",HTML_NO_INFO="<i>No information available.</i>",HTML_NO_IMAGES="<i>No images available.</i>",ID_SEARCH_BAR="filter-search-input-group",ID_RESET_BUTTON="reset",ELE_SPAN="span",ELE_UL="ul",ELE_LI="li",ELE_A="a",ELE_P="p",ELE_DIV="div",ELE_BUTTON="button",ELE_INPUT="input",EVNT_MOUSEOVER="mouseover",EVNT_MOUSEOUT="mouseout",EVNT_MOUSELEAVE="mouseleave",EVNT_MOUSEENTER="mouseenter",EVNT_CLICK="click",ATB_ID="id",ATB_CLASS="class",ATB_TITLE="title",ATB_VALUE="value",ATB_HREF="href",ATB_STYLE="style",ATB_CHECKED="checked",ATB_TYPE="type",ATB_ONCLICK="onclick",STL_DISPLAY_INITIAL="display: initial",STL_DISPLAY_NONE="display: none",FLTR_ID="filterId",CLSS_NON_STANDARD_SOURCE="spicy-sauce",CLSS_HOMEBREW_SOURCE="refreshing-brew",CLSS_SUBCLASS_FEATURE="subclass-feature",ATB_DATA_LIST_SEP="||",ATB_DATA_PART_SEP="::",ATB_DATA_SC="data-subclass",ATB_DATA_SRC="data-source",STR_CANTRIP="Cantrip",STR_NONE="None",STR_ANY="Any",STR_SPECIAL="Special",RNG_SPECIAL="special",RNG_POINT="point",RNG_LINE="line",RNG_CUBE="cube",RNG_CONE="cone",RNG_RADIUS="radius",RNG_SPHERE="sphere",RNG_HEMISPHERE="hemisphere",RNG_SELF="self",RNG_SIGHT="sight",RNG_UNLIMITED="unlimited",RNG_UNLIMITED_SAME_PLANE="plane",RNG_TOUCH="touch",UNT_FEET="feet",UNT_MILES="miles",ABIL_STR="Strength",ABIL_DEX="Dexterity",ABIL_CON="Constitution",ABIL_INT="Intelligence",ABIL_WIS="Wisdom",ABIL_CHA="Charisma",ABIL_CH_ANY="Choose Any",HOMEBREW_STORAGE="HOMEBREW_STORAGE",HOMEBREW_META_STORAGE="HOMEBREW_META_STORAGE",EXCLUDES_STORAGE="EXCLUDES_STORAGE",DMSCREEN_STORAGE="DMSCREEN_STORAGE",ROLLER_MACRO_STORAGE="ROLLER_MACRO_STORAGE",JSON_HOMEBREW_INDEX="homebrew/index.json",String.prototype.formatUnicorn=String.prototype.formatUnicorn||function(){let e=this.toString();if(arguments.length){const t=typeof arguments[0];let r;const s="string"===t||"number"===t?Array.prototype.slice.call(arguments):arguments[0];for(r in s)e=e.replace(new RegExp("\\{"+r+"\\}","gi"),s[r])}return e},String.prototype.uppercaseFirst=String.prototype.uppercaseFirst||function(){const e=this.toString();return 0===e.length?e:1===e.length?e.charAt(0).toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},String.prototype.lowercaseFirst=String.prototype.lowercaseFirst||function(){const e=this.toString();return 0===e.length?e:1===e.length?e.charAt(0).toLowerCase():e.charAt(0).toLowerCase()+e.slice(1)},String.prototype.toTitleCase=String.prototype.toTitleCase||function(){let e;e=this.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),StrUtil._TITLE_LOWER_WORDS_RE||(StrUtil._TITLE_LOWER_WORDS_RE=StrUtil.TITLE_LOWER_WORDS.map(e=>new RegExp(`\\s${e}\\s`,"g")));for(let t=0;t<StrUtil.TITLE_LOWER_WORDS.length;t++)e=e.replace(StrUtil._TITLE_LOWER_WORDS_RE[t],e=>e.toLowerCase());StrUtil._TITLE_UPPER_WORDS_RE||(StrUtil._TITLE_UPPER_WORDS_RE=StrUtil.TITLE_UPPER_WORDS.map(e=>new RegExp(`\\b${e}\\b`,"g")));for(let t=0;t<StrUtil.TITLE_UPPER_WORDS.length;t++)e=e.replace(StrUtil._TITLE_UPPER_WORDS_RE[t],StrUtil.TITLE_UPPER_WORDS[t].toUpperCase());return e},String.prototype.ltrim=String.prototype.ltrim||function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=String.prototype.rtrim||function(){return this.replace(/\s+$/,"")},String.prototype.escapeQuotes=String.prototype.escapeQuotes||function(){return this.replace(/'/g,"&singlequot;").replace(/"/g,"&quot;")},String.prototype.unescapeQuotes=String.prototype.unescapeQuotes||function(){return this.replace(/&singlequot;/g,"'").replace(/&quot;/g,'"')},String.prototype.distance=String.prototype.distance||function(e){let t,r,s=this;if(!s)return e?e.length:0;if(!e)return s.length;const n=s.length,a=e.length,i=n+a,o=new Array(n+2),l={};for(t=0;t<n+2;t++)o[t]=new Array(a+2);for(o[0][0]=i,t=0;t<=n;t++)o[t+1][1]=t,o[t+1][0]=i,l[s[t]]=0;for(r=0;r<=a;r++)o[1][r+1]=r,o[0][r+1]=i,l[e[r]]=0;for(t=1;t<=n;t++){let n=0;for(r=1;r<=a;r++){const a=l[e[r-1]],i=n;s[t-1]===e[r-1]?(o[t+1][r+1]=o[t][r],n=r):o[t+1][r+1]=Math.min(o[t][r],Math.min(o[t+1][r],o[t][r+1]))+1,o[t+1][r+1]=Math.min(o[t+1][r+1],o[a]?o[a][i]+(t-a-1)+1+(r-i-1):1/0)}l[s[t-1]]=t}return o[n+1][a+1]},StrUtil={joinPhraseArray:function(e,t,r){if(0===e.length)return"";if(1===e.length)return e[0];if(2===e.length)return e.join(r);{let s="";for(let n=0;n<e.length;++n)s+=e[n],n<e.length-2?s+=t:n===e.length-2&&(s+=r);return s}},uppercaseFirst:function(e){return e.uppercaseFirst()},TITLE_LOWER_WORDS:["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"],TITLE_UPPER_WORDS:["Id","Tv"],padNumber:(e,t,r)=>String(e).padStart(t,r)},RegExp.escape=function(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")};class AbilityData{constructor(e,t,r,s){this.asText=e,this.asTextShort=t,this.asCollection=r,this.areNegative=s}}function utils_getAbilityData(e){const t=["Str","Dex","Con","Int","Wis","Cha"],r=[],s=[],n=[],a=[],i=[];return void 0!==e?(o(e),function(){if(void 0!==e.choose)for(let t=0;t<e.choose.length;++t){const r=e.choose[t];let s="";if(void 0!==r.predefined)for(let e=0;e<r.predefined.length;++e){const t=[];o(t,r.predefined[e]),s+=t.join(", ")+(e===r.predefined.length-1?"":" or ")}else{const e=6===r.from.length,t=_(r);let n=void 0===r.amount?1:r.amount;if(n=(n<0?"":"+")+n,e?s+="any ":t&&(s+="any other "),void 0!==r.count&&r.count>1&&(s+=Parser.numberToText(r.count)+" "),e||t)s+=n;else for(let e=0;e<r.from.length;++e){let t="";r.from.length>1&&(e===r.from.length-2?t=" or ":e<r.from.length-2&&(t=", "));let a=" "+n;r.from.length>1&&e!==r.from.length-1&&(a=""),s+=r.from[e].uppercaseFirst()+a+t}}a.push("Choose "+s),i.push(s.uppercaseFirst())}}(),new AbilityData(a.join("; "),i.join("; "),s,n)):new AbilityData("","",[],[]);function o(e){for(let r=0;r<t.length;++r)l(e,t[r])}function l(e,t){if(void 0!==e[t.toLowerCase()]){const o=e[t.toLowerCase()]<0,l=`${t} ${o?"":"+"}${e[t.toLowerCase()]}`;a.push(l),i.push(l),r.push(t),s.push(t.toLowerCase()),o&&n.push(t.toLowerCase())}}function _(e){const t=[];for(let e=0;e<r.length;++e)t.push(r[e].toLowerCase());for(let r=0;r<e.from.length;++r){const n=e.from[r].toLowerCase();t.includes(n)||t.push(n),s.includes(n.toLowerCase)||s.push(n.toLowerCase())}return 6===t.length}}function xor(e,t){return!e!=!t}function implies(e,t){return!e||t}function noModifierKeys(e){return!e.ctrlKey&&!e.altKey&&!e.metaKey}function copyText(e){const t=$(`<textarea id="copy-temp" style="position: fixed; top: -1000px; left: -1000px; width: 1px; height: 1px;">${e}</textarea>`);$("body").append(t),t.select(),document.execCommand("Copy"),t.remove()}function showCopiedEffect(e){const t=$('<div class="copied-tip"><span>Copied!</span></div>'),r=e.offset();t.css({top:r.top-17,left:r.left-36+e.width()/2}).appendTo($("body")).animate({top:"-=8",opacity:0},250,()=>{t.remove()})}function getSourceFilter(e={}){const t={header:FilterBox.SOURCE_HEADER,displayFn:Parser.sourceJsonToFullCompactPrefix,selFn:defaultSourceSelFn,groupFn:SourceUtil.getFilterGroup};return Object.assign(t,e),new GroupedFilter(t)}function defaultSourceDeselFn(e){return SourceUtil.isNonstandardSource(e)}function defaultSourceSelFn(e){return!defaultSourceDeselFn(e)}function getAsiFilter(e){return getFilterWithMergedOptions({header:"Ability Bonus",items:["str","dex","con","int","wis","cha"],displayFn:Parser.attAbvToFull},e)}function getFilterWithMergedOptions(e,t){return t&&Object.assign(e,t),new Filter(e)}function initFilterBox(...e){return new FilterBox(document.getElementById(ID_SEARCH_BAR),document.getElementById(ID_RESET_BUTTON),e)}function addListShowHide(){$("#filter-search-input-group").find("#reset").before('\n\t\t<button class="btn btn-default" type="button" id="hidesearch">Hide</button>\n\t'),$("#contentwrapper").prepend('\n\t\t<div class="col-xs-12" id="showsearch">\n\t\t\t<button class="btn btn-block btn-default btn-xs" type="button">Show Search</button>\n\t\t\t<br>\n\t\t</div>\t\n\t');const e=$("#listcontainer"),t=$("div#showsearch"),r=$("button#hidesearch");r.click(function(){e.hide(),t.show(),r.hide()}),t.find("button").click(function(){e.show(),t.hide(),r.show()})}function BookModeView(e,t,r,s){this.hashKey=e,this.$openBtn=t,this.noneVisibleMsg=r,this.popTblGetNumShown=s,this.active=!1,this._$body=null,this._$wrpBook=null;const n=this;n.$openBtn.on("click",()=>{History.cleanSetHash(`${window.location.hash}${HASH_PART_SEP}${n.hashKey}:true`)}),this.open=(()=>{function e(){History.cleanSetHash(window.location.hash.replace(`${n.hashKey}:true`,""))}if(n.active)return;n.active=!0;const t=$("body"),r=$('<div class="book-mode"/>');n._$body=t,n._$wrpBook=r,t.css("overflow","hidden"),t.addClass("book-mode-active");const s=$('<table class="stats stats-book" style="font-size: 1.0em; font-family: inherit;"/>'),a=$('<tr><th class="border close-border" style="width: 100%;"><div/></th></tr>'),i=$('<span class="spacer-name"/>'),o=$('<span class="delete-icon glyphicon glyphicon-remove"></span>').on("click",()=>{e()});a.find("div").append(i).append(o),s.append(a);const l=$('<table class="stats stats-book" style="width: auto; margin: 0 auto; font-family: inherit;"/>'),_=n.popTblGetNumShown(l,i),c=$("<tr/>");c.append($(`<div class="wrp-content" style="${_?"":"display: none;"}"/>`).append(l));const S=$(`<tr ${_?'style="display: none;"':""}><td class="text-align-center"><span class="initial-message">${n.noneVisibleMsg}</span><br></td></tr>`);S.find("td").append($('<button class="btn btn-default">Close</button>').on("click",()=>{e()})),s.append(c).append(S).append(EntryRenderer.utils.getBorderTr()),r.append(s),t.append(r)}),this.teardown=(()=>{n.active&&(n._$body.css("overflow",""),n._$body.removeClass("book-mode-active"),n._$wrpBook.remove(),n.active=!1)})}Parser={},Parser._parse_aToB=function(e,t){if(null==t)throw new Error("undefined or null object passed to parser");return"string"==typeof t&&(t=t.trim()),void 0!==e[t]?e[t]:t},Parser._parse_bToA=function(e,t){if(null==t)throw new Error("undefined or null object passed to parser");"string"==typeof t&&(t=t.trim());for(const r in e)if(e.hasOwnProperty(r)&&e[r]===t)return r;return t},Parser.numberToText=function(e){if(Math.abs(e)>=100)return e;return`${e<0?"negative ":""}${function e(t){const r=Math.abs(t);switch(r){case 0:return"zero";case 1:return"one";case 2:return"two";case 3:return"three";case 4:return"four";case 5:return"five";case 6:return"six";case 7:return"seven";case 8:return"eight";case 9:return"nine";case 10:return"ten";case 11:return"eleven";case 12:return"twelve";case 13:return"thirteen";case 14:return"fourteen";case 15:return"fifteen";case 16:return"sixteen";case 17:return"seventeen";case 18:return"eighteen";case 19:return"nineteen";case 20:return"twenty";case 30:return"thirty";case 40:return"forty";case 50:return"fiddy";case 60:return"sixty";case 70:return"seventy";case 80:return"eighty";case 90:return"ninety";default:{const t=String(r);return`${e(Number(`${t[0]}0`))}-${e(Number(t[1]))}`}}}(e)}`},Parser.attAbvToFull=function(e){return Parser._parse_aToB(Parser.ATB_ABV_TO_FULL,e)},Parser.attFullToAbv=function(e){return Parser._parse_bToA(Parser.ATB_ABV_TO_FULL,e)},Parser.sizeAbvToFull=function(e){return Parser._parse_aToB(Parser.SIZE_ABV_TO_FULL,e)},Parser.getAbilityModNumber=function(e){return Math.floor((e-10)/2)},Parser.getAbilityModifier=function(e){let t=Parser.getAbilityModNumber(e);return t>=0&&(t="+"+t),t},Parser.getSpeedString=(e=>{function t(t){function s(e){var s;r.push(`${"walk"===t?"":`${t} `}${s=e,s.number||s}ft.${function(e){return e.condition?` ${e.condition}`:""}(e)}`)}e.speed[t]&&s(e.speed[t]),e.speed.alternate&&e.speed.alternate[t]&&e.speed.alternate[t].forEach(s)}const r=[];if("object"==typeof e.speed){let s=", ";return t("walk"),t("burrow"),t("climb"),t("fly"),t("swim"),e.speed.choose&&(s="; ",r.push(`${CollectionUtil.joinConjunct(e.speed.choose.from.sort(),", ",", or ")} ${e.speed.choose.amount} ft.${e.speed.choose.note?` ${e.speed.choose.note}`:""}`)),r.join(s)}return e.speed+("Varies"===e.speed?"":"ft. ")}),Parser._addCommas=function(e){return(e+"").replace(/(\d)(?=(\d{3})+$)/g,"$1,")},Parser.crToXp=function(e){return"Unknown"===e||void 0===e?"Unknown":"0"===e?"0 or 10":"1/8"===e?"25":"1/4"===e?"50":"1/2"===e?"100":Parser._addCommas(Parser.XP_CHART[parseInt(e)-1])},Parser.crToXpNumber=function(e){return"Unknown"===e||void 0===e?null:"0"===e?10:"1/8"===e?25:"1/4"===e?50:"1/2"===e?100:Parser.XP_CHART[parseInt(e)-1]},LEVEL_TO_XP_EASY=[0,25,50,75,125,250,300,350,450,550,600,800,1e3,1100,1250,1400,1600,2e3,2100,2400,2800],LEVEL_TO_XP_MEDIUM=[0,50,100,150,250,500,600,750,900,1100,1200,1600,2e3,2200,2500,2800,3200,3900,4100,4900,5700],LEVEL_TO_XP_HARD=[0,75,150,225,375,750,900,1100,1400,1600,1900,2400,3e3,3400,3800,4300,4800,5900,6300,7300,8500],LEVEL_TO_XP_DEADLY=[0,100,200,400,500,1100,1400,1700,2100,2400,2800,3600,4500,5100,5700,6400,7200,8800,9500,10900,12700],Parser.levelToXpThreshold=function(e){return[LEVEL_TO_XP_EASY[e],LEVEL_TO_XP_MEDIUM[e],LEVEL_TO_XP_HARD[e],LEVEL_TO_XP_DEADLY[e]]},Parser.crToNumber=function(e){if("Unknown"===e||void 0===e)return 100;if(e.cr)return Parser.crToNumber(e.cr);const t=e.trim().split("/");return 1===t.length?Number(t[0]):2===t.length?Number(t[0])/Number(t[1]):0},Parser.crToPb=function(e){return"Unknown"===e||null==e?0:(e=e.cr||e,Parser.crToNumber(e)<5?2:Math.ceil(e/4)+1)},Parser.dragonColorToFull=function(e){return Parser._parse_bToA(DRAGON_COLOR_TO_FULL,e)},DRAGON_COLOR_TO_FULL={B:"black",U:"blue",G:"green",R:"red",W:"white",A:"brass",Z:"bronze",C:"copper",O:"gold",S:"silver"},Parser.acToFull=function(e){if("string"==typeof e)return e;const t=EntryRenderer.getDefaultRenderer();let r="";for(let s=0;s<e.length;++s){const n=e[s],a=e[s+1];n.ac?(r+=n.ac,n.from&&(r+=` (${n.from.map(e=>t.renderEntry(e)).join(", ")})`),n.condition&&(r+=` ${t.renderEntry(n.condition)}`),n.braces&&(r+=")")):r+=n,a&&(a.braces?r+=" (":r+=", ")}return r.trim()},MONSTER_COUNT_TO_XP_MULTIPLIER=[1,1.5,2,2,2,2,2.5,2.5,2.5,2.5,3,3,3,3,4],Parser.numMonstersToXpMult=function(e){return e>=MONSTER_COUNT_TO_XP_MULTIPLIER.length?4:MONSTER_COUNT_TO_XP_MULTIPLIER[e-1]},Parser.armorFullToAbv=function(e){return Parser._parse_bToA(Parser.ARMOR_ABV_TO_FULL,e)},Parser._getSourceStringFromSource=function(e){return e&&e.source?e.source:e},Parser.hasSourceFull=function(e){return!!Parser.SOURCE_JSON_TO_FULL[e]},Parser.hasSourceAbv=function(e){return!!Parser.SOURCE_JSON_TO_ABV[e]},Parser.sourceJsonToFull=function(e){return e=Parser._getSourceStringFromSource(e),Parser.hasSourceFull(e)?Parser._parse_aToB(Parser.SOURCE_JSON_TO_FULL,e).replace(/'/g,STR_APOSTROPHE):BrewUtil.hasSourceJson(e)?BrewUtil.sourceJsonToFull(e).replace(/'/g,STR_APOSTROPHE):Parser._parse_aToB(Parser.SOURCE_JSON_TO_FULL,e).replace(/'/g,STR_APOSTROPHE)},Parser.sourceJsonToFullCompactPrefix=function(e){return Parser.sourceJsonToFull(e).replace(UA_PREFIX,UA_PREFIX_SHORT).replace(AL_PREFIX,AL_PREFIX_SHORT).replace(PS_PREFIX,PS_PREFIX_SHORT)},Parser.sourceJsonToAbv=function(e){return e=Parser._getSourceStringFromSource(e),Parser.hasSourceAbv(e)?Parser._parse_aToB(Parser.SOURCE_JSON_TO_ABV,e):BrewUtil.hasSourceJson(e)?BrewUtil.sourceJsonToAbv(e):Parser._parse_aToB(Parser.SOURCE_JSON_TO_ABV,e)},Parser.stringToSlug=function(e){return e.toLowerCase().replace(/[^\w ]+/g,STR_EMPTY).replace(/ +/g,STR_SLUG_DASH)},Parser.stringToCasedSlug=function(e){return e.replace(/[^\w ]+/g,STR_EMPTY).replace(/ +/g,STR_SLUG_DASH)},Parser.itemTypeToAbv=function(e){return Parser._parse_aToB(Parser.ITEM_TYPE_JSON_TO_ABV,e)},Parser.itemWeightToFull=function(e){return e.weight?e.weight+(1===Number(e.weight)?" lb.":" lbs.")+(e.weightNote?` ${e.weightNote}`:""):""},Parser._coinValueToNumberMultipliers={cp:.01,sp:.1,ep:.5,gp:1,pp:10},Parser.coinValueToNumber=function(e){if(!e)return 0;if("x4"===e||"Varies"===e)return 0;e=e.replace(/[\s,]*/g,"").toLowerCase();const t=/(\d+(\.\d+)?)([csegp]p)/.exec(e);if(!t)throw new Error(`Badly formatted value ${e}`);return Number(t[1])*Parser._coinValueToNumberMultipliers[t[3]]},Parser.weightValueToNumber=function(e){if(!e)return 0;if("x2"===e)return 0;if(Number(e))return Number(e);throw new Error(`Badly formatted value ${e}`)},Parser.dmgTypeToFull=function(e){return Parser._parse_aToB(Parser.DMGTYPE_JSON_TO_FULL,e)},Parser.skillToExplanation=function(e){return Parser._parse_aToB(Parser.SKILL_JSON_TO_FULL,e)},Parser.actionToExplanation=function(e){return Parser._parse_aToB(Parser.ACTION_JSON_TO_FULL,e)},Parser.numberToString=function(e){return 0===e?"zero":function(e){return e>99?Parser.NUMBERS_ONES[Math.floor(e/100)]+" hundred "+t(e%100):t(e)}(e);function t(e){return e<10?Parser.NUMBERS_ONES[e]:e>=10&&e<20?Parser.NUMBERS_TEENS[e-10]:Parser.NUMBERS_TENS[Math.floor(e/10)]+" "+Parser.NUMBERS_ONES[e%10]}},Parser.spSchoolAbvToFull=function(e){return Parser._parse_aToB(Parser.SP_SCHOOL_ABV_TO_FULL,e)},Parser.spSchoolAbvToShort=function(e){return Parser._parse_aToB(Parser.SP_SCHOOL_ABV_TO_SHORT,e)},Parser.spLevelToFull=function(e){return 0===e?STR_CANTRIP:1===e?e+"st":2===e?e+"nd":3===e?e+"rd":e+"th"},Parser.spLevelToFullLevelText=function(e,t){return`${Parser.spLevelToFull(e)}${0===e?"s":`${t?"-":" "}level`}`},Parser.spMetaToFull=function(e){return e&&e.ritual?" (ritual)":e&&e.technomagic?" (technomagic)":""},Parser.spLevelSchoolMetaToFull=function(e,t,r){const s=0===e?Parser.spLevelToFull(e).toLowerCase():Parser.spLevelToFull(e)+"-level";return(0===e?`${Parser.spSchoolAbvToFull(t)} ${s}`:`${s} ${Parser.spSchoolAbvToFull(t).toLowerCase()}`)+Parser.spMetaToFull(r)},Parser.spTimeListToFull=function(e){return e.map(e=>`${Parser.getTimeToFull(e)}${e.condition?`, ${EntryRenderer.getDefaultRenderer().renderEntry(e.condition)}`:""}`).join(" or ")},Parser.getTimeToFull=function(e){return`${e.number} ${"bonus"===e.unit?"bonus action":e.unit}${e.number>1?"s":""}`},Parser.spRangeToFull=function(e){switch(e.type){case RNG_SPECIAL:return"Special";case RNG_POINT:return function(){const t=e.distance;switch(t.type){case UNT_FEET:case UNT_MILES:return`${t.amount} ${1===t.amount?Parser.getSingletonUnit(t.type):t.type}`;case RNG_SELF:return"Self";case RNG_SIGHT:return"Sight";case RNG_UNLIMITED:return"Unlimited";case RNG_UNLIMITED_SAME_PLANE:return"Unlimited on the same plane";case RNG_TOUCH:return"Touch"}}();case RNG_LINE:case RNG_CUBE:case RNG_CONE:case RNG_RADIUS:case RNG_SPHERE:case RNG_HEMISPHERE:return function(){const t=e.distance;return`Self (${t.amount}-${Parser.getSingletonUnit(t.type)}${function(){switch(e.type){case RNG_SPHERE:return" radius";case RNG_HEMISPHERE:return`-radius ${e.type}`;default:return` ${e.type}`}}()})`}()}},Parser.getSingletonUnit=function(e){return e===UNT_FEET?"foot":"s"===e.charAt(e.length-1)?e.slice(0,-1):e},Parser.spComponentsToFull=function(e){const t=[];return e.v&&t.push("V"),e.s&&t.push("S"),e.m&&t.push("M"+(!0!==e.m?` (${e.m.text||e.m})`:"")),t.join(", ")},Parser.spDurationToFull=function(e){return e.map(e=>{switch(e.type){case"special":return"Special";case"instant":return`Instantaneous${e.condition?` (${e.condition})`:""}`;case"timed":return`${e.concentration?"Concentration, ":""}${e.duration.upTo&&e.concentration?"u":e.duration.upTo?"U":""}${e.duration.upTo?"p to ":""}${e.duration.amount} ${1===e.duration.amount?e.duration.type:`${e.duration.type}s`}`;case"permanent":return e.ends?`Until ${e.ends.map(e=>"dispel"===e?"dispelled":"trigger"===e?"triggered":"discharge"===e?"discharged":void 0).join(" or ")}`:"Permanent"}}).join(" or ")+(e.length>1?" (see below)":"")},Parser.spClassesToFull=function(e,t){const r=Parser.spSubclassesToFull(e,t);return Parser.spMainClassesToFull(e,t)+(r?", "+r:"")},Parser.spMainClassesToFull=function(e,t){return e.fromClassList.sort((e,t)=>SortUtil.ascSort(e.name,t.name)).map(e=>t?e.name:`<span title="Source: ${Parser.sourceJsonToFull(e.source)}">${e.name}</span>`).join(", ")},Parser.spSubclassesToFull=function(e,t){return e.fromSubclass?e.fromSubclass.sort((e,t)=>{return SortUtil.ascSort(e.class.name,t.class.name)||SortUtil.ascSort(e.subclass.name,t.subclass.name)}).map(e=>Parser._spSubclassItem(e,t)).join(", "):""},Parser._spSubclassItem=function(e,t){const r=`${e.subclass.name}${e.subclass.subSubclass?` (${e.subclass.subSubclass})`:""}`;return t?r:`<span class="italic" title="Source: ${Parser.sourceJsonToFull(e.subclass.source)}">${r}</span> <span title="Source: ${Parser.sourceJsonToFull(e.class.source)}">${e.class.name}</span>`},Parser.SPELL_ATTACK_TYPE_TO_FULL={},Parser.SPELL_ATTACK_TYPE_TO_FULL.M="Melee",Parser.SPELL_ATTACK_TYPE_TO_FULL.R="Ranged",Parser.SPELL_ATTACK_TYPE_TO_FULL.O="Other/Unknown",Parser.spAttackTypeToFull=function(e){return Parser._parse_aToB(Parser.SPELL_ATTACK_TYPE_TO_FULL,e)},Parser.monTypeToFullObj=function(e){const t={type:"",tags:[],asText:""};if("string"==typeof e)return t.type=e,t.asText=e,t;const r=[];if(e.tags)for(const s of e.tags)"string"==typeof s?(t.tags.push(s),r.push(s)):(t.tags.push(s.tag),r.push(`${s.prefix} ${s.tag}`));return t.type=e.type,e.swarmSize?(t.tags.push("swarm"),t.asText=`swarm of ${Parser.sizeAbvToFull(e.swarmSize).toLowerCase()} ${Parser.monTypeToPlural(e.type)}`):t.asText=`${e.type}`,r.length&&(t.asText+=` (${r.join(", ")})`),t},Parser.monTypeToPlural=function(e){return Parser._parse_aToB(Parser.MON_TYPE_TO_PLURAL,e)},Parser.monCrToFull=function(e){if("string"!=typeof e&&e){const t=[Parser.monCrToFull(e.cr)];return e.lair&&t.push(`${Parser.monCrToFull(e.lair)} when encountered in lair`),e.coven&&t.push(`${Parser.monCrToFull(e.coven)} when part of a coven`),t.join(" or ")}return`${e||"Unknown"} (${Parser.crToXp(e)} XP)`},Parser.monImmResToFull=function(e){const t=e.length;let r=0;if(1===t&&(e[0].immune||e[0].resist))return e.map(e=>s(e,-1)).join(r?"; ":", ");function s(e,t=0){if(r=Math.max(r,t),"string"==typeof e)return e;if(e.special)return e.special;{let n=e.preNote?`${e.preNote} `:"";if(e.immune){const a=e.immune.map(e=>s(e,t+1));n+=t?a.join(r?"; ":", "):CollectionUtil.joinConjunct(a,", "," and ")}else if(e.resist){const a=e.resist.map(e=>s(e,t+1));n+=t?a.join(r?"; ":", "):CollectionUtil.joinConjunct(a,", "," and ")}else if(e.vulnerable){const a=e.vulnerable.map(e=>s(e,t+1));n+=t?a.join(r?"; ":", "):CollectionUtil.joinConjunct(a,", "," and ")}return e.note&&(n+=` ${e.note}`),n}}return e.map(e=>s(e)).join(r?"; ":", ")},Parser.monCondImmToFull=function(e){return e.map(e=>e.special?e.special:e.conditionImmune?`${e.preNote?`${e.preNote} `:""}${e.conditionImmune.join(", ")}${e.note?` ${e.note}`:""}`:e).join(", ")},Parser.PSI_ABV_TYPE_TALENT="T",Parser.PSI_ABV_TYPE_DISCIPLINE="D",Parser.PSI_ORDER_NONE="None",Parser.psiTypeToFull=(e=>e===Parser.PSI_ABV_TYPE_TALENT?"Talent":e===Parser.PSI_ABV_TYPE_DISCIPLINE?"Discipline":e),Parser.psiOrderToFull=(e=>void 0===e?Parser.PSI_ORDER_NONE:e),Parser.levelToFull=function(e){return isNaN(e)?"":"2"===e?e+"nd":"3"===e?e+"rd":"1"===e?e+"st":e+"th"},Parser.invoSpellToFull=function(e){return"Eldritch Blast"===e?EntryRenderer.getDefaultRenderer().renderEntry(`{@spell ${e}} cantrip`):"Hex/Curse"===e?EntryRenderer.getDefaultRenderer().renderEntry("{@spell Hex} spell or a warlock feature that curses"):e?EntryRenderer.getDefaultRenderer().renderEntry(`{@spell ${e}}`):STR_NONE},Parser.invoPactToFull=function(e){return"Chain"===e?"Pact of the Chain":"Tome"===e?"Pact of the Tome":"Blade"===e?"Pact of the Blade":STR_ANY},Parser.invoPatronToShort=function(e){return e===STR_ANY?STR_ANY:/^The (.*?)$/.exec(e)[1]},Parser.alignmentAbvToFull=function(e){if("object"==typeof e)return e.special?e.special:`${e.alignment.map(e=>Parser.alignmentAbvToFull(e)).join(" ")}${e.chance?` (${e.chance}%)`:""}`;switch(e=e.toUpperCase()){case"L":return"Lawful";case"N":return"Neutral";case"NX":return"Neutral (Law/Chaos axis)";case"NY":return"Neutral (Good/Evil axis)";case"C":return"Chaotic";case"G":return"Good";case"E":return"Evil";case"U":return"Unaligned";case"A":return"Any alignment"}return e},Parser.alignmentListToFull=function(e){if(1===e.length)return Parser.alignmentAbvToFull(e[0]);if(2===e.length){if("object"==typeof e[0]&&"object"==typeof e[1])return`${Parser.alignmentAbvToFull(e[0])} or ${Parser.alignmentAbvToFull(e[1]).toLowerCase()}`;if("string"==typeof e[0]&&"string"==typeof e[1])return e.map(e=>Parser.alignmentAbvToFull(e)).join(" ");throw new Error(`Malformed alignment pair: ${JSON.stringify(e)}`)}if(5===e.length){if(!e.includes("G"))return"any non-good alignment";if(!e.includes("L"))return"any non-lawful alignment"}if(4===e.length){if(!e.includes("L")&&!e.includes("NX"))return"any chaotic alignment";if(!e.includes("G")&&!e.includes("NY"))return"any evil alignment";if(!e.includes("C")&&!e.includes("NX"))return"any lawful alignment";if(!e.includes("E")&&!e.includes("NY"))return"any good alignment"}throw new Error(`Unmapped alignment: ${JSON.stringify(e)}`)},Parser.CAT_ID_CREATURE=1,Parser.CAT_ID_SPELL=2,Parser.CAT_ID_BACKGROUND=3,Parser.CAT_ID_ITEM=4,Parser.CAT_ID_CLASS=5,Parser.CAT_ID_CONDITION=6,Parser.CAT_ID_FEAT=7,Parser.CAT_ID_ELDRITCH_INVOCATION=8,Parser.CAT_ID_PSIONIC=9,Parser.CAT_ID_RACE=10,Parser.CAT_ID_OTHER_REWARD=11,Parser.CAT_ID_VARIANT_OPTIONAL_RULE=12,Parser.CAT_ID_ADVENTURE=13,Parser.CAT_ID_DEITY=14,Parser.CAT_ID_OBJECT=15,Parser.CAT_ID_TRAP=16,Parser.CAT_ID_HAZARD=17,Parser.CAT_ID_QUICKREF=18,Parser.CAT_ID_CULT=19,Parser.CAT_ID_BOON=20,Parser.CAT_ID_DISEASE=21,Parser.CAT_ID_TO_FULL={},Parser.CAT_ID_TO_FULL[Parser.CAT_ID_CREATURE]="Bestiary",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_SPELL]="Spell",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_BACKGROUND]="Background",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_ITEM]="Item",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_CLASS]="Class",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_CONDITION]="Condition",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_FEAT]="Feat",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_ELDRITCH_INVOCATION]="Eldritch Invocation",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_PSIONIC]="Psionic",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_RACE]="Race",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_OTHER_REWARD]="Other Reward",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_VARIANT_OPTIONAL_RULE]="Variant/Optional Rule",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_ADVENTURE]="Adventure",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_DEITY]="Deity",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_OBJECT]="Object",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_TRAP]="Trap",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_HAZARD]="Hazard",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_QUICKREF]="Quick Reference",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_CULT]="Cult",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_BOON]="Boon",Parser.CAT_ID_TO_FULL[Parser.CAT_ID_DISEASE]="Disease",Parser.pageCategoryToFull=function(e){return Parser._parse_aToB(Parser.CAT_ID_TO_FULL,e)},Parser.spSubclassesToCurrentAndLegacyFull=function(e){const t=[[],[]];if(!e.fromSubclass)return t;const r=new Set,s=[];return e.fromSubclass.sort((e,t)=>{return SortUtil.ascSort(e.subclass.name,t.subclass.name)||SortUtil.ascSort(e.class.name,t.class.name)}).forEach(e=>{const n=e.subclass.name,a=e.subclass.source,i=Parser._spSubclassItem(e);if(SourceUtil.hasBeenReprinted(n,a))t[1].push(i);else if(Parser.sourceJsonToFull(a).startsWith(UA_PREFIX)||Parser.sourceJsonToFull(a).startsWith(PS_PREFIX)){const e=function(e){switch(e){case"Favored Soul":return"Divine Soul";case"Undying Light":return"Celestial";case"Deep Stalker":return"Gloom Stalker"}return e}(n.split("(")[0].trim().split(/v\d+/)[0].trim());s.push({name:e,ele:i})}else t[0].push(i),r.add(n)}),s.forEach(e=>{r.has(e.name)?t[1].push(e.ele):t[0].push(e.ele)}),[t[0].join(", "),t[1].join(", ")]},Parser.attackTypeToFull=function(e){return Parser._parse_aToB(Parser.ATK_TYPE_TO_FULL,e)},Parser.trapTypeToFull=function(e){return Parser._parse_aToB(Parser.TRAP_TYPE_TO_FULL,e)},Parser.TRAP_TYPE_TO_FULL={},Parser.TRAP_TYPE_TO_FULL.MECH="Mechanical trap",Parser.TRAP_TYPE_TO_FULL.MAG="Magical trap",Parser.TRAP_TYPE_TO_FULL.SMPL="Simple trap",Parser.TRAP_TYPE_TO_FULL.CMPX="Complex trap",Parser.TRAP_TYPE_TO_FULL.HAZ="Hazard",Parser.tierToFullLevel=function(e){return Parser._parse_aToB(Parser.TIER_TO_FULL_LEVEL,e)},Parser.TIER_TO_FULL_LEVEL={},Parser.TIER_TO_FULL_LEVEL[1]="level 1—4",Parser.TIER_TO_FULL_LEVEL[2]="level 5—10",Parser.TIER_TO_FULL_LEVEL[3]="level 11—16",Parser.TIER_TO_FULL_LEVEL[4]="level 17—20",Parser.threatToFull=function(e){return Parser._parse_aToB(Parser.THREAT_TO_FULL,e)},Parser.THREAT_TO_FULL={},Parser.THREAT_TO_FULL[1]="moderate",Parser.THREAT_TO_FULL[2]="dangerous",Parser.THREAT_TO_FULL[3]="deadly",Parser.trapInitToFull=function(e){return Parser._parse_aToB(Parser.TRAP_INIT_TO_FULL,e)},Parser.TRAP_INIT_TO_FULL={},Parser.TRAP_INIT_TO_FULL[1]="initiative count 10",Parser.TRAP_INIT_TO_FULL[2]="initiative count 20",Parser.TRAP_INIT_TO_FULL[3]="initiative count 20 and initiative count 10",Parser.ATK_TYPE_TO_FULL={},Parser.ATK_TYPE_TO_FULL.MW="Melee Weapon Attack",Parser.ATK_TYPE_TO_FULL.RW="Ranged Weapon Attack",SKL_ABV_ABJ="A",SKL_ABV_EVO="V",SKL_ABV_ENC="E",SKL_ABV_ILL="I",SKL_ABV_DIV="D",SKL_ABV_NEC="N",SKL_ABV_TRA="T",SKL_ABV_CON="C",SKL_ABJ="Abjuration",SKL_EVO="Evocation",SKL_ENC="Enchantment",SKL_ILL="Illusion",SKL_DIV="Divination",SKL_NEC="Necromancy",SKL_TRA="Transmutation",SKL_CON="Conjuration",Parser.SP_SCHOOL_ABV_TO_FULL={},Parser.SP_SCHOOL_ABV_TO_FULL[SKL_ABV_ABJ]=SKL_ABJ,Parser.SP_SCHOOL_ABV_TO_FULL[SKL_ABV_EVO]=SKL_EVO,Parser.SP_SCHOOL_ABV_TO_FULL[SKL_ABV_ENC]=SKL_ENC,Parser.SP_SCHOOL_ABV_TO_FULL[SKL_ABV_ILL]=SKL_ILL,Parser.SP_SCHOOL_ABV_TO_FULL[SKL_ABV_DIV]=SKL_DIV,Parser.SP_SCHOOL_ABV_TO_FULL[SKL_ABV_NEC]=SKL_NEC,Parser.SP_SCHOOL_ABV_TO_FULL[SKL_ABV_TRA]=SKL_TRA,Parser.SP_SCHOOL_ABV_TO_FULL[SKL_ABV_CON]=SKL_CON,Parser.SP_SCHOOL_ABV_TO_SHORT={},Parser.SP_SCHOOL_ABV_TO_SHORT[SKL_ABV_ABJ]="Abj.",Parser.SP_SCHOOL_ABV_TO_SHORT[SKL_ABV_EVO]="Evoc.",Parser.SP_SCHOOL_ABV_TO_SHORT[SKL_ABV_ENC]="Ench.",Parser.SP_SCHOOL_ABV_TO_SHORT[SKL_ABV_ILL]="Illu.",Parser.SP_SCHOOL_ABV_TO_SHORT[SKL_ABV_DIV]="Divin.",Parser.SP_SCHOOL_ABV_TO_SHORT[SKL_ABV_NEC]="Necro.",Parser.SP_SCHOOL_ABV_TO_SHORT[SKL_ABV_TRA]="Trans.",Parser.SP_SCHOOL_ABV_TO_SHORT[SKL_ABV_CON]="Conj.",Parser.ATB_ABV_TO_FULL={str:"Strength",dex:"Dexterity",con:"Constitution",int:"Intelligence",wis:"Wisdom",cha:"Charisma"},TP_ABERRATION="aberration",TP_BEAST="beast",TP_CELESTIAL="celestial",TP_CONSTRUCT="construct",TP_DRAGON="dragon",TP_ELEMENTAL="elemental",TP_FEY="fey",TP_FIEND="fiend",TP_GIANT="giant",TP_HUMANOID="humanoid",TP_MONSTROSITY="monstrosity",TP_OOZE="ooze",TP_PLANT="plant",TP_UNDEAD="undead",Parser.MON_TYPE_TO_PLURAL={},Parser.MON_TYPE_TO_PLURAL[TP_ABERRATION]="aberrations",Parser.MON_TYPE_TO_PLURAL[TP_BEAST]="beasts",Parser.MON_TYPE_TO_PLURAL[TP_CELESTIAL]="celestials",Parser.MON_TYPE_TO_PLURAL[TP_CONSTRUCT]="constructs",Parser.MON_TYPE_TO_PLURAL[TP_DRAGON]="dragons",Parser.MON_TYPE_TO_PLURAL[TP_ELEMENTAL]="elementals",Parser.MON_TYPE_TO_PLURAL[TP_FEY]="fey",Parser.MON_TYPE_TO_PLURAL[TP_FIEND]="fiends",Parser.MON_TYPE_TO_PLURAL[TP_GIANT]="giants",Parser.MON_TYPE_TO_PLURAL[TP_HUMANOID]="humanoids",Parser.MON_TYPE_TO_PLURAL[TP_MONSTROSITY]="monstrosities",Parser.MON_TYPE_TO_PLURAL[TP_OOZE]="oozes",Parser.MON_TYPE_TO_PLURAL[TP_PLANT]="plants",Parser.MON_TYPE_TO_PLURAL[TP_UNDEAD]="undead",SZ_FINE="F",SZ_DIMINUTIVE="D",SZ_TINY="T",SZ_SMALL="S",SZ_MEDIUM="M",SZ_LARGE="L",SZ_HUGE="H",SZ_GARGANTUAN="G",SZ_COLOSSAL="C",SZ_VARIES="V",Parser.SIZE_ABV_TO_FULL={},Parser.SIZE_ABV_TO_FULL[SZ_FINE]="Fine",Parser.SIZE_ABV_TO_FULL[SZ_DIMINUTIVE]="Diminutive",Parser.SIZE_ABV_TO_FULL[SZ_TINY]="Tiny",Parser.SIZE_ABV_TO_FULL[SZ_SMALL]="Small",Parser.SIZE_ABV_TO_FULL[SZ_MEDIUM]="Medium",Parser.SIZE_ABV_TO_FULL[SZ_LARGE]="Large",Parser.SIZE_ABV_TO_FULL[SZ_HUGE]="Huge",Parser.SIZE_ABV_TO_FULL[SZ_GARGANTUAN]="Gargantuan",Parser.SIZE_ABV_TO_FULL[SZ_COLOSSAL]="Colossal",Parser.SIZE_ABV_TO_FULL[SZ_VARIES]="Varies",Parser.XP_CHART=[200,450,700,1100,1800,2300,2900,3900,5e3,5900,7200,8400,1e4,11500,13e3,15e3,18e3,2e4,22e3,25e3,3e4,41e3,5e4,62e3,75e3,9e4,105e3,102e3,135e3,155e3],Parser.ARMOR_ABV_TO_FULL={"l.":"light","m.":"medium","h.":"heavy"},SRC_CoS="CoS",SRC_DMG="DMG",SRC_EEPC="EEPC",SRC_EET="EET",SRC_HotDQ="HotDQ",SRC_LMoP="LMoP",SRC_Mag="Mag",SRC_MM="MM",SRC_OotA="OotA",SRC_PHB="PHB",SRC_PotA="PotA",SRC_RoT="RoT",SRC_RoTOS="RoTOS",SRC_SCAG="SCAG",SRC_SKT="SKT",SRC_ToA="ToA",SRC_ToD="ToD",SRC_TTP="TTP",SRC_TYP="TftYP",SRC_TYP_AtG="TftYP-AtG",SRC_TYP_DiT="TftYP-DiT",SRC_TYP_TFoF="TftYP-TFoF",SRC_TYP_THSoT="TftYP-THSoT",SRC_TYP_TSC="TftYP-TSC",SRC_TYP_ToH="TftYP-ToH",SRC_TYP_WPM="TftYP-WPM",SRC_VGM="VGM",SRC_XGE="XGE",SRC_OGA="OGA",SRC_MTF="MTF",SRC_ALCoS="ALCurseOfStrahd",SRC_ALEE="ALElementalEvil",SRC_ALRoD="ALRageOfDemons",SRC_PS_PREFIX="PS",SRC_PSA=SRC_PS_PREFIX+"A",SRC_PSI=SRC_PS_PREFIX+"I",SRC_PSK=SRC_PS_PREFIX+"K",SRC_PSZ=SRC_PS_PREFIX+"Z",SRC_PSX=SRC_PS_PREFIX+"X",SRC_UA_PREFIX="UA",SRC_UAA=SRC_UA_PREFIX+"Artificer",SRC_UAEAG=SRC_UA_PREFIX+"EladrinAndGith",SRC_UAEBB=SRC_UA_PREFIX+"Eberron",SRC_UAFFR=SRC_UA_PREFIX+"FeatsForRaces",SRC_UAFFS=SRC_UA_PREFIX+"FeatsForSkills",SRC_UAFO=SRC_UA_PREFIX+"FiendishOptions",SRC_UAFT=SRC_UA_PREFIX+"Feats",SRC_UAGH=SRC_UA_PREFIX+"GothicHeroes",SRC_UAMDM=SRC_UA_PREFIX+"ModernMagic",SRC_UASSP=SRC_UA_PREFIX+"StarterSpells",SRC_UATMC=SRC_UA_PREFIX+"TheMysticClass",SRC_UATOBM=SRC_UA_PREFIX+"ThatOldBlackMagic",SRC_UATRR=SRC_UA_PREFIX+"TheRangerRevised",SRC_UAWA=SRC_UA_PREFIX+"WaterborneAdventures",SRC_UAVR=SRC_UA_PREFIX+"VariantRules",SRC_UALDR=SRC_UA_PREFIX+"LightDarkUnderdark",SRC_UARAR=SRC_UA_PREFIX+"RangerAndRogue",SRC_UAATOSC=SRC_UA_PREFIX+"ATrioOfSubclasses",SRC_UABPP=SRC_UA_PREFIX+"BarbarianPrimalPaths",SRC_UARSC=SRC_UA_PREFIX+"RevisedSubclasses",SRC_UAKOO=SRC_UA_PREFIX+"KitsOfOld",SRC_UABBC=SRC_UA_PREFIX+"BardBardColleges",SRC_UACDD=SRC_UA_PREFIX+"ClericDivineDomains",SRC_UAD=SRC_UA_PREFIX+"Druid",SRC_UARCO=SRC_UA_PREFIX+"RevisedClassOptions",SRC_UAF=SRC_UA_PREFIX+"Fighter",SRC_UAM=SRC_UA_PREFIX+"Monk",SRC_UAP=SRC_UA_PREFIX+"Paladin",SRC_UAMC=SRC_UA_PREFIX+"ModifyingClasses",SRC_UAS=SRC_UA_PREFIX+"Sorcerer",SRC_UAWAW=SRC_UA_PREFIX+"WarlockAndWizard",SRC_UATF=SRC_UA_PREFIX+"TheFaithful",SRC_UAWR=SRC_UA_PREFIX+"WizardRevisited",SRC_UAESR=SRC_UA_PREFIX+"ElfSubraces",SRC_UAMAC=SRC_UA_PREFIX+"MassCombat",SRC_UA3PE=SRC_UA_PREFIX+"ThreePillarExperience",SRC_UAGHI=SRC_UA_PREFIX+"GreyhawkInitiative",SRC_UATSC=SRC_UA_PREFIX+"ThreeSubclasses",SRC_UAOD=SRC_UA_PREFIX+"OrderDomain",SRC_UACAM=SRC_UA_PREFIX+"CentaursMinotaurs",SRC_UAGSS=SRC_UA_PREFIX+"GiantSoulSorcerer",SRC_3PP_SUFFIX=" 3pp",SRC_STREAM="Stream",SRC_TWITTER="Twitter",AL_PREFIX="Adventurers League: ",AL_PREFIX_SHORT="AL: ",PS_PREFIX="Plane Shift: ",PS_PREFIX_SHORT="PS: ",UA_PREFIX="Unearthed Arcana: ",UA_PREFIX_SHORT="UA: ",TftYP_NAME="Tales from the Yawning Portal",Parser.SOURCE_JSON_TO_FULL={},Parser.SOURCE_JSON_TO_FULL[SRC_CoS]="Curse of Strahd",Parser.SOURCE_JSON_TO_FULL[SRC_DMG]="Dungeon Master's Guide",Parser.SOURCE_JSON_TO_FULL[SRC_EEPC]="Elemental Evil Player's Companion",Parser.SOURCE_JSON_TO_FULL[SRC_EET]="Elemental Evil: Trinkets",Parser.SOURCE_JSON_TO_FULL[SRC_HotDQ]="Hoard of the Dragon Queen",Parser.SOURCE_JSON_TO_FULL[SRC_LMoP]="Lost Mine of Phandelver",Parser.SOURCE_JSON_TO_FULL[SRC_Mag]="Dragon Magazine",Parser.SOURCE_JSON_TO_FULL[SRC_MM]="Monster Manual",Parser.SOURCE_JSON_TO_FULL[SRC_OotA]="Out of the Abyss",Parser.SOURCE_JSON_TO_FULL[SRC_PHB]="Player's Handbook",Parser.SOURCE_JSON_TO_FULL[SRC_PotA]="Princes of the Apocalypse",Parser.SOURCE_JSON_TO_FULL[SRC_RoT]="The Rise of Tiamat",Parser.SOURCE_JSON_TO_FULL[SRC_RoTOS]="The Rise of Tiamat Online Supplement",Parser.SOURCE_JSON_TO_FULL[SRC_SCAG]="Sword Coast Adventurer's Guide",Parser.SOURCE_JSON_TO_FULL[SRC_SKT]="Storm King's Thunder",Parser.SOURCE_JSON_TO_FULL[SRC_ToA]="Tomb of Annihilation",Parser.SOURCE_JSON_TO_FULL[SRC_ToD]="Tyranny of Dragons",Parser.SOURCE_JSON_TO_FULL[SRC_TTP]="The Tortle Package",Parser.SOURCE_JSON_TO_FULL[SRC_TYP]=TftYP_NAME,Parser.SOURCE_JSON_TO_FULL[SRC_TYP_AtG]=TftYP_NAME,Parser.SOURCE_JSON_TO_FULL[SRC_TYP_DiT]=TftYP_NAME,Parser.SOURCE_JSON_TO_FULL[SRC_TYP_TFoF]=TftYP_NAME,Parser.SOURCE_JSON_TO_FULL[SRC_TYP_THSoT]=TftYP_NAME,Parser.SOURCE_JSON_TO_FULL[SRC_TYP_TSC]=TftYP_NAME,Parser.SOURCE_JSON_TO_FULL[SRC_TYP_ToH]=TftYP_NAME,Parser.SOURCE_JSON_TO_FULL[SRC_TYP_WPM]=TftYP_NAME,Parser.SOURCE_JSON_TO_FULL[SRC_VGM]="Volo's Guide to Monsters",Parser.SOURCE_JSON_TO_FULL[SRC_XGE]="Xanathar's Guide to Everything",Parser.SOURCE_JSON_TO_FULL[SRC_OGA]="One Grung Above",Parser.SOURCE_JSON_TO_FULL[SRC_MTF]="Mordenkainen's Tome of Foes",Parser.SOURCE_JSON_TO_FULL[SRC_ALCoS]=AL_PREFIX+"Curse of Strahd",Parser.SOURCE_JSON_TO_FULL[SRC_ALEE]=AL_PREFIX+"Elemental Evil",Parser.SOURCE_JSON_TO_FULL[SRC_ALRoD]=AL_PREFIX+"Rage of Demons",Parser.SOURCE_JSON_TO_FULL[SRC_PSA]=PS_PREFIX+"Amonkhet",Parser.SOURCE_JSON_TO_FULL[SRC_PSI]=PS_PREFIX+"Innistrad",Parser.SOURCE_JSON_TO_FULL[SRC_PSK]=PS_PREFIX+"Kaladesh",Parser.SOURCE_JSON_TO_FULL[SRC_PSZ]=PS_PREFIX+"Zendikar",Parser.SOURCE_JSON_TO_FULL[SRC_PSX]=PS_PREFIX+"Ixalan",Parser.SOURCE_JSON_TO_FULL[SRC_UAA]=UA_PREFIX+"Artificer",Parser.SOURCE_JSON_TO_FULL[SRC_UAEAG]=UA_PREFIX+"Eladrin and Gith",Parser.SOURCE_JSON_TO_FULL[SRC_UAEBB]=UA_PREFIX+"Eberron",Parser.SOURCE_JSON_TO_FULL[SRC_UAFFR]=UA_PREFIX+"Feats for Races",Parser.SOURCE_JSON_TO_FULL[SRC_UAFFS]=UA_PREFIX+"Feats for Skills",Parser.SOURCE_JSON_TO_FULL[SRC_UAFO]=UA_PREFIX+"Fiendish Options",Parser.SOURCE_JSON_TO_FULL[SRC_UAFT]=UA_PREFIX+"Feats",Parser.SOURCE_JSON_TO_FULL[SRC_UAGH]=UA_PREFIX+"Gothic Heroes",Parser.SOURCE_JSON_TO_FULL[SRC_UAMDM]=UA_PREFIX+"Modern Magic",Parser.SOURCE_JSON_TO_FULL[SRC_UASSP]=UA_PREFIX+"Starter Spells",Parser.SOURCE_JSON_TO_FULL[SRC_UATMC]=UA_PREFIX+"The Mystic Class",Parser.SOURCE_JSON_TO_FULL[SRC_UATOBM]=UA_PREFIX+"That Old Black Magic",Parser.SOURCE_JSON_TO_FULL[SRC_UATRR]=UA_PREFIX+"The Ranger, Revised",Parser.SOURCE_JSON_TO_FULL[SRC_UAWA]=UA_PREFIX+"Waterborne Adventures",Parser.SOURCE_JSON_TO_FULL[SRC_UAVR]=UA_PREFIX+"Variant Rules",Parser.SOURCE_JSON_TO_FULL[SRC_UALDR]=UA_PREFIX+"Light, Dark, Underdark!",Parser.SOURCE_JSON_TO_FULL[SRC_UARAR]=UA_PREFIX+"Ranger and Rogue",Parser.SOURCE_JSON_TO_FULL[SRC_UAATOSC]=UA_PREFIX+"A Trio of Subclasses",Parser.SOURCE_JSON_TO_FULL[SRC_UABPP]=UA_PREFIX+"Barbarian Primal Paths",Parser.SOURCE_JSON_TO_FULL[SRC_UARSC]=UA_PREFIX+"Revised Subclasses",Parser.SOURCE_JSON_TO_FULL[SRC_UAKOO]=UA_PREFIX+"Kits of Old",Parser.SOURCE_JSON_TO_FULL[SRC_UABBC]=UA_PREFIX+"Bard: Bard Colleges",Parser.SOURCE_JSON_TO_FULL[SRC_UACDD]=UA_PREFIX+"Cleric: Divine Domains",Parser.SOURCE_JSON_TO_FULL[SRC_UAD]=UA_PREFIX+"Druid",Parser.SOURCE_JSON_TO_FULL[SRC_UARCO]=UA_PREFIX+"Revised Class Options",Parser.SOURCE_JSON_TO_FULL[SRC_UAF]=UA_PREFIX+"Fighter",Parser.SOURCE_JSON_TO_FULL[SRC_UAM]=UA_PREFIX+"Monk",Parser.SOURCE_JSON_TO_FULL[SRC_UAP]=UA_PREFIX+"Paladin",Parser.SOURCE_JSON_TO_FULL[SRC_UAMC]=UA_PREFIX+"Modifying Classes",Parser.SOURCE_JSON_TO_FULL[SRC_UAS]=UA_PREFIX+"Sorcerer",Parser.SOURCE_JSON_TO_FULL[SRC_UAWAW]=UA_PREFIX+"Warlock and Wizard",Parser.SOURCE_JSON_TO_FULL[SRC_UATF]=UA_PREFIX+"The Faithful",Parser.SOURCE_JSON_TO_FULL[SRC_UAWR]=UA_PREFIX+"Wizard Revisited",Parser.SOURCE_JSON_TO_FULL[SRC_UAESR]=UA_PREFIX+"Elf Subraces",Parser.SOURCE_JSON_TO_FULL[SRC_UAMAC]=UA_PREFIX+"Mass Combat",Parser.SOURCE_JSON_TO_FULL[SRC_UA3PE]=UA_PREFIX+"Three-Pillar Experience",Parser.SOURCE_JSON_TO_FULL[SRC_UAGHI]=UA_PREFIX+"Greyhawk Initiative",Parser.SOURCE_JSON_TO_FULL[SRC_UATSC]=UA_PREFIX+"Three Subclasses",Parser.SOURCE_JSON_TO_FULL[SRC_UAOD]=UA_PREFIX+"Order Domain",Parser.SOURCE_JSON_TO_FULL[SRC_UACAM]=UA_PREFIX+"Centaurs and Minotaurs",Parser.SOURCE_JSON_TO_FULL[SRC_UAGSS]=UA_PREFIX+"Giant Soul Sorcerer",Parser.SOURCE_JSON_TO_FULL[SRC_STREAM]="Livestream",Parser.SOURCE_JSON_TO_FULL[SRC_TWITTER]="Twitter",Parser.SOURCE_JSON_TO_ABV={},Parser.SOURCE_JSON_TO_ABV[SRC_CoS]="CoS",Parser.SOURCE_JSON_TO_ABV[SRC_DMG]="DMG",Parser.SOURCE_JSON_TO_ABV[SRC_EEPC]="EEPC",Parser.SOURCE_JSON_TO_ABV[SRC_EET]="EET",Parser.SOURCE_JSON_TO_ABV[SRC_HotDQ]="HotDQ",Parser.SOURCE_JSON_TO_ABV[SRC_LMoP]="LMoP",Parser.SOURCE_JSON_TO_ABV[SRC_Mag]="Mag",Parser.SOURCE_JSON_TO_ABV[SRC_MM]="MM",Parser.SOURCE_JSON_TO_ABV[SRC_OotA]="OotA",Parser.SOURCE_JSON_TO_ABV[SRC_PHB]="PHB",Parser.SOURCE_JSON_TO_ABV[SRC_PotA]="PotA",Parser.SOURCE_JSON_TO_ABV[SRC_RoT]="RoT",Parser.SOURCE_JSON_TO_ABV[SRC_RoTOS]="RoTOS",Parser.SOURCE_JSON_TO_ABV[SRC_SCAG]="SCAG",Parser.SOURCE_JSON_TO_ABV[SRC_SKT]="SKT",Parser.SOURCE_JSON_TO_ABV[SRC_ToA]="ToA",Parser.SOURCE_JSON_TO_ABV[SRC_ToD]="ToD",Parser.SOURCE_JSON_TO_ABV[SRC_TTP]="TTP",Parser.SOURCE_JSON_TO_ABV[SRC_TYP]="TftYP",Parser.SOURCE_JSON_TO_ABV[SRC_TYP_AtG]="TftYP",Parser.SOURCE_JSON_TO_ABV[SRC_TYP_DiT]="TftYP",Parser.SOURCE_JSON_TO_ABV[SRC_TYP_TFoF]="TftYP",Parser.SOURCE_JSON_TO_ABV[SRC_TYP_THSoT]="TftYP",Parser.SOURCE_JSON_TO_ABV[SRC_TYP_TSC]="TftYP",Parser.SOURCE_JSON_TO_ABV[SRC_TYP_ToH]="TftYP",Parser.SOURCE_JSON_TO_ABV[SRC_TYP_WPM]="TftYP",Parser.SOURCE_JSON_TO_ABV[SRC_VGM]="VGM",Parser.SOURCE_JSON_TO_ABV[SRC_XGE]="XGE",Parser.SOURCE_JSON_TO_ABV[SRC_OGA]="OGA",Parser.SOURCE_JSON_TO_ABV[SRC_MTF]="MTF",Parser.SOURCE_JSON_TO_ABV[SRC_ALCoS]="ALCoS",Parser.SOURCE_JSON_TO_ABV[SRC_ALEE]="ALEE",Parser.SOURCE_JSON_TO_ABV[SRC_ALRoD]="ALRoD",Parser.SOURCE_JSON_TO_ABV[SRC_PSA]="PSA",Parser.SOURCE_JSON_TO_ABV[SRC_PSI]="PSI",Parser.SOURCE_JSON_TO_ABV[SRC_PSK]="PSK",Parser.SOURCE_JSON_TO_ABV[SRC_PSZ]="PSZ",Parser.SOURCE_JSON_TO_ABV[SRC_PSX]="PSX",Parser.SOURCE_JSON_TO_ABV[SRC_UAA]="UAA",Parser.SOURCE_JSON_TO_ABV[SRC_UAEAG]="UAEaG",Parser.SOURCE_JSON_TO_ABV[SRC_UAEBB]="UAEB",Parser.SOURCE_JSON_TO_ABV[SRC_UAFFR]="UAFFR",Parser.SOURCE_JSON_TO_ABV[SRC_UAFFS]="UAFFS",Parser.SOURCE_JSON_TO_ABV[SRC_UAFO]="UAFO",Parser.SOURCE_JSON_TO_ABV[SRC_UAFT]="UAFT",Parser.SOURCE_JSON_TO_ABV[SRC_UAGH]="UAGH",Parser.SOURCE_JSON_TO_ABV[SRC_UAMDM]="UAMM",Parser.SOURCE_JSON_TO_ABV[SRC_UASSP]="UASS",Parser.SOURCE_JSON_TO_ABV[SRC_UATMC]="UAM",Parser.SOURCE_JSON_TO_ABV[SRC_UATOBM]="UAOBM",Parser.SOURCE_JSON_TO_ABV[SRC_UATRR]="UATRR",Parser.SOURCE_JSON_TO_ABV[SRC_UAWA]="UAWA",Parser.SOURCE_JSON_TO_ABV[SRC_UAVR]="UAVR",Parser.SOURCE_JSON_TO_ABV[SRC_UALDR]="UALDU",Parser.SOURCE_JSON_TO_ABV[SRC_UARAR]="UARAR",Parser.SOURCE_JSON_TO_ABV[SRC_UAATOSC]="UAATOSC",Parser.SOURCE_JSON_TO_ABV[SRC_UABPP]="UABPP",Parser.SOURCE_JSON_TO_ABV[SRC_UARSC]="UARSC",Parser.SOURCE_JSON_TO_ABV[SRC_UAKOO]="UAKOO",Parser.SOURCE_JSON_TO_ABV[SRC_UABBC]="UABBC",Parser.SOURCE_JSON_TO_ABV[SRC_UACDD]="UACDD",Parser.SOURCE_JSON_TO_ABV[SRC_UAD]="UAD",Parser.SOURCE_JSON_TO_ABV[SRC_UARCO]="UARCO",Parser.SOURCE_JSON_TO_ABV[SRC_UAF]="UAF",Parser.SOURCE_JSON_TO_ABV[SRC_UAM]="UAM",Parser.SOURCE_JSON_TO_ABV[SRC_UAP]="UAP",Parser.SOURCE_JSON_TO_ABV[SRC_UAMC]="UAMC",Parser.SOURCE_JSON_TO_ABV[SRC_UAS]="UAS",Parser.SOURCE_JSON_TO_ABV[SRC_UAWAW]="UAWAW",Parser.SOURCE_JSON_TO_ABV[SRC_UATF]="UATF",Parser.SOURCE_JSON_TO_ABV[SRC_UAWR]="UAWR",Parser.SOURCE_JSON_TO_ABV[SRC_UAESR]="UAESR",Parser.SOURCE_JSON_TO_ABV[SRC_UAMAC]="UAMAC",Parser.SOURCE_JSON_TO_ABV[SRC_UA3PE]="UA3PE",Parser.SOURCE_JSON_TO_ABV[SRC_UAGHI]="UAGHI",Parser.SOURCE_JSON_TO_ABV[SRC_UATSC]="UATSC",Parser.SOURCE_JSON_TO_ABV[SRC_UAOD]="UAOD",Parser.SOURCE_JSON_TO_ABV[SRC_UACAM]="UACAM",Parser.SOURCE_JSON_TO_ABV[SRC_UAGSS]="UAGSS",Parser.SOURCE_JSON_TO_ABV[SRC_STREAM]="Stream",Parser.SOURCE_JSON_TO_ABV[SRC_TWITTER]="Twitter",Parser.ITEM_TYPE_JSON_TO_ABV={A:"Ammunition",AF:"Ammunition",AT:"Artisan Tool",EXP:"Explosive",G:"Adventuring Gear",GS:"Gaming Set",HA:"Heavy Armor",INS:"Instrument",LA:"Light Armor",M:"Melee Weapon",MA:"Medium Armor",MNT:"Mount",GV:"Generic Variant",P:"Potion",R:"Ranged Weapon",RD:"Rod",RG:"Ring",S:"Shield",SC:"Scroll",SCF:"Spellcasting Focus",T:"Tool",TAH:"Tack and Harness",TG:"Trade Good",VEH:"Vehicle",SHP:"Vehicle",WD:"Wand"},Parser.DMGTYPE_JSON_TO_FULL={B:"bludgeoning",N:"necrotic",P:"piercing",R:"radiant",S:"slashing"},Parser.SKILL_JSON_TO_FULL={Acrobatics:"Your Dexterity (Acrobatics) check covers your attempt to stay on your feet in a tricky situation, such as when you're trying to run across a sheet of ice, balance on a tightrope, or stay upright on a rocking ship's deck.","Animal Handling":"When there is any question whether you can calm down a domesticated animal, keep a mount from getting spooked, or intuit an animal's intentions, the GM might call for a Wisdom (Animal Handling) check.",Arcana:"Your Intelligence (Arcana) check measures your ability to recall lore about spells, magic items, eldritch symbols, magical traditions, the planes of existence, and the inhabitants of those planes.",Athletics:"Your Strength (Athletics) check covers difficult situations you encounter while climbing, jumping, or swimming.",Deception:"Your Charisma (Deception) check determines whether you can convincingly hide the truth, either verbally or through your actions.",History:"Your Intelligence (History) check measures your ability to recall lore about historical events, legendary people, ancient kingdoms, past disputes, recent wars, and lost civilizations.",Insight:"Your Wisdom (Insight) check decides whether you can determine the true intentions of a creature, such as when searching out a lie or predicting someone's next move.",Intimidation:"When you attempt to influence someone through overt threats, hostile actions, and physical violence, the GM might ask you to make a Charisma (Intimidation) check.",Investigation:"When you look around for clues and make deductions based on those clues, you make an Intelligence (Investigation) check.",Medicine:"A Wisdom (Medicine) check lets you try to stabilize a dying companion or diagnose an illness.",Nature:"Your Intelligence (Nature) check measures your ability to recall lore about terrain, plants and animals, the weather, and natural cycles.",Perception:"Your Wisdom (Perception) check lets you spot, hear, or otherwise detect the presence of something. It measures your general awareness of your surroundings and the keenness of your senses.",Performance:"Your Charisma (Performance) check determines how well you can delight an audience with music, dance, acting, storytelling, or some other form of entertainment.",Persuasion:"When you attempt to influence someone or a group of people with tact, social graces, or good nature, the GM might ask you to make a Charisma (Persuasion) check.",Religion:"Your Intelligence (Religion) check measures your ability to recall lore about deities, rites and prayers, religious hierarchies, holy symbols, and the practices of secret cults.","Sleight of Hand":"Whenever you attempt an act of legerdemain or manual trickery, such as planting something on someone else or concealing an object on your person, make a Dexterity (Sleight of Hand) check.",Stealth:"Make a Dexterity (Stealth) check when you attempt to conceal yourself from enemies, slink past guards, slip away without being noticed, or sneak up on someone without being seen or heard.",Survival:"The GM might ask you to make a Wisdom (Survival) check to follow tracks, hunt wild game, guide your group through frozen wastelands, identify signs that owlbears live nearby, predict the weather, or avoid quicksand and other natural hazards."},Parser.ACTION_JSON_TO_FULL={Dash:"When you take the Dash action, you gain extra movement for the current turn. The increase equals your speed, after applying any modifiers. With a speed of 30 feet, for example, you can move up to 60 feet on your turn if you dash.",Disengage:"If you take the Disengage action, your movement doesn't provoke opportunity attacks for the rest of the turn.",Dodge:"When you take the Dodge action, you focus entirely on avoiding attacks. Until the start of your next turn, any attack roll made against you has disadvantage if you can see the attacker, and you make Dexterity saving throws with advantage.",Help:"You can lend your aid to another creature in the completion of a task. The creature you aid gains advantage on the next ability check it makes to perform the task you are helping with, provided that it makes the check before the start of your next turn.",Hide:"When you take the Hide action, you make a Dexterity (Stealth) check in an attempt to hide, following the rules for hiding.",Ready:"Sometimes you want to get the jump on a foe or wait for a particular circumstance before you act. To do so, you can take the Ready action on your turn, which lets you act using your reaction before the start of your next turn."},Parser.NUMBERS_ONES=["","one","two","three","four","five","six","seven","eight","nine"],Parser.NUMBERS_TENS=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],Parser.NUMBERS_TEENS=["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],SourceUtil={hasBeenReprinted:(e,t)=>(t&&t.source&&(t=t.source),null!=e&&null!=t&&("Sun Soul"===e&&t===SRC_SCAG||"Mastermind"===e&&t===SRC_SCAG||"Swashbuckler"===e&&t===SRC_SCAG||"Storm"===e&&t===SRC_SCAG||"Deep Stalker Conclave"===e&&t===SRC_UATRR)),isNonstandardSource:e=>e&&void 0!==e.forceStandard?!e.forceStandard:(e&&e.source&&(e=e.source),null!=e&&!BrewUtil.hasSourceJson(e)&&(SourceUtil._isNonstandardSourceWiz(e)||SourceUtil._isNonstandardSource3pp(e))),_isNonstandardSourceWiz:e=>e.startsWith(SRC_UA_PREFIX)||e.startsWith(SRC_PS_PREFIX)||e===SRC_OGA||e===SRC_Mag||e===SRC_STREAM||e===SRC_TWITTER,_isNonstandardSource3pp:e=>e.endsWith(SRC_3PP_SUFFIX),getFilterGroup:e=>BrewUtil.hasSourceJson(e)?2:Number(SourceUtil.isNonstandardSource(e))},"undefined"!=typeof window&&window.addEventListener("load",()=>{$.expr[":"].textEquals=((e,t,r)=>{const s=r[3],n=$(e).text().toLowerCase().trim().match(`^${RegExp.escape(s.toLowerCase())}$`);return n&&n.length>0}),$.expr[":"].containsInsensitive=((e,t,r)=>{const s=r[3],n=$(e).contents().filter((e,t)=>3===t.nodeType)[0];if(!n)return!1;const a=n.nodeValue.toLowerCase().trim().match(`${RegExp.escape(s.toLowerCase())}`);return a&&a.length>0})}),MiscUtil={clearSelection(){document.getSelection?(document.getSelection().removeAllRanges(),document.getSelection().addRange(document.createRange())):window.getSelection?window.getSelection().removeAllRanges?(window.getSelection().removeAllRanges(),window.getSelection().addRange(document.createRange())):window.getSelection().empty&&window.getSelection().empty():document.selection&&document.selection.empty()},randomColor(){let e,t,r;const s=RollerUtil.randomise(30,0)/30,n=~~(6*s),a=6*s-n,i=1-a;switch(n%6){case 0:e=1,t=a,r=0;break;case 1:e=i,t=1,r=0;break;case 2:e=0,t=1,r=a;break;case 3:e=0,t=i,r=1;break;case 4:e=a,t=0,r=1;break;case 5:e=1,t=0,r=i}return`#${("00"+(~~(255*e)).toString(16)).slice(-2)}${("00"+(~~(255*t)).toString(16)).slice(-2)}${("00"+(~~(255*r)).toString(16)).slice(-2)}`}},ListUtil={SUB_HASH_PREFIX:"sublistselected",_first:!0,search:e=>{const t=new List("listcontainer",e);t.sort("name"),$("#reset").click(function(){$("#filtertools").find("select").val("All"),$("#search").val(""),t.search(),t.sort("name"),t.filter()});const r=$("#listcontainer");if(r.data("lists")?r.data("lists").push(t):r.data("lists",[t]),ListUtil._first){ListUtil._first=!1;const e=$("header div p");e.html(`${e.html()} Press J/K to navigate rows.`),$(window).on("keypress",e=>{if(noModifierKeys(e)&&("k"===e.key||"j"===e.key)){if("INPUT"===e.target.nodeName||"TEXTAREA"===e.target.nodeName)return;const t=History.getSelectedListElementWithIndex();if(t)if("k"===e.key){const e=t.$el.parent().prev().find("a").attr("href");if(void 0!==e)window.location.hash=e;else{const e=r.data("lists");let s=t.x;for(;--s>=0;){const t=e[s];if(t.visibleItems.length){const e=$(t.visibleItems[t.visibleItems.length-1].elm).find("a").attr("href");return void(e&&(window.location.hash=e))}}}const s=t.$el.closest("ul").parent().prev("li").find("ul li").last().find("a").attr("href");s&&(window.location.hash=s)}else if("j"===e.key){const e=t.$el.parent().next().find("a").attr("href");if(void 0!==e)window.location.hash=e;else{const e=r.data("lists");let s=t.x;for(;++s<e.length;){const t=e[s];if(t.visibleItems.length){const e=$(t.visibleItems[0].elm).find("a").attr("href");return void(e&&(window.location.hash=e))}}}const s=t.$el.closest("ul").parent().next("li").find("ul li").first().find("a").attr("href");s&&(window.location.hash=s)}}})}return t},toggleSelected:(e,t)=>{e.shiftKey?(e.preventDefault(),$(t).toggleClass("list-multi-selected")):(ListUtil._primaryLists.forEach(e=>ListUtil.deslectAll(e)),$(t).addClass("list-multi-selected"))},updateSelected:()=>{ListUtil.toggleSelected({},History.getSelectedListElement().parent())},_ctxInit:{},_ctxClick:{},_handlePreInitContextMenu:e=>{ListUtil._ctxInit[e]||(ListUtil._ctxInit[e]=!0,$("body").click(()=>{$(`#${e}`).hide()}))},_getMenuPosition:(e,t,r,s)=>{const n=$(window)[r](),a=$(window)[s](),i=$(`#${e}`)[r]();let o=t+a;return t+i>n&&i<t&&(o-=i),o},initContextMenu:(e,...t)=>{ListUtil._handleInitContextMenu("contextMenu",e,t)},openContextMenu:(e,t)=>{const r=ListUtil._primaryLists.map(e=>ListUtil.getSelectedCount(e)).reduce((e,t)=>e+t,0);1===r&&ListUtil._primaryLists.forEach(e=>ListUtil.deslectAll(e)),0!==r&&1!==r||$(t).addClass("list-multi-selected"),ListUtil._handleOpenContextMenu(e,t,"contextMenu")},initSubContextMenu:(e,...t)=>{ListUtil._handleInitContextMenu("contextSubMenu",e,t)},openSubContextMenu:(e,t)=>{ListUtil._handleOpenContextMenu(e,t,"contextSubMenu")},_handleInitContextMenu:(e,t,r)=>{ListUtil._ctxClick[e]=t,ListUtil._handlePreInitContextMenu(e);let s=`<ul id="${e}" class="dropdown-menu" role="menu">`;r.forEach((e,t)=>{s+=`<li><a data-ctx-id="${t}" href="${STR_VOID_LINK}">${e}</a></li>`}),s+="</ul>",$("body").append(s)},_handleOpenContextMenu:(e,t,r)=>{if(e.ctrlKey)return;e.preventDefault();const s=$(`#${r}`).data("invokedOn",$(e.target).closest("li.row")).show().css({position:"absolute",left:ListUtil._getMenuPosition(r,e.clientX,"width","scrollLeft"),top:ListUtil._getMenuPosition(r,e.clientY,"height","scrollTop")}).off("click").on("click","a",function(n){s.hide();const a=s.data("invokedOn"),i=$(n.target);ListUtil._ctxClick[r](e,t,a,i)})},$sublistContainer:null,sublist:null,$sublist:null,_sublistChangeFn:null,_allItems:null,_primaryLists:[],_pinned:{},initSublist:e=>{ListUtil._allItems=e.itemList,ListUtil._getSublistRow=e.getSublistRow,ListUtil._sublistChangeFn=e.onUpdate,ListUtil._primaryLists=e.primaryLists,delete e.itemList,delete e.getSublistRow,delete e.onUpdate,delete e.primaryLists,ListUtil.$sublistContainer=$("#sublistcontainer");const t=new List("sublistcontainer",e);return ListUtil.sublist=t,ListUtil.$sublist=$(`ul.${e.listClass}`),t},setOptions:e=>{void 0!==e.itemList&&(ListUtil._allItems=e.itemList),void 0!==e.getSublistRow&&(ListUtil._getSublistRow=e.getSublistRow),void 0!==e.onUpdate&&(ListUtil._sublistChangeFn=e.onUpdate),void 0!==e.primaryLists&&(ListUtil._primaryLists=e.primaryLists)},getOrTabRightButton:(e,t)=>{let r=$(`#${e}`);return r.length||(r=$(`<span class="stat-tab btn btn-default" id="${e}"><span class="glyphicon glyphicon-${t}"></span></span>`).appendTo($("#tabs-right"))),r},bindPinButton:()=>{ListUtil.getOrTabRightButton("btn-pin","pushpin").off("click").on("click",()=>{ListUtil.isSublisted(History.lastLoadedId)?ListUtil.doSublistRemove(History.lastLoadedId):ListUtil.doSublistAdd(History.lastLoadedId,!0)}).attr("title","Pin (Toggle)")},bindAddButton:()=>{ListUtil.getOrTabRightButton("btn-sublist-add","plus").off("click").on("click",e=>{e.shiftKey?ListUtil.doSublistAdd(History.lastLoadedId,!0,20):ListUtil.doSublistAdd(History.lastLoadedId,!0)}).attr("title","Add (SHIFT for 20)")},bindSubtractButton:()=>{ListUtil.getOrTabRightButton("btn-sublist-subtract","minus").off("click").on("click",e=>{e.shiftKey?ListUtil.doSublistSubtract(History.lastLoadedId,20):ListUtil.doSublistSubtract(History.lastLoadedId)}).attr("title","Subtract (SHIFT for 20)")},bindDownloadButton:()=>{const e=ListUtil.getOrTabRightButton("btn-sublist-download","download");e.off("click").on("click",t=>{if(t.shiftKey){const t=JSON.stringify(ListUtil._getExportableSublist());copyText([window.location.href,UrlUtil.packSubHash(ListUtil.SUB_HASH_PREFIX,[t],!0)].join(HASH_PART_SEP)),showCopiedEffect(e)}else{const e=`${UrlUtil.getCurrentPage().replace(".html","")}-sublist`;DataUtil.userDownload(e,JSON.stringify(ListUtil._getExportableSublist(),null,"\t"))}}).attr("title","Download List (SHIFT for Link)")},bindUploadButton:e=>{ListUtil.getOrTabRightButton("btn-sublist-upload","upload").off("click").on("click",t=>{const r=t.shiftKey,s=$('<input type="file" accept=".json" style="position: fixed; top: -100px; left: -100px; display: none;">').on("change",t=>{!function(t,r){const n=t.target,a=new FileReader;a.onload=(()=>{const t=a.result,n=JSON.parse(t),i=()=>{ListUtil._loadSavedSublist(n.items,r),s.remove(),ListUtil._finaliseSublist()};e?e(n,i):i()}),a.readAsText(n.files[0])}(t,r)}).appendTo($("body"));s.click()}).attr("title","Upload List (SHIFT for Add Only)")},setFromSubHashes:(e,t)=>{function r(e){ListUtil._loadSavedSublist(e.items,!1),ListUtil._finaliseSublist();const[t,...r]=History._getHashParts(),n=[];Object.keys(s).filter(e=>e!==ListUtil.SUB_HASH_PREFIX).forEach(e=>{n.push(`${e}${HASH_SUB_KV_SEP}${s[e].join(HASH_SUB_LIST_SEP)}`)}),History.setSuppressHistory(!0),window.location.hash=`#${t}${n.length?`${HASH_PART_SEP}${n.join(HASH_PART_SEP)}`:""}`}const s={};e.forEach(e=>Object.assign(s,UrlUtil.unpackSubHash(e,!0)));const n=s[ListUtil.SUB_HASH_PREFIX];if(n){const e=JSON.parse(n);t?t(e,()=>r(e)):r(e)}},doSublistAdd:(e,t,r)=>{if(null==e)return void alert("Please first view something from the list");const s=ListUtil._pinned[e]||0;r=r||1,ListUtil._pinned[e]=s+r,0===s?ListUtil.$sublist.append(ListUtil._getSublistRow(ListUtil._allItems[e],e,r)):ListUtil._setCount(e,s+r),t&&ListUtil._finaliseSublist()},doSublistSubtract:(e,t)=>{const r=ListUtil._pinned[e]||0;r>(t=t||1)?(ListUtil._pinned[e]=r-t,ListUtil._setCount(e,r-t),ListUtil._handleCallUpdateFn()):r&&ListUtil.doSublistRemove(e)},getSublistedIds:()=>Object.keys(ListUtil._pinned).map(e=>Number(e)),_setCount:(e,t)=>{const r=$(ListUtil.sublist.get("id",e)[0].elm).find(".count");r.find("input").length?r.find("input").val(t):r.text(t)},_finaliseSublist:e=>{ListUtil.sublist.reIndex(),ListUtil._updateSublistVisibility(),e||ListUtil._saveSublist(),ListUtil._handleCallUpdateFn()},_getExportableSublist:()=>{const e=new Set;return{items:ListUtil.sublist.items.map(t=>{const r=$(t.elm);return e.add(ListUtil._allItems[Number(r.attr(FLTR_ID))].source),{h:r.find("a").prop("hash").slice(1),c:r.find(".count").text()||void 0}}),sources:Array.from(e)}},_saveSublist:()=>{StorageUtil.setForPage("sublist",ListUtil._getExportableSublist())},_updateSublistVisibility:()=>{ListUtil.sublist.items.length?ListUtil.$sublistContainer.show():ListUtil.$sublistContainer.hide()},doSublistRemove:e=>{delete ListUtil._pinned[e],ListUtil.sublist.remove("id",e),ListUtil._updateSublistVisibility(),ListUtil._saveSublist(),ListUtil._handleCallUpdateFn()},doSublistRemoveAll:e=>{ListUtil._pinned={},ListUtil.sublist.clear(),ListUtil._updateSublistVisibility(),e||ListUtil._saveSublist(),ListUtil._handleCallUpdateFn()},isSublisted:e=>ListUtil._pinned[e],deslectAll:e=>{e.items.forEach(e=>e.elm.className=e.elm.className.replace(/list-multi-selected/g,""))},forEachSelected:(e,t)=>{e.items.filter(e=>e.elm.className.includes("list-multi-selected")).map(e=>(e.elm.className=e.elm.className.replace(/list-multi-selected/g,""),e.elm.getAttribute(FLTR_ID))).forEach(e=>t(e))},getSelectedCount:e=>e.items.filter(e=>e.elm.className.includes("list-multi-selected")).length,isAnySelected:e=>!!e.items.find(e=>e.elm.className.includes("list-multi-selected")),_handleCallUpdateFn:()=>{ListUtil._sublistChangeFn&&ListUtil._sublistChangeFn()},_hasLoadedState:!1,loadState:()=>{if(!ListUtil._hasLoadedState){ListUtil._hasLoadedState=!0;try{const e=StorageUtil.getForPage("sublist");e&&e.items&&ListUtil._loadSavedSublist(e.items)}catch(e){StorageUtil.removeForPage("sublist"),setTimeout(()=>{throw e})}}},_loadSavedSublist:(e,t)=>{t||ListUtil.doSublistRemoveAll(!0),e.forEach(e=>{const t=History._getListElem(e.h),r=t?t.attr("id"):null;null!=r&&ListUtil.doSublistAdd(r,!1,Number(e.c))}),ListUtil._finaliseSublist(!0)},getSelectedSources:()=>{const e=StorageUtil.getForPage("sublist");if(e&&e.sources)return e.sources},initGenericPinnable:()=>{ListUtil.initContextMenu(ListUtil.handleGenericContextMenuClick,"Popout","Pin"),ListUtil.initSubContextMenu(ListUtil.handleGenericSubContextMenuClick,"Popout","Unpin","Clear Pins")},handleGenericContextMenuClick:(e,t,r,s)=>{const n=Number(r.attr(FLTR_ID));switch(Number(s.data("ctx-id"))){case 0:EntryRenderer.hover.doPopout(r,ListUtil._allItems,n,e.clientX);break;case 1:ListUtil._primaryLists.forEach(e=>{ListUtil.forEachSelected(e,e=>{ListUtil.isSublisted(e)||ListUtil.doSublistAdd(e)})}),ListUtil._finaliseSublist()}},handleGenericSubContextMenuClick:(e,t,r,s)=>{const n=Number(r.attr(FLTR_ID));switch(Number(s.data("ctx-id"))){case 0:EntryRenderer.hover.doPopout(r,ListUtil._allItems,n,e.clientX);break;case 1:ListUtil.doSublistRemove(n);break;case 2:ListUtil.doSublistRemoveAll()}},initGenericAddable:()=>{ListUtil.initContextMenu(ListUtil.handleGenericMultiContextMenuClick,"Popout","Add"),ListUtil.initSubContextMenu(ListUtil.handleGenericMulriSubContextMenuClick,"Popout","Remove","Clear List")},handleGenericMultiContextMenuClick:(e,t,r,s)=>{const n=Number(r.attr(FLTR_ID));switch(Number(s.data("ctx-id"))){case 0:EntryRenderer.hover.doPopout(r,ListUtil._allItems,n,e.clientX);break;case 1:ListUtil._primaryLists.forEach(e=>{ListUtil.forEachSelected(e,e=>ListUtil.doSublistAdd(e))}),ListUtil._finaliseSublist()}},handleGenericMulriSubContextMenuClick:(e,t,r,s)=>{const n=Number(r.attr(FLTR_ID));switch(Number(s.data("ctx-id"))){case 0:EntryRenderer.hover.doPopout(r,itemList,n,e.clientX);break;case 1:ListUtil.doSublistRemove(n);break;case 2:ListUtil.doSublistRemoveAll()}},getSearchTermAndReset:(e,...t)=>{let r=null;return e.searched&&(r=$("#search").val(),e.search(),t.forEach(e=>e.search())),e.filter(),t.forEach(e=>e.filter()),r},toggleCheckbox(e,t){const r=$(t).find("input");r.prop("checked",!r.prop("checked"))},getCompleteSources:e=>e.otherSources?[e.source].concat(e.otherSources.map(e=>e.source)):e.source,bindShowTableButton(e,t,r,s,n){$(`#${e}`).click("click",()=>ListUtil.showTable(t,r,s,n))},getVisibleIds:()=>BrewUtil._lists.map(e=>e.visibleItems.map(e=>Number(e.elm.getAttribute(FLTR_ID)))).reduce((e,t)=>e.concat(t),[]),showTable(e,t,r,s,n){const a=$('<div class="modal-outer dropdown-menu"/>'),i=$('<div class="modal-wrapper">').appendTo($("body")).click(()=>i.remove());a.appendTo(i);const o=$('<div class="modal-inner"/>').appendTo(a).click(e=>e.stopPropagation()),l=$('<div class="split my-3"/>').appendTo(o),_=$('<div class="flex" style="align-items: center;"/>').appendTo(l);Object.values(r).forEach((e,t)=>{const r=$(`<label class="flex-${e.flex} px-2 mr-2 no-wrap inline-flex">${e.name} </label>`).appendTo(_),s=$(`<input type="checkbox" class="ml-1" data-name="${e.name}" checked>`).click(()=>{const e=o.find(`.col_${t}`);s.prop("checked")?e.show():e.hide()}).appendTo(r)});const c=$("<div/>").appendTo(l);function S(){const e=_.find("input:checked").map((e,t)=>$(t).data("name")).get(),t=o.find(".data-row").map((e,t)=>$(t)).get().map(e=>e.find("td:visible").map((e,t)=>$(t).text()).get());return DataUtil.getCsv(e,t)}$('<div class="btn btn-primary mr-3">Download CSV</div>').click(()=>{DataUtil.userDownloadText(`${e}.csv`,S())}).appendTo(c);const u=$('<div class="btn btn-primary">Copy CSV to Clipboard</div>').click(()=>{copyText(S()),showCopiedEffect(u)}).appendTo(c);o.append("<hr>"),"object"==typeof s&&s.generator&&(s=s.generator());let U=`<table class="table-striped" style="width: 100%;"><thead><tr class="flex">${Object.values(r).map((e,t)=>`<th class="col_${t} flex-${e.flex} px-2">${e.name}</th>`).join("")}</tr></thead><tbody>`;(n?JSON.parse(JSON.stringify(t)).sort(n):t).filter((e,t)=>s?s(t):e).forEach(e=>{U+='<tr class="flex data-row">',U+=Object.keys(r).map((t,s)=>{const n=r[t];return`<td class="col_${s} flex-${n.flex} px-2">${!0===n.transform?e[t]:n.transform(e[t])}</td>`}).join(""),U+="</tr>"}),U+="</tbody></table>",o.append(U)}},UrlUtil={},UrlUtil.encodeForHash=function(e){return e instanceof Array?e.map(e=>t(e)).join(HASH_LIST_SEP):t(e);function t(e){return encodeURIComponent(e).toLowerCase()}},UrlUtil.autoEncodeHash=function(e){const t=UrlUtil.getCurrentPage(),r=UrlUtil.URL_TO_HASH_BUILDER[t];if(!r)throw new Error(`No encoder found for page ${t}`);return r(e)},UrlUtil.getCurrentPage=function(){const e=window.location.pathname.split("/");let t=e[e.length-1];return t.toLowerCase().endsWith(".html")||(t+=".html"),t},UrlUtil.link=function(e){function t(t){return e.includes("?")?`${t}&ver=${VERSION_NUMBER}`:`${t}?ver=${VERSION_NUMBER}`}return!IS_ROLL20&&IS_DEPLOYED?t(`${DEPLOYED_STATIC_ROOT}${e}`):IS_DEPLOYED?t(e):e},UrlUtil.unpackSubHash=function(e,t){if(e.includes(HASH_SUB_KV_SEP)){const r=e.split(HASH_SUB_KV_SEP).map(e=>e.trim()),s={};let n=r[0].toLowerCase();t&&(n=decodeURIComponent(n));let a=r[1].toLowerCase();return t&&(a=decodeURIComponent(a)),s[n]=a.split(HASH_SUB_LIST_SEP).map(e=>e.trim()),1===s[n].length&&s[n]===HASH_SUB_NONE&&(s[n]=[]),s}throw new Error(`Baldy formatted subhash ${e}`)},UrlUtil.packSubHash=function(e,t,r){return r&&(e=encodeURIComponent(e.toLowerCase()),t=t.map(e=>encodeURIComponent(e.toLowerCase()))),`${e}${HASH_SUB_KV_SEP}${t.join(HASH_SUB_LIST_SEP)}`},UrlUtil.categoryToPage=function(e){return UrlUtil.CAT_TO_PAGE[e]},UrlUtil.PG_BESTIARY="bestiary.html",UrlUtil.PG_SPELLS="spells.html",UrlUtil.PG_BACKGROUNDS="backgrounds.html",UrlUtil.PG_ITEMS="items.html",UrlUtil.PG_CLASSES="classes.html",UrlUtil.PG_CONDITIONS_DISEASES="conditionsdiseases.html",UrlUtil.PG_FEATS="feats.html",UrlUtil.PG_INVOCATIONS="invocations.html",UrlUtil.PG_PSIONICS="psionics.html",UrlUtil.PG_RACES="races.html",UrlUtil.PG_REWARDS="rewards.html",UrlUtil.PG_VARIATNRULES="variantrules.html",UrlUtil.PG_ADVENTURE="adventure.html",UrlUtil.PG_ADVENTURES="adventures.html",UrlUtil.PG_DEITIES="deities.html",UrlUtil.PG_CULTS_BOONS="cultsboons.html",UrlUtil.PG_OBJECTS="objects.html",UrlUtil.PG_TRAPS_HAZARDS="trapshazards.html",UrlUtil.PG_QUICKREF="quickreference.html",UrlUtil.URL_TO_HASH_BUILDER={},UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_BESTIARY]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_SPELLS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_BACKGROUNDS]=(e=>UrlUtil.encodeForHash([e.name,Parser.sourceJsonToAbv(e.source)])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_ITEMS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CONDITIONS_DISEASES]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_FEATS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_INVOCATIONS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_PSIONICS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_RACES]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_REWARDS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_VARIATNRULES]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_ADVENTURE]=(e=>UrlUtil.encodeForHash(e.id)),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_DEITIES]=(e=>UrlUtil.encodeForHash([e.name,e.pantheon,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CULTS_BOONS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_OBJECTS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_TRAPS_HAZARDS]=(e=>UrlUtil.encodeForHash([e.name,e.source])),UrlUtil.CAT_TO_PAGE={},UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_CREATURE]=UrlUtil.PG_BESTIARY,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_SPELL]=UrlUtil.PG_SPELLS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_BACKGROUND]=UrlUtil.PG_BACKGROUNDS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_ITEM]=UrlUtil.PG_ITEMS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_CLASS]=UrlUtil.PG_CLASSES,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_CONDITION]=UrlUtil.PG_CONDITIONS_DISEASES,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_FEAT]=UrlUtil.PG_FEATS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_ELDRITCH_INVOCATION]=UrlUtil.PG_INVOCATIONS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_PSIONIC]=UrlUtil.PG_PSIONICS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_RACE]=UrlUtil.PG_RACES,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_OTHER_REWARD]=UrlUtil.PG_REWARDS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_VARIANT_OPTIONAL_RULE]=UrlUtil.PG_VARIATNRULES,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_ADVENTURE]=UrlUtil.PG_ADVENTURE,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_DEITY]=UrlUtil.PG_DEITIES,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_OBJECT]=UrlUtil.PG_OBJECTS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_TRAP]=UrlUtil.PG_TRAPS_HAZARDS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_HAZARD]=UrlUtil.PG_TRAPS_HAZARDS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_QUICKREF]=UrlUtil.PG_QUICKREF,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_CULT]=UrlUtil.PG_CULTS_BOONS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_BOON]=UrlUtil.PG_CULTS_BOONS,UrlUtil.CAT_TO_PAGE[Parser.CAT_ID_DISEASE]=UrlUtil.PG_CONDITIONS_DISEASES,UrlUtil.bindLinkExportButton=(e=>{const t=ListUtil.getOrTabRightButton("btn-link-export","magnet");t.addClass("btn-copy-effect").off("click").on("click",r=>{let s=window.location.href;const n=e.getAsSubHashes();if(parts=Object.keys(n).map(e=>{const t=n[e];return UrlUtil.packSubHash(e,t,!0)}),r.shiftKey){const e=JSON.stringify(ListUtil._getExportableSublist()),t=UrlUtil.packSubHash(ListUtil.SUB_HASH_PREFIX,[e],!0);parts=parts.concat(t)}parts.unshift(s),copyText(parts.join(HASH_PART_SEP)),showCopiedEffect(t)}).attr("title","Get Link to Filters (SHIFT adds List)")}),IS_DEPLOYED||IS_ROLL20||"undefined"==typeof window||window.addEventListener("keypress",e=>{if(noModifierKeys(e)&&"undefined"==typeof d20&&"#"===e.key){const e=window.location.href.split("/");window.prompt("Copy to clipboard: Ctrl+C, Enter",`https://5e.tools/${e[e.length-1]}`)}}),SortUtil={ascSort:(e,t)=>e.hasOwnProperty("item")&&t.hasOwnProperty("item")?SortUtil._ascSort(e.item,t.item):SortUtil._ascSort(e,t),_ascSort:(e,t)=>t===e?0:t<e?1:-1,compareNames:(e,t)=>t._values.name.toLowerCase()===e._values.name.toLowerCase()?0:t._values.name.toLowerCase()>e._values.name.toLowerCase()?1:t._values.name.toLowerCase()<e._values.name.toLowerCase()?-1:void 0,listSort:(e,t,r)=>{return"name"===r.valueName?s("name"):function(e,t){const r=s(e);return 0===r?s(t):r}(r.valueName,"name");function s(r){const s=e.values()[r].toLowerCase(),n=t.values()[r].toLowerCase();return s===n?0:s>n?1:-1}},monTraitSort:(e,t)=>e||t?e?t?"special equipment"===e.toLowerCase().trim()?-1:"special equipment"===t.toLowerCase().trim()?1:SortUtil.ascSort(e,t):1:-1:0,_alignFirst:["L","C"],_alignSecond:["G","E"],alignmentSort:(e,t)=>e===t?0:SortUtil._alignFirst.includes(e)?-1:SortUtil._alignSecond.includes(e)?1:SortUtil._alignFirst.includes(t)?1:SortUtil._alignSecond.includes(t)?-1:0},DataUtil={_loaded:{},loadJSON:function(e,...t){return new Promise((r,s)=>{function n(e){r(DataUtil._loaded[e],t)}if(this._loaded[e])return void n(e);const a=UrlUtil.link(e);if(this._loaded[a])return void n(a);const i=o(a);function o(e){const n=new XMLHttpRequest;return n.open("GET",e,!0),n.overrideMimeType("application/json"),n.onload=function(){try{const n=JSON.parse(this.response);DataUtil._loaded[e]=n,r(n,t)}catch(e){s(new Error("Could not parse JSON"))}},n.onerror=(()=>s(new Error("Error during JSON request"))),n}a!==e&&(i.onerror=function(){o(e).send()}),i.send()})},multiLoadJSON:function(e,t,r){e.length||r([]),Promise.all(e.map(e=>this.loadJSON(e.url))).then(s=>{s.forEach((r,s)=>{t&&t(e[s],r)}),r(s)})},userDownload:function(e,t){"string"!=typeof t&&(t=JSON.stringify(t,null,"\t"));const r=$(`<a href="data:text/json;charset=utf-8,${encodeURIComponent(t)}" download="${e}.json" style="display: none;">DL</a>`);$("body").append(r),r[0].click(),r.remove()},getCsv(e,t){function r(e){return e.map(e=>(function(e){return`"${e.replace(/"/g,'""')}"`})(e)).join(",")}return`${r(e)}\n${t.map(e=>r(e)).join("\n")}`},userDownloadText(e,t){const r=$(`<a href="data:text/plain;charset=utf-8,${encodeURIComponent(t)}" download="${e}" style="display: none;">DL</a>`);$("body").append(r),r[0].click(),r.remove()},userUpload(e){$('<input type="file" accept=".json" style="position: fixed; top: -100px; left: -100px; display: none;">').on("change",t=>{!function(t){const r=t.target,s=new FileReader;s.onload=(()=>{const t=s.result,r=JSON.parse(t);e(r)}),s.readAsText(r.files[0])}(t)}).appendTo($("body")).click()},class:{loadJSON:function(e=""){return new Promise(t=>{DataUtil.loadJSON(`${e}data/class/index.json`).then(r=>{Promise.all(Object.values(r).map(t=>DataUtil.loadJSON(`${e}data/class/${t}`))).then(e=>{t(e.reduce((e,t)=>({class:e.class.concat(t.class)}),{class:[]}))})})})}},deity:{doPostLoad:function(e,t){const r=[SRC_PHB,SRC_DMG,SRC_SCAG,SRC_MTF],s={};r.forEach(t=>{s[t]={},e.deity.filter(e=>e.source===t).forEach(e=>s[t][e.reprintAlias||e.name]=e)});const n=[r.last()];[...r].reverse().slice(1).forEach(e=>{n.forEach(t=>{Object.keys(s[e]).forEach(r=>{const n=s[t][r];if(n){const t=s[e][r];t.reprinted=!0,n._isEnhanced||(n.previousVersions=n.previousVersions||[],n.previousVersions.push(t))}})}),n.push(e)}),e.deity.forEach(e=>e._isEnhanced=!0),t(e)},loadJSON:function(e=""){return new Promise(t=>{DataUtil.loadJSON(`${e}data/deities.json`).then(e=>{DataUtil.deity.doPostLoad(e,t)})})}}},RollerUtil={isCrypto:()=>"undefined"!=typeof window&&void 0!==window.crypto,randomise:(e,t=1)=>RollerUtil.isCrypto()?RollerUtil._randomise(t,e+t):RollerUtil.roll(e)+t,_randomise:(e,t)=>{const r=t-e,s=Math.ceil(Math.log2(r)/8),n=new Uint8Array(s),a=Math.pow(Math.pow(2,8),s),i=Math.floor(a/r)*r;let o,l;for(;;){for(window.crypto.getRandomValues(n),l=0,o=0;o<s;o++)l<<=8,l+=n[o];if(l<i)return e+(l%=r)}},roll:e=>Math.floor(Math.random()*e),addListRollButton:()=>{const e=$("#listcontainer"),t=$('<button class="btn btn-default" id="feelinglucky" title="Feeling Lucky?"><span class="glyphicon glyphicon-random"></span></button>');t.on("click",()=>{if(e.data("lists")){const t=e.data("lists").filter(e=>e.visibleItems.length);if(t.length){const e=t[RollerUtil.roll(t.length)],r=RollerUtil.roll(e.visibleItems.length);window.location.hash=$(e.visibleItems[r].elm).find("a").prop("hash")}}}),$("#filter-search-input-group").find("#reset").before(t)},isRollCol:e=>"string"==typeof e&&!!/^({@dice )?(\d+)?d\d+([+-](\d+)?d\d+)*(})?$/.exec(e.trim())},StorageUtil={_fakeStorage:{},getStorage:()=>{try{return window.localStorage}catch(e){return{isFake:!0,getItem:e=>StorageUtil._fakeStorage[e],removeItem:e=>{delete StorageUtil._fakeStorage[e]},setItem:(e,t)=>{StorageUtil._fakeStorage[e]=t}}}},isFake:()=>StorageUtil.getStorage().isFake,setForPage:(e,t)=>{StorageUtil.set(`${e}_${UrlUtil.getCurrentPage()}`,t)},set(e,t){StorageUtil.getStorage().setItem(e,JSON.stringify(t))},getForPage:e=>StorageUtil.get(`${e}_${UrlUtil.getCurrentPage()}`),get(e){const t=StorageUtil.getStorage().getItem(e);return t&&"undefined"!==t&&"null"!==t?JSON.parse(t):null},removeForPage:e=>{StorageUtil.remove(`${e}_${UrlUtil.getCurrentPage()}`)},remove(e){StorageUtil.getStorage().removeItem(e)}},BrewUtil={homebrew:null,homebrewMeta:null,_lists:null,storage:StorageUtil.getStorage(),_sourceCache:null,_filterBox:null,_sourceFilter:null,bind(e){e.list?BrewUtil._lists=[e.list]:e.lists&&(BrewUtil._lists=e.lists),e.filterBox&&(BrewUtil._filterBox=e.filterBox),e.sourceFilter&&(BrewUtil._sourceFilter=e.sourceFilter)},pAddBrewData:()=>new Promise(e=>{if(BrewUtil.homebrew)e(BrewUtil.homebrew);else{const t=BrewUtil.storage.getItem(HOMEBREW_STORAGE),r=BrewUtil.storage.getItem(HOMEBREW_META_STORAGE);new Promise(e=>{r?(BrewUtil.homebrewMeta=JSON.parse(r),BrewUtil.homebrewMeta.sources=BrewUtil.homebrewMeta.sources||[],e()):(BrewUtil.homebrewMeta={sources:[]},e())}).then(new Promise(e=>{t?(BrewUtil.homebrew=JSON.parse(t),e()):(BrewUtil.homebrew={},e())}).then(BrewUtil._pLoadLocal()).then(()=>{BrewUtil._resetSourceCache()}).then(()=>e(BrewUtil.homebrew))).catch(e=>{BrewUtil.purgeBrew(),setTimeout(()=>{throw e})})}}),purgeBrew(e){window.alert("Error when loading homebrew! Purging corrupt data..."),BrewUtil.storage.removeItem(HOMEBREW_STORAGE),BrewUtil.homebrew=null,window.location.hash="",e&&setTimeout(()=>{throw e},1)},_pLoadLocal:(e=((e,t)=>BrewUtil.doHandleBrewJson(e,t,null)))=>DataUtil.loadJSON(`${EntryRenderer.getDefaultRenderer().baseUrl}${JSON_HOMEBREW_INDEX}`).then(t=>{if(t.toImport.length){const r=UrlUtil.getCurrentPage();Promise.all(t.toImport.map(e=>DataUtil.loadJSON(`homebrew/${e}`))).then(t=>{t.forEach(t=>e(t,r)),Promise.resolve()})}else Promise.resolve()}),manageBrew:e=>{const t=UrlUtil.getCurrentPage(),r=$("body");r.css("overflow","hidden");const s=$('<div class="homebrew-overlay"/>');function n(){s.css("background","transparent");const e=$('<div class="homebrew-overlay"/>');return e.on("click",()=>{e.remove(),s.css("background","")}),r.append(e),e}s.on("click",()=>{r.css("overflow",""),s.remove()});const a=$('\n\t\t<div class="homebrew-window dropdown-menu">\n\t\t\t<h4 class="title"><span>Manage Homebrew</span><button class="btn btn-xs btn-danger">Delete All (Including Legacy)</button></h4>\n\t\t\t<hr>\n\t\t</div>');a.on("click",e=>{e.stopPropagation()});const i=a.find("button"),o=$('<div class="current-brew"/>');a.append(o),S();const l=$('<input multiple type="file" accept=".json" style="display: none;">').change(r=>{!function(e,r){const s=e.target;let n=0;const a=new FileReader;a.onload=(()=>{const i=a.result,o=JSON.parse(i);BrewUtil.doHandleBrewJson(o,t,S),ExcludeUtil.setList(o.blacklist||[]),s.files[n]?a.readAsText(s.files[n++]):($(e.target).val(""),r&&r())}),a.readAsText(s.files[n++])}(r,e)}),_=$('<button class="btn btn-default btn-sm">Load from URL</button>');_.click(()=>{const e=window.prompt("Please enter the URL of the homebrew:");if(!e)return;let t;try{t=new URL(e)}catch(e){return void window.alert("The entered URL does not seem to be valid.")}BrewUtil.addBrewRemote(null,t.href).catch(()=>{window.alert("Could not load homebrew from the given URL.")})});const c=$('<button class="btn btn-default btn-sm">Get Homebrew 2.0</button>');function S(){function e(e,t){const r=$('<div class="wrp-btn-del-selected"/>'),s=$('\n\t\t\t\t\t<div id="brewlistcontainer" class="listcontainer homebrew-window dropdown-menu">\n\t\t\t\t\t\t<input type="search" class="search form-control" placeholder="Search entries..." style="width: 100%">\n\t\t\t\t\t\t<div class="filtertools sortlabel btn-group">\n\t\t\t\t\t\t\t<button class="col-xs-7 sort btn btn-default btn-xs" data-sort="name">Name</button>\n\t\t\t\t\t\t\t<button class="col-xs-4 sort btn btn-default btn-xs" data-sort="category">Category</button>\n\t\t\t\t\t\t\t<span class="col-xs-1 wrp-cb-all"><input type="checkbox"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ul class="list brew-list"></ul>\n\t\t\t\t\t</div>\n\t\t\t\t');s.prepend(r),t.append(s),s.on("click",e=>{e.stopPropagation()});const n=s.find(".wrp-cb-all input");function a(){const t=s.find("ul");let r="";BrewUtil._getBrewCategories().forEach(t=>{BrewUtil.homebrew[t].filter(t=>t.source===e).sort((e,t)=>SortUtil.ascSort(e.name,t.name)).forEach(e=>{r+=`<li><section onclick="ListUtil.toggleCheckbox(event, this)">\n\t\t\t\t\t\t\t<span class="col-xs-7 name">${e.name}</span>\n\t\t\t\t\t\t\t<span class="col-xs-4 category">${function(e){return"variantrule"===e?"Variant Rule":e.uppercaseFirst()}(t)}${function(e,t){switch(e){case"subclass":return` (${t.class})`;case"psionic":return` (${Parser.psiTypeToFull(t.type)})`;default:return""}}(t,e)}</span>\n\t\t\t\t\t\t\t<span class="col-xs-1 text-align-center"><input type="checkbox" onclick="event.stopPropagation()"></span>\n\t\t\t\t\t\t\t<span class="hidden uid">${e.uniqueId}</span>\n\t\t\t\t\t\t</section></li>`})}),t.empty(),t.append(r)}a();const i=new List("brewlistcontainer",{valueNames:["name","category","uid"],listClass:"brew-list"});n.change(function(){const e=this.checked;i.items.forEach(t=>$(t.elm).find("input").prop("checked",e))}),$('<button class="btn btn-danger btn-sm">Delete Selected</button>').on("click",()=>{const r=i.items.filter(e=>$(e.elm).find("input").prop("checked")).map(e=>e.values());r.length&&window.confirm("Are you sure?")&&(r.length===i.items.length?(u(e,!1),t.click()):(r.forEach(e=>{d(e.category.toLowerCase().replace(/ /g,""))(e.uid,!1)}),a(),S(),window.location.hash=""))}).appendTo(r)}if(o.empty(),BrewUtil.homebrew){const t=$('\n\t\t\t\t\t<div id="outerbrewlistcontainer" class="listcontainer">\n\t\t\t\t\t\t<input type="search" class="search form-control" placeholder="Search homebrew..." style="width: calc(100% - 3px)">\n\t\t\t\t\t\t<div class="filtertools sortlabel btn-group">\n\t\t\t\t\t\t\t<button class="col-xs-5 sort btn btn-default btn-xs" data-sort="source">Source</button>\n\t\t\t\t\t\t\t<button class="col-xs-4 sort btn btn-default btn-xs" data-sort="authors">Authors</button>\n\t\t\t\t\t\t\t<button class="col-xs-1 btn btn-default btn-xs" disabled>&nbsp;</button>\n\t\t\t\t\t\t\t<button class="col-xs-2 btn btn-default btn-xs" disabled>&nbsp;</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ul class="list-display-only brew-list"></ul>\n\t\t\t\t\t</div>\n\t\t\t\t');o.append(t);const r=t.find("ul");r.empty(),BrewUtil.getJsonSources().forEach(t=>{const s=$(`<li class="row no-click">\n\t\t\t\t\t\t<span class="col-xs-5 col-tall source">${t.full}</span>\n\t\t\t\t\t\t<span class="col-xs-4 col-tall authors">${(t.authors||[]).join(", ")}</span>\n\t\t\t\t\t\t<${t.url?"a":"span"} class="col-xs-1 col-tall" ${t.url?`href="${t.url}" target="_blank"`:""}>${t.url?"Source":""}</${t.url?"a":"span"}>\n\t\t\t\t\t</li>`),a=$('<span class="col-xs-2 text-align-right"/>').appendTo(s);$('<button class="btn btn-sm btn-default">View/Manage</button>').on("click",()=>{const r=n();e(t.json,r)}).appendTo(a),a.append(" "),$('<button class="btn btn-danger btn-sm"><span class="glyphicon glyphicon-trash"></span></button>').on("click",()=>{u(t.json,!0)}).appendTo(a),r.append(s)}),setTimeout(()=>{new List("outerbrewlistcontainer",{valueNames:["source","authors"],listClass:"brew-list"})},5)}}function u(e,t){t&&!window.confirm(`Are you sure you want to remove all homebrew with source "${e}"?`)||(BrewUtil._getBrewCategories().forEach(t=>{const r=BrewUtil.homebrew[t],s=d(t),n=[];r.forEach(t=>{t.source===e&&n.push(t.uniqueId)}),n.forEach(e=>{s(e,!1)})}),BrewUtil.removeJsonSource(e),BrewUtil._sourceFilter&&BrewUtil._sourceFilter.removeIfExists(e),BrewUtil._filterBox&&BrewUtil._filterBox.render(),S(),window.location.hash="",BrewUtil._filterBox&&BrewUtil._filterBox._fireValChangeEvent())}function U(e,t,r){const s=function(e,t){return BrewUtil.homebrew[e].findIndex(e=>e.uniqueId===t)}(e,t);~s&&(BrewUtil.homebrew[e].splice(s,1),BrewUtil.storage.setItem(HOMEBREW_STORAGE,JSON.stringify(BrewUtil.homebrew)),r&&S(),BrewUtil._lists.forEach(e=>e.remove("uniqueid",t)),r&&History.hashChange())}function d(e){switch(e){case"spell":case"monster":case"background":case"feat":case"invocation":case"race":case"object":case"trap":case"hazard":case"deity":case"item":case"itemType":case"itemProperty":case"reward":case"psionic":case"variantrule":case"legendaryGroup":case"condition":case"disease":return function(e){return(t,r)=>{U(e,t,r)}}(e);case"subclass":return P;case"class":return T;case"adventure":return R;default:throw new Error(`No homebrew delete function defined for category ${e}`)}}function T(e,t){U("class",e,t)}function P(e,t){let r,s=0;for(;s<BrewUtil.homebrew.subclass.length;++s)if(BrewUtil.homebrew.subclass[s].uniqueId===e){r=BrewUtil.homebrew.subclass[s];break}if(r){const n=r.class;BrewUtil.homebrew.subclass.splice(s,1),BrewUtil.storage.setItem(HOMEBREW_STORAGE,JSON.stringify(BrewUtil.homebrew));const a=ClassData.classes.find(e=>e.name.toLowerCase()===n.toLowerCase()),i=a.subclasses.findIndex(t=>t.uniqueId===e);~i&&(a.subclasses.splice(i,1),a.subclasses=a.subclasses.sort((e,t)=>SortUtil.ascSort(e.name,t.name))),t&&(S(),window.location.hash="")}}function R(){return(e,t)=>{U("adventure",e,!1),U("adventureData",e,t)}}c.click(()=>{const e=$('\n\t\t\t\t<div id="brewlistcontainer" class="listcontainer homebrew-window dropdown-menu">\n\t\t\t\t\t<input type="search" class="search form-control" placeholder="Find homebrew..." style="width: 100%">\n\t\t\t\t\t<div class="filtertools sortlabel btn-group">\n\t\t\t\t\t\t<button class="col-xs-4 sort btn btn-default btn-xs" data-sort="filename">Filename</button>\n\t\t\t\t\t\t<button class="col-xs-8 sort btn btn-default btn-xs" data-sort="source">Source</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul class="list brew-list">\n\t\t\t\t\t\t<li><section><span style="font-style: italic;">Loading...</span></section></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t');n().append(e),e.on("click",e=>{e.stopPropagation()});const r=e.find("ul");const s=function(){switch(t){case UrlUtil.PG_SPELLS:return["spell"];case UrlUtil.PG_CLASSES:return["class","subclass"];case UrlUtil.PG_BESTIARY:return["creature"];case UrlUtil.PG_BACKGROUNDS:return["background"];case UrlUtil.PG_FEATS:return["feat"];case UrlUtil.PG_INVOCATIONS:return["invocation"];case UrlUtil.PG_RACES:return["race"];case UrlUtil.PG_OBJECTS:return["object"];case UrlUtil.PG_TRAPS_HAZARDS:return["trap","hazard"];case UrlUtil.PG_DEITIES:return["deity"];case UrlUtil.PG_ITEMS:return["item"];case UrlUtil.PG_REWARDS:return["reward"];case UrlUtil.PG_PSIONICS:return["psionic"];case UrlUtil.PG_VARIATNRULES:return["variantrule"];case UrlUtil.PG_CONDITIONS_DISEASES:return["condition","disease"];case UrlUtil.PG_ADVENTURES:return["adventure"];default:throw new Error(`No homebrew properties defined for category ${t}`)}}().map(e=>({url:`https://api.github.com/repos/TheGiddyLimit/homebrew/contents/${e}?client_id=${HOMEBREW_CLIENT_ID}&client_secret=${HOMEBREW_CLIENT_SECRET}&${(new Date).getTime()}`}));DataUtil.multiLoadJSON(s,null,e=>{let t="";[].concat.apply([],e).forEach(e=>{t+=`<li>\n\t\t\t\t\t\t<section onclick="BrewUtil.addBrewRemote(this, '${(e.download_url||"").escapeQuotes()}')">\n\t\t\t\t\t\t\t<span class="col-xs-4 filename">${e.name.trim().replace(/\.json$/,"")}</span>\n\t\t\t\t\t\t\t<span class="col-xs-8 source" title="${e.download_url}">${e.download_url}</span>\n\t\t\t\t\t\t</section>\n\t\t\t\t\t</li>`}),r.empty(),r.append(t);new List("brewlistcontainer",{valueNames:["filename"],listClass:"brew-list"})})}),a.append($('<div class="text-align-center"/>').append(c).append(" ").append($('<label class="btn btn-default btn-sm btn-file">Upload File</label>').append(l)).append(" ").append(_).append(" ").append('<a href="https://github.com/TheGiddyLimit/homebrew" target="_blank"><button class="btn btn-default btn-sm btn-file">Browse Repository</button></a>')),s.append(a),r.append(s),i.on("click",()=>{window.confirm("Are you sure?")&&(BrewUtil.storage.setItem(HOMEBREW_STORAGE,"{}"),BrewUtil.storage.setItem(HOMEBREW_META_STORAGE,"{}"),window.location.hash="",location.reload())}),BrewUtil.addBrewRemote=((r,s)=>{const n=$(r).find("span.source"),a=n.text();return n.text("Loading..."),DataUtil.loadJSON(`${s}?${(new Date).getTime()}`).then(r=>{BrewUtil.doHandleBrewJson(r,t,S),n.text("Done!"),setInterval(()=>{n.text(a)},500),e&&e()})})},doHandleBrewJson:function(e,t,r){e.race&&e.race.length&&(e.race=EntryRenderer.race.mergeSubraces(e.race));const s=["class","subclass","spell","monster","background","feat","invocation","race","deity","item","itemProperty","itemType","psionic","reward","object","trap","hazard","variantrule","legendaryGroup","condition","disease","adventure","adventureData"];s.forEach(function(t){e[t]?e[t].forEach(e=>{e.uniqueId=CryptUtil.md5(JSON.stringify(e))}):e[t]=[]});let n=e._meta?e._meta.sources:[];const a={};switch(s.forEach(t=>a[t]=e[t]),BrewUtil.homebrew?(n=function(){if(!e._meta||!e._meta.sources)return[];const t=[];BrewUtil.homebrewMeta||(BrewUtil.homebrewMeta={sources:[]});const r=BrewUtil.homebrewMeta.sources.map(e=>e.json);return e._meta.sources.forEach(e=>{r.find(t=>t===e.json)||(BrewUtil.homebrewMeta.sources.push(e),t.push(e))}),t}(),s.forEach(t=>a[t]=function(t){const r=[];BrewUtil.homebrew[t]||(BrewUtil.homebrew[t]=[]);const s=BrewUtil.homebrew[t].map(e=>e.uniqueId);return e[t].forEach(e=>{s.find(t=>e.uniqueId===t)||(BrewUtil.homebrew[t].push(e),r.push(e))}),r}(t))):BrewUtil.homebrew=e,BrewUtil.storage.setItem(HOMEBREW_STORAGE,JSON.stringify(BrewUtil.homebrew)),BrewUtil.storage.setItem(HOMEBREW_META_STORAGE,JSON.stringify(BrewUtil.homebrewMeta)),BrewUtil._resetSourceCache(),t){case UrlUtil.PG_SPELLS:case UrlUtil.PG_CLASSES:case UrlUtil.PG_BESTIARY:handleBrew(a);break;case UrlUtil.PG_BACKGROUNDS:addBackgrounds({background:a.background});break;case UrlUtil.PG_FEATS:addFeats({feat:a.feat});break;case UrlUtil.PG_INVOCATIONS:addInvocations({invocation:a.invocation});break;case UrlUtil.PG_RACES:addRaces({race:a.race});break;case UrlUtil.PG_OBJECTS:addObjects({object:a.object});break;case UrlUtil.PG_TRAPS_HAZARDS:handleBrew(a);break;case UrlUtil.PG_DEITIES:addDeities({deity:a.deity});break;case UrlUtil.PG_ITEMS:handleBrew(a);break;case UrlUtil.PG_REWARDS:addRewards({reward:a.reward});break;case UrlUtil.PG_PSIONICS:addPsionics({psionic:a.psionic});break;case UrlUtil.PG_VARIATNRULES:addVariantRules({variantrule:a.variantrule});break;case UrlUtil.PG_CONDITIONS_DISEASES:case UrlUtil.PG_ADVENTURES:handleBrew(a);break;case"NO_PAGE":break;default:throw new Error(`No homebrew add function defined for category ${t}`)}if(r&&r(),BrewUtil._filterBox&&BrewUtil._sourceFilter){const e=BrewUtil._filterBox.getValues();if(e.Source){const r=JSON.parse(JSON.stringify(e.Source));if(r._totals.yes||r._totals.no){t===UrlUtil.PG_CLASSES?r.Core=1:n.forEach(e=>r[e.json]=1);const e=Object.keys(r).filter(e=>!e.startsWith("_")).filter(e=>r[e]).map(e=>`${~r[e]?"":"!"}${e}`.toLowerCase());BrewUtil._filterBox.setFromValues({Source:e})}}BrewUtil._filterBox._fireValChangeEvent()}},makeBrewButton:(e,t)=>{$(`#${e}`).on("click",()=>{BrewUtil.manageBrew(t)})},_getBrewCategories:()=>Object.keys(BrewUtil.homebrew).filter(e=>!e.startsWith("_")),_buildSourceCache(){function e(){BrewUtil.homebrewMeta&&BrewUtil.homebrewMeta.sources&&BrewUtil.homebrewMeta.sources.forEach(e=>BrewUtil._sourceCache[e.json]={abbreviation:e.abbreviation,full:e.full})}if(!BrewUtil._sourceCache)if(BrewUtil._sourceCache={},BrewUtil.homebrewMeta)e();else{const t=BrewUtil.storage.getItem(HOMEBREW_META_STORAGE),r=t&&(JSON.parse(t)||{})._meta||{};r.sources=r.sources||[],BrewUtil._pLoadLocal(e=>{if(e._meta&&!e._meta.sources){const t=r.sources.map(e=>e.json);e._meta.sources.forEach(e=>{t.find(t=>t===e.json)||r.sources.push(e)})}}),BrewUtil.homebrewMeta=r,e()}},_resetSourceCache(){BrewUtil._sourceCache=null},removeJsonSource(e){BrewUtil._resetSourceCache();const t=BrewUtil.homebrewMeta.sources.findIndex(t=>t.json===e);~t&&BrewUtil.homebrewMeta.sources.splice(t,1),BrewUtil.storage.setItem(HOMEBREW_META_STORAGE,JSON.stringify(BrewUtil.homebrewMeta))},getJsonSources:()=>(BrewUtil._buildSourceCache(),BrewUtil.homebrewMeta&&BrewUtil.homebrewMeta.sources?BrewUtil.homebrewMeta.sources:[]),hasSourceJson:e=>(BrewUtil._buildSourceCache(),!!BrewUtil._sourceCache[e]),sourceJsonToFull:e=>(BrewUtil._buildSourceCache(),BrewUtil._sourceCache[e]&&BrewUtil._sourceCache[e].full||e),sourceJsonToAbv:e=>(BrewUtil._buildSourceCache(),BrewUtil._sourceCache[e]&&BrewUtil._sourceCache[e].abbreviation||e),getSearchIndex(){BrewUtil._buildSourceCache();const e=new Omnidexer(Omnisearch.highestId+1);return BrewUtil.homebrew&&(Omnidexer.TO_INDEX__FROM_INDEX_JSON.filter(e=>BrewUtil.homebrew[e.listProp]).forEach(t=>e.addToIndex(t,BrewUtil.homebrew)),Omnidexer.TO_INDEX.filter(e=>BrewUtil.homebrew[e.listProp]).forEach(t=>e.addToIndex(t,BrewUtil.homebrew))),e.getIndex()}},CryptUtil={_md5cycle:(e,t)=>{let r=e[0],s=e[1],n=e[2],a=e[3];r=CryptUtil._ff(r,s,n,a,t[0],7,-680876936),a=CryptUtil._ff(a,r,s,n,t[1],12,-389564586),n=CryptUtil._ff(n,a,r,s,t[2],17,606105819),s=CryptUtil._ff(s,n,a,r,t[3],22,-1044525330),r=CryptUtil._ff(r,s,n,a,t[4],7,-176418897),a=CryptUtil._ff(a,r,s,n,t[5],12,1200080426),n=CryptUtil._ff(n,a,r,s,t[6],17,-1473231341),s=CryptUtil._ff(s,n,a,r,t[7],22,-45705983),r=CryptUtil._ff(r,s,n,a,t[8],7,1770035416),a=CryptUtil._ff(a,r,s,n,t[9],12,-1958414417),n=CryptUtil._ff(n,a,r,s,t[10],17,-42063),s=CryptUtil._ff(s,n,a,r,t[11],22,-1990404162),r=CryptUtil._ff(r,s,n,a,t[12],7,1804603682),a=CryptUtil._ff(a,r,s,n,t[13],12,-40341101),n=CryptUtil._ff(n,a,r,s,t[14],17,-1502002290),s=CryptUtil._ff(s,n,a,r,t[15],22,1236535329),r=CryptUtil._gg(r,s,n,a,t[1],5,-165796510),a=CryptUtil._gg(a,r,s,n,t[6],9,-1069501632),n=CryptUtil._gg(n,a,r,s,t[11],14,643717713),s=CryptUtil._gg(s,n,a,r,t[0],20,-373897302),r=CryptUtil._gg(r,s,n,a,t[5],5,-701558691),a=CryptUtil._gg(a,r,s,n,t[10],9,38016083),n=CryptUtil._gg(n,a,r,s,t[15],14,-660478335),s=CryptUtil._gg(s,n,a,r,t[4],20,-405537848),r=CryptUtil._gg(r,s,n,a,t[9],5,568446438),a=CryptUtil._gg(a,r,s,n,t[14],9,-1019803690),n=CryptUtil._gg(n,a,r,s,t[3],14,-187363961),s=CryptUtil._gg(s,n,a,r,t[8],20,1163531501),r=CryptUtil._gg(r,s,n,a,t[13],5,-1444681467),a=CryptUtil._gg(a,r,s,n,t[2],9,-51403784),n=CryptUtil._gg(n,a,r,s,t[7],14,1735328473),s=CryptUtil._gg(s,n,a,r,t[12],20,-1926607734),r=CryptUtil._hh(r,s,n,a,t[5],4,-378558),a=CryptUtil._hh(a,r,s,n,t[8],11,-2022574463),n=CryptUtil._hh(n,a,r,s,t[11],16,1839030562),s=CryptUtil._hh(s,n,a,r,t[14],23,-35309556),r=CryptUtil._hh(r,s,n,a,t[1],4,-1530992060),a=CryptUtil._hh(a,r,s,n,t[4],11,1272893353),n=CryptUtil._hh(n,a,r,s,t[7],16,-155497632),s=CryptUtil._hh(s,n,a,r,t[10],23,-1094730640),r=CryptUtil._hh(r,s,n,a,t[13],4,681279174),a=CryptUtil._hh(a,r,s,n,t[0],11,-358537222),n=CryptUtil._hh(n,a,r,s,t[3],16,-722521979),s=CryptUtil._hh(s,n,a,r,t[6],23,76029189),r=CryptUtil._hh(r,s,n,a,t[9],4,-640364487),a=CryptUtil._hh(a,r,s,n,t[12],11,-421815835),n=CryptUtil._hh(n,a,r,s,t[15],16,530742520),s=CryptUtil._hh(s,n,a,r,t[2],23,-995338651),r=CryptUtil._ii(r,s,n,a,t[0],6,-198630844),a=CryptUtil._ii(a,r,s,n,t[7],10,1126891415),n=CryptUtil._ii(n,a,r,s,t[14],15,-1416354905),s=CryptUtil._ii(s,n,a,r,t[5],21,-57434055),r=CryptUtil._ii(r,s,n,a,t[12],6,1700485571),a=CryptUtil._ii(a,r,s,n,t[3],10,-1894986606),n=CryptUtil._ii(n,a,r,s,t[10],15,-1051523),s=CryptUtil._ii(s,n,a,r,t[1],21,-2054922799),r=CryptUtil._ii(r,s,n,a,t[8],6,1873313359),a=CryptUtil._ii(a,r,s,n,t[15],10,-30611744),n=CryptUtil._ii(n,a,r,s,t[6],15,-1560198380),s=CryptUtil._ii(s,n,a,r,t[13],21,1309151649),r=CryptUtil._ii(r,s,n,a,t[4],6,-145523070),a=CryptUtil._ii(a,r,s,n,t[11],10,-1120210379),n=CryptUtil._ii(n,a,r,s,t[2],15,718787259),s=CryptUtil._ii(s,n,a,r,t[9],21,-343485551),e[0]=CryptUtil._add32(r,e[0]),e[1]=CryptUtil._add32(s,e[1]),e[2]=CryptUtil._add32(n,e[2]),e[3]=CryptUtil._add32(a,e[3])},_cmn:(e,t,r,s,n,a)=>(t=CryptUtil._add32(CryptUtil._add32(t,e),CryptUtil._add32(s,a)),CryptUtil._add32(t<<n|t>>>32-n,r)),_ff:(e,t,r,s,n,a,i)=>CryptUtil._cmn(t&r|~t&s,e,t,n,a,i),_gg:(e,t,r,s,n,a,i)=>CryptUtil._cmn(t&s|r&~s,e,t,n,a,i),_hh:(e,t,r,s,n,a,i)=>CryptUtil._cmn(t^r^s,e,t,n,a,i),_ii:(e,t,r,s,n,a,i)=>CryptUtil._cmn(r^(t|~s),e,t,n,a,i),_md51:e=>{let t,r=e.length,s=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)CryptUtil._md5cycle(s,CryptUtil._md5blk(e.substring(t-64,t)));e=e.substring(t-64);let n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(CryptUtil._md5cycle(s,n),t=0;t<16;t++)n[t]=0;return n[14]=8*r,CryptUtil._md5cycle(s,n),s},_md5blk:e=>{let t=[];for(let r=0;r<64;r+=4)t[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24);return t},_hex_chr:"0123456789abcdef".split(""),_rhex:e=>{let t="";for(let r=0;r<4;r++)t+=CryptUtil._hex_chr[e>>8*r+4&15]+CryptUtil._hex_chr[e>>8*r&15];return t},hex:e=>{for(let t=0;t<e.length;t++)e[t]=CryptUtil._rhex(e[t]);return e.join("")},md5:e=>CryptUtil.hex(CryptUtil._md51(e)),_add32:(e,t)=>e+t&4294967295},CollectionUtil={ObjectSet:class{constructor(){this.map=new Map,this[Symbol.iterator]=this.values}add(e){this.map.set(e._toIdString(),e)}values(){return this.map.values()}},joinConjunct:(e,t,r)=>1===e.length?String(e[0]):2===e.length?e.join(r):e.slice(0,-1).join(t)+r+e.slice(-1),arrayEq(e,t){if(!e&&!t)return!0;if(!e&&t||e&&!t)return!1;let r,s=[];if(!e[0]||!t[0])return!1;if(e.length!==t.length)return!1;for(let t=0;t<e.length;t++)s[r=typeof e[t]+"~"+e[t]]?s[r]++:s[r]=1;for(let e=0;e<t.length;e++){if(!s[r=typeof t[e]+"~"+t[e]])return!1;if(0===s[r])return!1;s[r]--}return!0}},Array.prototype.last=Array.prototype.last||function(){return this[this.length-1]},ExcludeUtil={_excludes:null,storage:StorageUtil.getStorage(),initialise(){const e=ExcludeUtil.storage.getItem(EXCLUDES_STORAGE);if(e)try{ExcludeUtil._excludes=JSON.parse(e)}catch(e){window.alert("Error when loading content blacklist! Purging corrupt data..."),ExcludeUtil.storage.removeItem(EXCLUDES_STORAGE),ExcludeUtil._excludes=null,window.location.hash="",setTimeout(()=>{throw e})}else ExcludeUtil._excludes=[]},getList:()=>ExcludeUtil._excludes||[],setList(e){ExcludeUtil._excludes=e,ExcludeUtil._save()},isExcluded:(e,t,r)=>!!ExcludeUtil._excludes&&(r=r.source||r,!!ExcludeUtil._excludes.find(s=>!("*"!==s.source&&s.source!==r||"*"!==s.category&&s.category!==t||"*"!==s.name&&s.name!==e))),addExclude:(e,t,r)=>!ExcludeUtil._excludes.find(s=>s.source===r&&s.category===t&&s.name===e)&&(ExcludeUtil._excludes.push({name:e,category:t,source:r}),ExcludeUtil._save(),!0),removeExclude(e,t,r){const s=ExcludeUtil._excludes.findIndex(s=>s.source===r&&s.category===t&&s.name===e);~s&&(ExcludeUtil._excludes.splice(s,1),ExcludeUtil._save())},_save(){ExcludeUtil.storage.setItem(EXCLUDES_STORAGE,JSON.stringify(ExcludeUtil._excludes))},resetExcludes(){ExcludeUtil._excludes=[],ExcludeUtil._save()}},IS_ROLL20||"undefined"==typeof window||window.addEventListener("load",()=>{});